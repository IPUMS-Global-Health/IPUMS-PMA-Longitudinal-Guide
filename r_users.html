<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width">
<meta property="og:title" content="r_users.knit" />






<meta name="description" content="r_users.knit">

<script id="pandoc-meta" type="application/json">
{"newpage_html_class":"page-break-after","cap-location":"margin","toc-title":"Contents","lof":false,"toc":true,"paged-footnotes":true,"css":["css/layout.css","css/edit-pagedown.css","css/fonts.css"],"lot":false,"output":{"pagedown::html_paged":{"self_contained":false,"toc":true,"front_cover":"images/r-cover.png"}}}
</script>

<title>r_users.knit</title>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function() {
  // Retrieve previous config object if defined
  window.PagedConfig = window.PagedConfig || {};
  let beforePaged = PagedConfig.before;
  window.PagedConfig.before = async () => {
    if (beforePaged) await beforePaged();
    return new Promise((resolve, reject) => {
      var script = document.createElement("script");
      script.type = "text/javascript";
      var src = `https://mathjax.rstudio.com/latest/MathJax.js` + "?config=TeX-MML-AM_CHTML";
      if (location.protocol !== "file:" && /^https?:/.test(src))
        src = src.replace(/^https?:/, '');
      script.src = src;
      window.MathJax = {
        AuthorInit: () => {
          MathJax.Hub.Register.StartupHook("Begin", () => {
            MathJax.Hub.Queue(resolve);
          });
        }
      };
      document.getElementsByTagName("head")[0].appendChild(script);
    });
  };
})();
</script>

<link id="front-cover-1-pagedown-attachment" rel="attachment" href="r_users_files/front-cover-1-0.19/r-cover.png"/>
<link href="r_users_files/paged-0.19/css/default-fonts.css" rel="stylesheet" />
<link href="r_users_files/paged-0.19/css/default-page.css" rel="stylesheet" />
<link href="r_users_files/paged-0.19/css/default.css" rel="stylesheet" />
<script src="r_users_files/paged-0.19/js/config.js"></script>
<script src="r_users_files/paged-0.19/js/paged.js"></script>
<script src="r_users_files/paged-0.19/js/hooks.js"></script>
<script src="r_users_files/kePrint-0.0.1/kePrint.js"></script>
<link href="r_users_files/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/layout.css" type="text/css" />
<link rel="stylesheet" href="css/edit-pagedown.css" type="text/css" />
<link rel="stylesheet" href="css/fonts.css" type="text/css" />

</head>

<body>

<div class="running-h1-title"></div>

<div class="running-h2-title"></div>



<div class="front-page">
</div>

<div class="front-matter-container">
<div id="TOC" class="level1 toc front-matter">
<h1 class="toc-title">Contents</h1>
<ul>
<li><a href="#preface">Preface</a></li>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#ipums-pma-data-in-r"><span class="toc-section-number">1.1</span> IPUMS PMA data in R</a></li>
<li><a href="#resources-for-r-users"><span class="toc-section-number">1.2</span> Resources for R Users</a></li>
<li><a href="#pma-background"><span class="toc-section-number">1.3</span> PMA Background</a></li>
<li><a href="#sampling"><span class="toc-section-number">1.4</span> Sampling</a></li>
<li><a href="#inclusion-criteria-for-analysis"><span class="toc-section-number">1.5</span> Inclusion Criteria for Analysis</a></li>
<li><a href="#survey-design-elements"><span class="toc-section-number">1.6</span> Survey Design Elements</a>
<ul>
<li><a href="#set-survey-design"><span class="toc-section-number">1.6.1</span> Set survey design</a></li>
<li><a href="#sample-strata-for-drc"><span class="toc-section-number">1.6.2</span> Sample strata for DRC</a></li>
</ul></li>
</ul></li>
<li><a href="#longitudinal-data-extracts"><span class="toc-section-number">2</span> Longitudinal Data Extracts</a>
<ul>
<li><a href="#sample-selection"><span class="toc-section-number">2.1</span> Sample Selection</a></li>
<li><a href="#variable-selection"><span class="toc-section-number">2.2</span> Variable Selection</a>
<ul>
<li><a href="#codes"><span class="toc-section-number">2.2.1</span> Codes</a></li>
<li><a href="#variable-description"><span class="toc-section-number">2.2.2</span> Variable Description</a></li>
<li><a href="#comparability-notes"><span class="toc-section-number">2.2.3</span> Comparability Notes</a></li>
<li><a href="#sample-universe"><span class="toc-section-number">2.2.4</span> Sample Universe</a></li>
<li><a href="#availability-across-samples"><span class="toc-section-number">2.2.5</span> Availability Across Samples</a></li>
<li><a href="#questionnaire-text"><span class="toc-section-number">2.2.6</span> Questionnaire Text</a></li>
<li><a href="#checkout"><span class="toc-section-number">2.2.7</span> Checkout</a></li>
</ul></li>
<li><a href="#data-for-r-users"><span class="toc-section-number">2.3</span> Data for R Users</a>
<ul>
<li><a href="#select-a-fixed-width-file"><span class="toc-section-number">2.3.1</span> Select a Fixed-width File</a></li>
<li><a href="#download"><span class="toc-section-number">2.3.2</span> Download</a></li>
</ul></li>
<li><a href="#long-data-structure"><span class="toc-section-number">2.4</span> Long Data Structure</a></li>
<li><a href="#wide-data-structure"><span class="toc-section-number">2.5</span> Wide Data Structure</a></li>
<li><a href="#which-format-is-best-for-me"><span class="toc-section-number">2.6</span> Which format is best for me?</a></li>
</ul></li>
<li><a href="#panel-membership"><span class="toc-section-number">3</span> Panel Membership</a>
<ul>
<li><a href="#chapter-setup"><span class="toc-section-number">3.1</span> Chapter Setup</a></li>
<li><a href="#phase-1"><span class="toc-section-number">3.2</span> Phase 1</a>
<ul>
<li><a href="#household-questionnaire"><span class="toc-section-number">3.2.1</span> Household Questionnaire</a></li>
<li><a href="#female-questionnaire"><span class="toc-section-number">3.2.2</span> Female Questionnaire</a></li>
</ul></li>
<li><a href="#phase-2"><span class="toc-section-number">3.3</span> Phase 2</a>
<ul>
<li><a href="#household-questionnaire-1"><span class="toc-section-number">3.3.1</span> Household Questionnaire</a></li>
<li><a href="#female-questionnaire-1"><span class="toc-section-number">3.3.2</span> Female Questionnaire</a></li>
</ul></li>
<li><a href="#summary"><span class="toc-section-number">3.4</span> Summary</a></li>
</ul></li>
<li><a href="#family-planning-indicators"><span class="toc-section-number">4</span> Family Planning Indicators</a>
<ul>
<li><a href="#chapter-setup-1"><span class="toc-section-number">4.1</span> Chapter Setup</a></li>
<li><a href="#significance-test"><span class="toc-section-number">4.2</span> Significance Test</a></li>
<li><a href="#data-visualization"><span class="toc-section-number">4.3</span> Data Visualization</a></li>
<li><a href="#contraceptive-use-or-non-use"><span class="toc-section-number">4.4</span> Contraceptive Use or Non-Use</a></li>
<li><a href="#contraceptive-method-type"><span class="toc-section-number">4.5</span> Contraceptive Method Type</a></li>
<li><a href="#contraceptive-dynamics-by-subgroup"><span class="toc-section-number">4.6</span> Contraceptive Dynamics by Subgroup</a>
<ul>
<li><a href="#age"><span class="toc-section-number">4.6.1</span> Age</a></li>
<li><a href="#education-level"><span class="toc-section-number">4.6.2</span> Education level</a></li>
<li><a href="#marital-status"><span class="toc-section-number">4.6.3</span> Marital status</a></li>
<li><a href="#parity"><span class="toc-section-number">4.6.4</span> Parity</a></li>
</ul></li>
<li><a href="#outcomes-for-phase-1-non-users"><span class="toc-section-number">4.7</span> Outcomes for Phase 1 Non-users</a>
<ul>
<li><a href="#unmet-need"><span class="toc-section-number">4.7.1</span> Unmet need</a></li>
<li><a href="#partner-support"><span class="toc-section-number">4.7.2</span> Partner support</a></li>
<li><a href="#intentions"><span class="toc-section-number">4.7.3</span> Intentions</a></li>
</ul></li>
<li><a href="#limitations"><span class="toc-section-number">4.8</span> Limitations</a></li>
</ul></li>
<li><a href="#advanced-data-visualization"><span class="toc-section-number">5</span> Advanced Data Visualization</a>
<ul>
<li><a href="#chapter-setup-2"><span class="toc-section-number">5.1</span> Chapter Setup</a></li>
<li><a href="#grouped-bar-charts"><span class="toc-section-number">5.2</span> Grouped Bar Charts</a></li>
<li><a href="#heatmaps"><span class="toc-section-number">5.3</span> Heatmaps</a></li>
<li><a href="#alluvial-plots"><span class="toc-section-number">5.4</span> Alluvial plots</a></li>
</ul></li>
<li><a href="#contraceptive-calendar"><span class="toc-section-number">6</span> Contraceptive Calendar</a>
<ul>
<li><a href="#chapter-setup-3"><span class="toc-section-number">6.1</span> Chapter Setup</a></li>
<li><a href="#century-month-codes-cmc"><span class="toc-section-number">6.2</span> Century Month Codes (CMC)</a></li>
<li><a href="#calendar-length"><span class="toc-section-number">6.3</span> Calendar Length</a></li>
<li><a href="#formatting-calendar-strings"><span class="toc-section-number">6.4</span> Formatting Calendar Strings</a>
<ul>
<li><a href="#merge-phases"><span class="toc-section-number">6.4.1</span> Merge Phases</a></li>
<li><a href="#merge-countries"><span class="toc-section-number">6.4.2</span> Merge Countries</a></li>
<li><a href="#blank-strings"><span class="toc-section-number">6.4.3</span> Blank Strings</a></li>
<li><a href="#split-months-into-columns"><span class="toc-section-number">6.4.4</span> Split Months into Columns</a></li>
<li><a href="#one-row-per-month"><span class="toc-section-number">6.4.5</span> One Row per Month</a></li>
</ul></li>
<li><a href="#analysis"><span class="toc-section-number">6.5</span> Analysis</a>
<ul>
<li><a href="#right-censoring"><span class="toc-section-number">6.5.1</span> Right-censoring</a></li>
<li><a href="#survival-models"><span class="toc-section-number">6.5.2</span> Survival Models</a></li>
<li><a href="#data-visualization-1"><span class="toc-section-number">6.5.3</span> Data Visualization</a></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div class="main">
<div id="preface" class="section level1 front-matter unnumbered">
<h1>Preface</h1>
<p>The work was commissioned and funded by the Family Planning Team at the Bill &amp; Melinda Gates Foundation. The examples here are directly based on the companion <a href="https://tech.popdata.org/pma-data-hub/">IPUMS PMA Blog</a>, with R examples developed by Matt Gunther and IPUMS PMA documentation by Devon Kristiansen under the management of Kathryn Grace, PhD and Elizabeth Heger Boyle, PhD at IPUMS PMA, University of Minnesota. The Stata version and statistical consulting were provided by Mia Yu, Dale Rhoda, and Caitlin Clary at <a href="http://www.biostatglobal.com/">Biostat Global Consulting</a>. These authors are grateful for helpful reviews &amp; comments from Philip Anglewicz, PhD; Linnea Zimmerman, PhD, and Aisha Siewe at Johns Hopkins University. Thanks also to Nina Brooks, PhD and Finn Roberts for code contributions and review.</p>
<h4>
Suggested Citation
</h4>
<p>TBD</p>
<h4>
Source Code
</h4>
<p>This manual is open source. It was constructed from <a href="https://rmarkdown.rstudio.com/">R Markdown</a> files with the <a href="https://github.com/rstudio/pagedown">pagedown</a> package for R.<span id="fn1" class="footnote" data-pagedown-footnote-number="1" style="white-space: pre-line;"><a href="https://github.com/rstudio/pagedown">pagedown</a> © Xie, Yihui et al. (MIT)</span> These files are available on our <a href="">GitHub repository</a>, where you will also find <code>.r</code> and <code>.do</code> files containing the code shown in this manual.</p>
<p>The IPUMS PMA data files referenced in this manual are also available at no cost, but you must register and adhere to terms of use at <a href="https://pma.ipums.org/pma/register.shtml">pma.ipums.org/register</a>. Dataset access is granted only for non-commercial purposes. Users must register an account with IPUMS, request access to data from particular countries, and describe their intended use for the data. Users who have been approved for access to certain countries may submit justification to expand their access to other countries.</p>
<p><a href="https://pma.ipums.org/pma/formulaire_d_inscription.shtml">La version française du formulaire d’inscription</a></p>
<h4>
Hyperlinks
</h4>
<p>Hyperlinks to IPUMS PMA variable documentation, relevant R and Stata documentation, and various other resources are highlighted <a href="">in pink</a> throughout this manual. If the reader prefers a printed version, they are recommended to compile the manual from source files on our GitHub repository, changing the <a href="https://github.com/rstudio/pagedown">pagedown</a> option described <a href="https://pagedown.rbind.io/#links">here</a>. <strong>Warning:</strong> this will add additional footnotes to the document, and may impact pagination.</p>
<div class="page-break-after"></div>
<h4>
Acronyms
</h4>
<ul>
<li>BMGF - <a href="https://www.gatesfoundation.org/">Bill &amp; Melinda Gates Foundation</a></li>
<li>CI - confidence interval</li>
<li>CMC - century month code</li>
<li>CONSORT - <a href="www.consort-statement.org">Consolidated Standards of Reporting Trials</a></li>
<li>CRAN - <a href="https://cran.r-project.org/">The Comprehensive R Archive Network</a> (statistical software)</li>
<li>CSV - comma-separated values file format</li>
<li>DEFF - design effect</li>
<li>DEFT - root design effect (square root of DEFF)</li>
<li>DRC - Democratic Republic of Congo</li>
<li>EA - enumeration area</li>
<li>FP - family planning</li>
<li>FP2020 - Family Planning 2020</li>
<li>FP2030 - <a href="https://fp2030.org/">Family Planning 2030</a></li>
<li>GPS - <a href="https://www.gps.gov/">global positioning system</a></li>
<li>IPUMS - <a href="https://www.ipums.org/">Integrated Public Use Microdata Series</a></li>
<li>ISO - International Organization for Standardization</li>
<li>IUD - intrauterine device</li>
<li>LAM - lactational amenorrhea method of contraception</li>
<li>NA - not available (R notation for a missing data element)</li>
<li>NIU - not in universe</li>
<li>PMA - <a href="https://www.pmadata.org/">Performance Monitoring for Action</a></li>
<li>PPS - probability proportional to size</li>
<li>SAS - <a href="https://www.sas.com/">statistical analysis system</a> (statistical software)</li>
<li>SPSS - <a href="https://www.ibm.com/spss">statistical package for social sciences</a> (statistical software)</li>
</ul>
</div>
<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p><a href="https://www.pmadata.org/">Performance Monitoring for Action (PMA)</a> uses innovative mobile technology to support low-cost, rapid-turnaround surveys that monitor key health and development indicators.</p>
<p>PMA surveys collect longitudinal data throughout a country at the household and health facility levels by female data collectors, known as resident enumerators, using mobile phones. The survey collects information from the same women and households over time for regular tracking of progress and for understanding the drivers of contraceptive use dynamics. The data are rapidly validated, aggregated, and prepared into tables and graphs, making results quickly available to stakeholders. PMA surveys can be integrated into national monitoring and evaluation systems using a low-cost, rapid-turnaround survey platform that can be adapted and used for various health data needs.</p>
<p>The PMA project is implemented by local partner universities and research organizations who train and deploy the cadres of female resident enumerators.</p>
<aside>
PMA has also published a guide to <strong>cross-sectional</strong> analysis in both <a href="https://www.pmadata.org/media/1243/download?attachment">English</a> and <a href="https://www.pmadata.org/media/1244/download?attachment">French</a>.
</aside>
<p>The purpose of this manual is to provide guidance on the analysis of <strong>harmonized longitudinal data</strong> for a panel of women age 15-49 surveyed by PMA and published in partnership with <a href="https://pma.ipums.org/pma/">IPUMS PMA</a>. IPUMS provides census and survey products from around the world in an integrated format, making it easy to compare data from multiple countries. IPUMS PMA data are available free of charge, subject to terms and conditions: please <a href="https://pma.ipums.org/pma/register.shtml">register here</a> to request access to the data featured in this guide.<span id="fn2" class="footnote" data-pagedown-footnote-number="2" style="white-space: pre-line;">PMA data for individual countries is also available at no cost from <a href="https://www.pmadata.org/">pmadata.org</a>. Please note that the variable names, value labels, numeric codes, and other metadata featured in this guide have been altered by IPUMS PMA to facilitate comparison across countries.</span></p>
<p>This manual provides reproducible coding examples in the statistical programming language <a href="https://www.r-project.org/">R</a>. Each chapter also appears as a post on the IPUMS PMA <a href="https://tech.popdata.org/pma-data-hub/index.html">data analysis blog</a>, where you’ll find new content posted every two weeks.</p>
<p><strong>Stata users:</strong> a companion manual for IPUMS PMA longitudinal analysis is also available with coding examples written in Stata.</p>
<div id="ipums-pma-data-in-r" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> IPUMS PMA data in R</h2>
<p>The first two chapters of this manual introduce new users to <a href="https://www.pmadata.org/data/survey-methodology">PMA longitudinal data</a> and the <a href="https://pma.ipums.org/pma/">IPUMS PMA website</a>, respectively. After demonstrating how to obtain an IPUMS PMA data extract, the remaining chapters feature extensive data analysis examples written in R.</p>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="https://cran.r-project.org/">
<img src="images/hex/Rlogo.png"/>
</a>
<br/>
© R-project.org
<br/>
(GPL-2 | GPL-3)
</div>
</aside>
<p>To follow along, you’ll need to download the appropriate version of R for your computer’s operating system at <a href="https://www.r-project.org/">r-project.org</a>. <strong>R is available at no cost</strong> and it runs on Windows, MacOS, and a wide variety of UNIX platforms. We also recommend downloading a free copy of <a href="https://www.rstudio.com/">RStudio</a>, an integrated development environment (IDE) designed to make your experience with R much easier.</p>
<p>Individual chapters may introduce one or two <strong>R packages</strong> that provide helpful functions for longitudinal survey analysis, in particular. Two packages we feature in <em>every</em> chapter are <a href="https://www.ipums.org">ipumsr</a> and <a href="https://tidyverse.tidyverse.org">tidyverse</a>. You can install these and other packages featured in this guide like so:</p>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="https://tech.popdata.org/ipumsr/">
<img src="images/hex/ipumsr.png"/>
</a>
<br/>
© IPUMS
<br/>
(MPL-2.0)
</div>
</aside>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ipumsr&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>The <a href="https://www.ipums.org">ipumsr</a> package is designed to help R users import and explore data extracts downloaded from IPUMS. As we’ll see, categorical variables from IPUMS require additional tools because they appear as <strong>labelled integers</strong> represented in R by a number and a label like this:</p>
<pre><code># A tibble: 4 × 2
  COUNTRY                            n
  &lt;int+lbl&gt;                      &lt;int&gt;
1 1 [Burkina Faso]                8257
2 2 [Congo, Democratic Republic]  6090
3 7 [Kenya]                      12605
4 9 [Nigeria]                     3225</code></pre>
<p>The <a href="https://tidyverse.tidyverse.org">tidyverse</a> is actually a collection of packages developed in-part by contributors at RStudio. These include:</p>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="https://tidyverse.tidyverse.org/index.html">
<img src="images/hex/tidyverse.png"/>
</a>
<br/>
© RStudio, Inc.
<br/>
(MIT)
</div>
</aside>
<ul>
<li><a href="https://ggplot2.tidyverse.org">ggplot2</a> for data visualization</li>
<li><a href="https://dplyr.tidyverse.org">dplyr</a> for data manipulation</li>
<li><a href="https://tidyr.tidyverse.org">tidyr</a> for data tidying</li>
<li><a href="https://readr.tidyverse.org">readr</a> for data import</li>
<li><a href="http://purrr.tidyverse.org">purrr</a> for functional programming</li>
<li><a href="https://tibble.tidyverse.org/">tibble</a> for tibbles, a modern re-imagining of dataframes</li>
<li><a href="https://stringr.tidyverse.org">stringr</a> for strings</li>
<li><a href="https://forcats.tidyverse.org/">forcats</a> for factors</li>
</ul>
</div>
<div id="resources-for-r-users" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Resources for R Users</h2>
<p>This manual focuses exclusively on longitudinal family planning data from IPUMS PMA, but the companion <a href="https://tech.popdata.org/pma-data-hub/">data analysis blog</a> covers a wide range of topics like:</p>
<ul>
<li>A free <a href="https://tech.popdata.org/pma-data-hub/introduction.html">online course</a> for beginners</li>
<li>New data announcements</li>
<li>Data cleaning and reformatting</li>
<li>Data analysis and visualization</li>
<li>Spatial analysis</li>
<li>Guides to PMA Service Delivery Point &amp; Client Exit Interview data</li>
</ul>
<p>Beyond the blog, it’s important to know where to find <strong>instructions and examples</strong> for the R packages featured in this guide. Nearly all of these packages have a dedicated website with a homepage, reference page (documentation for individual functions), collection of articles (for general instructions), and change-log (for news about updates). The <a href="https://www.ipums.org">ipumsr</a> page is a great place to start:</p>
<p><img src="images/ipumsr_home.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Finally, if you’re looking for a more general introduction to R, we strongly recommend the following <strong>free resources</strong>:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/index.html">R for Data Science</a> for beginners</li>
<li><a href="https://adv-r.hadley.nz/">Advanced R</a> for a deeper dive</li>
<li><a href="https://rspatial.org/">RSpatial</a> for analysis with spatial data</li>
<li><a href="https://ggplot2-book.org/">ggplot2</a> for data visualization</li>
<li><a href="https://bookdown.org/yihui/rmarkdown/">R Markdown: The Definitive Guide</a> for producing annotated code, word documents, presentations, web pages, and more</li>
<li><a href="https://www.r-bloggers.com/">R-bloggers</a> for regular news and tutorials</li>
</ul>
</div>
<div id="pma-background" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> PMA Background</h2>
<p>Dating back to 2013, the original PMA survey design included high-frequency, <strong>cross-sectional</strong> samples of women and service delivery points collected from eleven countries participating in <a href="http://progress.familyplanning2020.org/">Family Planning 2020</a> (FP2020) - a global partnership that supports the rights of women and girls to decide for themselves whether, when, and how many children they want to have. These surveys were designed to monitor annual progress towards <a href="http://progress.familyplanning2020.org/measurement">FP2020 goals</a> via population-level estimates for several <a href="http://www.track20.org/pages/data_analysis/core_indicators/overview.php">core indicators</a>.</p>
<p>Beginning in 2019, PMA surveys were redesigned under a renewed partnership called <a href="https://fp2030.org/">Family Planning 2030</a> (FP2030). These new surveys have been refocused on reproductive and sexual health indicators, and they feature a <strong>longitudinal panel</strong> of women of childbearing age. This design will allow researchers to measure contraceptive dynamics and changes in women’s fertility intentions over a <strong>three year period</strong> via annual in-person interviews.<span id="fn3" class="footnote" data-pagedown-footnote-number="3" style="white-space: pre-line;">In addition to these three in-person surveys, PMA also conducted telephone interviews with panel members focused on emerging issues related to the COVID-19 pandemic in 2020. These telephone surveys are already available for several countries - the IPUMS PMA blog series on <a href="https://tech.popdata.org/pma-data-hub/#category:COVID-19">PMA COVID-19 surveys</a> covers this topic in detail.</span></p>
<p>Questions on the redesigned survey cover topics like:</p>
<ul>
<li>awareness, perception, knowledge, and use of contraceptive methods</li>
<li>perceived quality and side effects of contraceptive methods among current users</li>
<li>birth history and fertility intentions</li>
<li>aspects of health service provision</li>
<li>domains of empowerment</li>
</ul>
</div>
<div id="sampling" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Sampling</h2>
<p>PMA panel data includes a mixture of <strong>nationally representative</strong> and <strong>sub-nationally representative</strong> samples. The panel study consists of three data collection phases, each spaced one year apart.</p>
<p>As of this writing, IPUMS PMA has released data from the first <em>two</em> phases for four countries where Phase 1 data collection began in 2019; IPUMS PMA has released data from only the <em>first</em> phase for three countries where Phase 1 data collection began in August or September 2020. Phase 3 data collection and processing is currently underway.</p>
<div style="margin-bottom: 1em; margin-top: 0em; border: 0px solid #ddd; padding: 5pxoverflow-x: scroll; width:100%; border-bottom: 0;">
<table style="width:100%; margin-left: auto; margin-right: auto;" class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Now Available from IPUMS PMA
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Sample
</th>
<th style="text-align:left;">
Phase 1 Data Collection<sup>*</sup>
</th>
<th style="text-align:left;">
Phase 1
</th>
<th style="text-align:left;">
Phase 2
</th>
<th style="text-align:left;">
Phase 3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
Dec 2019 - Mar 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Cote d’Ivoire
</td>
<td style="text-align:left;">
Sep 2020 - Dec 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC - Kinshasa
</td>
<td style="text-align:left;">
Dec 2019 - Feb 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC - Kongo Central
</td>
<td style="text-align:left;">
Dec 2019 - Feb 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
India - Rajasthan
</td>
<td style="text-align:left;">
Aug 2020 - Oct 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Kenya
</td>
<td style="text-align:left;">
Nov 2019 - Dec 2019
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria - Kano
</td>
<td style="text-align:left;">
Dec 2019 - Jan 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria - Lagos
</td>
<td style="text-align:left;">
Dec 2019 - Jan 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Uganda
</td>
<td style="text-align:left;">
Sep 2020 - Oct 2020
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup>*</sup> <em>Each data collection phase is spaced one year apart</em>
</td>
</tr>
</tfoot>
</div>
<aside>
<strong>Resident enumerators</strong> are women over age 21 living in (or near) each EA who hold at least a high school diploma.
</aside>
<p>PMA uses a multi-stage clustered sample design, with stratification at the urban-rural level or by sub-region. Sample clusters - called <a href="https://pma.ipums.org/pma-action/variables/EAID#description_section">enumeration areas</a> (EAs) – are provided by the national statistics agency in each country.<span id="fn4" class="footnote" data-pagedown-footnote-number="4" style="white-space: pre-line;"><a href="https://tech.popdata.org/pma-data-hub/posts/2021-10-15-nutrition-climate/PMA_displacement.pdf">Displaced GPS coordinates</a> for the centroid of each EA are available for most samples <a href="https://www.pmadata.org/data/request-access-datasets">by request</a> from PMA. IPUMS PMA provides shapefiles for PMA countries <a href="https://pma.ipums.org/pma/gis_boundary_files.shtml">here</a>.</span> These EAs are sampled using a <em>probability proportional to size</em> (PPS) method relative to the population distribution in each stratum.</p>
<div class="page-break-after"></div>
<p>At Phase 1, 35 household dwellings were selected at random within each EA. Resident enumerators visited each dwelling and invited one household member to complete a <a href="https://pma.ipums.org/pma/resources/questionnaires/hhf/PMA-Household-Questionnaire-English-2019.10.09.pdf">Household Questionnaire</a><span id="fn5" class="footnote" data-pagedown-footnote-number="5" style="white-space: pre-line;">Questionnaires administered in each country may vary from this <strong>Core Household Questionnaire</strong> - <a href="https://pma.ipums.org/pma/enum_materials.shtml">click here</a> for details.</span> that includes a census of all household members and visitors who stayed there during the night before the interview. Female household members and visitors aged 15-49 were then invited to complete a subsequent Phase 1 <a href="https://pma.ipums.org/pma/resources/questionnaires/hhf/PMA-Female-Questionnaire-English-2019.10.09.pdf">Female Questionnaire</a>.<span id="fn6" class="footnote" data-pagedown-footnote-number="6" style="white-space: pre-line;">Questionnaires administered in each country may vary from this <strong>Core Female Questionnaire</strong> - <a href="https://pma.ipums.org/pma/enum_materials.shtml">click here</a> for details.</span></p>
<aside>
<p><a href="https://pma.ipums.org/pma-action/variables/SAMEDWELLING#codes_section">SAMEDWELLING</a> indicates whether a Phase 2 female respondent resided in her Phase 1 dwelling or a new one.</p>
<a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN</a> indicates whether a Phase 2 household member completed the Phase 1 Female Questionnaire.
</aside>
<p>One year later, resident enumerators visited the same dwellings and administered a Phase 2 Household Questionnaire. A panel member in Phase 2 is any woman still age 15-49 who could be reached for a second Female Questionnaire, either because:</p>
<ul>
<li>she still lived there, or</li>
<li>she had moved elsewhere within the study area,<span id="fn7" class="footnote" data-pagedown-footnote-number="7" style="white-space: pre-line;">The “study area” is area within which resident enumerators should attempt to find panel women that have moved out of their Phase 1 dwelling. This may extend beyond the woman’s original EA as determined by in-country administrators - see <a href="https://www.pmadata.org/data/survey-methodology">PMA Phase 2 and Phase 3 Survey Protocol</a> for details.</span> but at least one member of the Phase 1 household remained and could help resident enumerators locate her new dwelling.<span id="fn8" class="footnote" data-pagedown-footnote-number="8" style="white-space: pre-line;">In cases where no Phase 1 household members remained in the dwelling at Phase 2, women from the household are considered <strong>lost to follow-up</strong>. Chapter 3 covers this topic in detail.</span></li>
</ul>
<p>Additionally, resident enumerators administered the Phase 2 Female Questionnaire to <em>new</em> women in sampled households who:</p>
<ul>
<li>reached age 15 after Phase 1</li>
<li>joined the household after Phase 1</li>
<li>declined the Female Questionnaire at Phase 1, but agreed to complete it at Phase 2</li>
</ul>
<div class="page-break-after"></div>
<p>When you select the new <strong>Longitudinal</strong> sample option from IPUMS PMA, you’ll be able to include responses from every available phase of the study. These samples are available in either <strong>Long</strong> format (responses from each phase will be organized in separate rows) or <strong>Wide</strong> format (responses from each phase will be organized in columns).</p>
<p><img src="images/long_radio.png" width="1011" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<aside>
<a href="https://pma.ipums.org/pma-action/variables/CROSS_SECTION#codes_section">CROSS_SECTION</a> indicates whether a household member in a longitudinal sample is also included in the cross-sectional sample for a given year (every person in a cross-sectional sample is included in the longitudinal sample).
</aside>
<p>In addition to following up with women in the panel over time, PMA also adjusted sampling so that a cross-sectional sample could be produced concurrently with each data collection phase. These samples mainly overlap with the data you’ll obtain for a particular phase in the longitudinal sample, except that replacement households were drawn from each EA where more than 10% of households from the previous phase were no longer there. Conversely, panel members who were located in a new dwelling at Phase 2 will not be represented in the cross-sectional sample drawn from that EA. These adjustments ensure that population-level indicators may be derived from cross-sectional samples in a given year, even if panel members move or are lost to follow-up.</p>
<p>You’ll find PMA cross-sectional samples dating back to 2013 if you select the <strong>Cross-sectional</strong> sample option from IPUMS PMA.</p>
<p><img src="images/cross_radio.png" width="1012" style="display: block; margin: auto;" /></p>
</div>
<div id="inclusion-criteria-for-analysis" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Inclusion Criteria for Analysis</h2>
<p>Several chapters in this manual feature code you can use to reproduce key indicators included in the <strong>PMA Longitudinal Brief</strong> for each sample. In many cases, you’ll find separate reports available in English and French, and for both national and sub-national summaries. For reference, here are the highest-level population summaries available in English for each sample where Phase 2 IPUMS PMA data is currently available:</p>
<ul>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Burkina%20National_Phase%202_Panel_Results%20Brief_English_Final.pdf">Burkina Faso</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kinshasa_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC - Kinshasa</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kongo%20Central_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC - Kongo Central</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Kenya%20National_Phase%202_Panel%20Results%20Brief_Final.pdf">Kenya</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20KANO_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria - Kano</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20LAGOS_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria - Lagos</a></li>
</ul>
<p>Panel data in these reports is limited to the <em>de facto</em> population of women who completed the Female Questionnaire in both Phase 1 and Phase 2. This includes women who slept in the household during the night before the interview for the Household Questionnaire. The <em>de jure</em> population includes women who are usual household members, but who slept elsewhere that night. In order to reproduce the findings from PMA reports, we’ll remove <em>de jure</em> cases recorded in the variable <a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a>.</p>
<aside>
We will demonstrate how to request and download an IPUMS PMA data extract in Chapter 2.
</aside>
<p>For example, let’s consider a <strong>Wide</strong> format data extract containing Phase 1 and Phase 2 respondents to the Female Questionnaire from Burkina Faso. We’ve downloaded such an extract and placed it in the <code>data</code> sub-folder of our R working directory. We’ll load <a href="https://www.ipums.org">ipumsr</a> and <a href="https://tidyverse.tidyverse.org">tidyverse</a> together with our extract.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00001.xml&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00001.dat.gz&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In a <strong>Wide</strong> format data extract, a numeric suffix indicates the data collection phase associated with each variable. So, the you’ll find the the number of women who slept in the household before the Household Questionnaire for each phase reported in <a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT_1</a> and <a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT_2</a>.</p>
<div class="page-break-after"></div>
<p>This extract includes 174 women who are not members of the <em>de facto</em> population because they did not sleep in the sampled household during the night before the Phase 1 interview:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESIDENT_1)</span></code></pre></div>
<pre><code># A tibble: 3 × 2
  RESIDENT_1                                            n
  &lt;int+lbl&gt;                                         &lt;int&gt;
1 11 [Visitor, slept in hh last night]                106
2 21 [Usual member, did not sleep in hh last night]   174
3 22 [Usual member, slept in hh last night]          6510</code></pre>
<p>The extract also includes 230 women who are not members of the <em>de facto</em> population because they did not sleep in the sampled household during the night before the Phase 2 interview:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESIDENT_2)</span></code></pre></div>
<pre><code># A tibble: 5 × 2
  RESIDENT_2                                                          n
  &lt;int+lbl&gt;                                                       &lt;int&gt;
1 11 [Visitor, slept in hh last night]                               74
2 21 [Usual member, did not sleep in hh last night]                 230
3 22 [Usual member, slept in hh last night]                        5993
4 31 [Slept in hh last night, no response if usually lives in hh]     1
5 NA                                                                492</code></pre>
<p>Moreover, there are 492 <code>NA</code> values in <a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT_2</a> representing women who were <strong>lost to follow-up</strong> after Phase 1. We will explain <strong>loss to follow-up</strong> in detail in Chapter 3.</p>
<p>The <em>de facto</em> population is represented in codes 11 and 22 in both of these variables. We’ll use <a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a> to include only those cases.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>defacto <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>)) </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>defacto <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESIDENT_1, RESIDENT_2)</span></code></pre></div>
<pre><code># A tibble: 4 × 3
  RESIDENT_1                                RESIDENT_2                                 n
  &lt;int+lbl&gt;                                 &lt;int+lbl&gt;                              &lt;int&gt;
1 11 [Visitor, slept in hh last night]      11 [Visitor, slept in hh last night]      56
2 11 [Visitor, slept in hh last night]      22 [Usual member, slept in hh last ni…    39
3 22 [Usual member, slept in hh last night] 11 [Visitor, slept in hh last night]      17
4 22 [Usual member, slept in hh last night] 22 [Usual member, slept in hh last ni…  5855</code></pre>
<div class="page-break-after"></div>
<p>Additionally, PMA reports only include women who completed (or partially completed) both Female Questionnaires. This information is reported in <a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a>. In our <strong>Wide</strong> extract, this information appears in <a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ_1</a> and <a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ_2</a>: if you select the <strong>Female Respondents</strong> option at checkout, only women who completed (or partially completed) the Phase 1 Female Questionnaire will be included in your extract.</p>
<p><img src="images/cases1.png" width="883" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>We’ll further restrict our sample by selecting only cases where <a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ_2</a> shows that the woman also completed the Phase 2 questionnaire. Notice that, in addition to each of the value 1 through 10, there are several <strong>non-response codes</strong> numbered 90 through 99. You’ll see similar values repeated across all IPUMS PMA variables, except that they will be left-padded to match the maximum width of a particular variable (e.g. <code>9999</code> is used for <a href="https://pma.ipums.org/pma-action/variables/INTFQYEAR#codes_section">INTFQYEAR</a>, which represents a 4-digit year for the Female Interview).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESULTFQ_2)</span></code></pre></div>
<pre><code># A tibble: 11 × 2
   RESULTFQ_2                                         n
   &lt;int+lbl&gt;                                      &lt;int&gt;
 1  1 [Completed]                                  5491
 2  2 [Not at home]                                  78
 3  3 [Postponed]                                    22
 4  4 [Refused]                                      66
 5  5 [Partly completed]                             12
 6  7 [Respondent moved]                             15
 7 10 [Incapacitated]                                19
 8 95 [Not interviewed (female questionnaire)]        4
 9 96 [Not interviewed (household questionnaire)]   192
10 99 [NIU (not in universe)]                       399
11 NA                                               492</code></pre>
<p>Possible <strong>non-response codes</strong> include:</p>
<ul>
<li><code>95</code> Not interviewed (female questionnaire)</li>
<li><code>96</code> Not interviewed (household questionnaire)</li>
<li><code>97</code> Don’t know</li>
<li><code>98</code> No response or missing</li>
<li><code>99</code> NIU (not in universe)</li>
</ul>
<p>The value <code>NA</code> in an IPUMS PMA extract indicates that a particular variable is not provided for a selected sample. In a <strong>Wide</strong> extract, it may also signify that a particular person was not included in the data from a particular phase. Here, an <code>NA</code> appearing in <a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ_2</a> indicates that a Female Respondent from Phase 1 was not found in Phase 2.</p>
<div class="page-break-after"></div>
<p>You can drop incomplete Phase 2 female responses as follows:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>completed <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>) </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>completed <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESULTFQ_1, RESULTFQ_2)</span></code></pre></div>
<pre><code># A tibble: 2 × 3
  RESULTFQ_1           RESULTFQ_2        n
  &lt;int+lbl&gt;            &lt;int+lbl&gt;     &lt;int&gt;
1 1 [Completed]        1 [Completed]  5487
2 5 [Partly completed] 1 [Completed]     4</code></pre>
<p>Generally, we will combine both filtering steps together in a single function like so:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>In subsequent analyses, we’ll use the remaining cases to show how PMA generates key indicators for <strong>contraceptive use status</strong> and <strong>family planning intentions and outcomes</strong>. The summary report for each country includes measures dis-aggregated by demographic variables like:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/MARSTAT#codes_section">MARSTAT</a> - marital status</li>
<li><a href="https://pma.ipums.org/pma-action/variables/EDUCATT#codes_section">EDUCATT</a> and <a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> - highest attended level of education<span id="fn9" class="footnote" data-pagedown-footnote-number="9" style="white-space: pre-line;">Levels in <a href="https://pma.ipums.org/pma-action/variables/EDUCATT#codes_section">EDUCATT</a> may vary by country; <a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> recodes country-specific levels in four general categories.</span></li>
<li><a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE</a> - age</li>
<li><a href="https://pma.ipums.org/pma-action/variables/WEALTHQ#codes_section">WEALTHQ</a> and <a href="https://pma.ipums.org/pma-action/variables/WEALTHT#codes_section">WEALTHT</a> - household wealth quintile or tertile<span id="fn10" class="footnote" data-pagedown-footnote-number="10" style="white-space: pre-line;">Households are divided into quintiles/tertiles relative to the distribution of an asset <a href="https://pma.ipums.org/pma-action/variables/SCORE#description_section">SCORE</a> weighted for all sampled households. For sub-nationally-representative samples (DRC and Nigeria), separate wealth distributions are calculated for each sampled region.</span></li>
<li><a href="https://pma.ipums.org/pma-action/variables/URBAN#codes_section">URBAN</a> and <a href="https://pma.ipums.org/pma-action/variables/SUBNATIONAL#codes_section">SUBNATIONAL</a> - geographic location<span id="fn11" class="footnote" data-pagedown-footnote-number="11" style="white-space: pre-line;"><a href="https://pma.ipums.org/pma-action/variables/SUBNATIONAL#codes_section">SUBNATIONAL</a> includes sub-national regions for all sampled countries; country-specific variables are also available on the <a href="https://pma.ipums.org/pma-action/variables/group?id=hh_geo">household - geography</a> page.</span></li>
</ul>
</div>
<div id="survey-design-elements" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Survey Design Elements</h2>
<p>Throughout this guide, we’ll demonstrate how to incorporate PMA sampling weights and information about its stratified cluster sampling procedure into your analysis. This section describes how to use survey weights, cluster IDs, and sample strata in R.</p>
<p>Whether you intend to work with a new <strong>Longitudinal</strong> or <strong>Cross-sectional</strong> data extract, you’ll find the same set of sampling weights available for all PMA Family Planning surveys dating back to 2013:</p>
<aside>
A fourth Family Planning survey weight, <a href="https://pma.ipums.org/pma-action/variables/POPWT#description_section">POPWT</a>, is currently available only for <strong>Cross-sectional</strong> data extracts.<span id="fn12" class="footnote" data-pagedown-footnote-number="12" style="white-space: pre-line;"><a href="https://pma.ipums.org/pma-action/variables/POPWT#codes_section">POPWT</a> can be used to estimate population-level <em>counts</em> - <a href="https://pma.ipums.org/pma/population_weights.shtml">click here</a> or view <a href="https://www.youtube.com/watch?v=GnCq26t4zgM">this video</a> for details.</span>
</aside>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/HQWEIGHT#description_section">HQWEIGHT</a> can be used to generate cross-sectional population estimates from questions on the Household Questionnaire.<span id="fn13" class="footnote" data-pagedown-footnote-number="13" style="white-space: pre-line;"><a href="https://pma.ipums.org/pma-action/variables/HQWEIGHT#codes_section">HQWEIGHT</a> reflects the <a href="https://pma.ipums.org/pma/resources/documentation/weighting_memo.pdf">calculated selection probability</a> for a household in an EA, normalized at the population-level. Users intending to estimate population-level indicators for <em>households</em> should restrict their sample to one person per household via <a href="https://pma.ipums.org/pma-action/variables/LINENO#description_section">LINENO</a> - see <a href="https://pma.ipums.org/pma/weightguide.shtml#hh">household weighting guide</a> for details.</span></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FQWEIGHT#description_section">FQWEIGHT</a> can be used to to generate cross-sectional population estimates from questions on the Female Questionnaire.<span id="fn14" class="footnote" data-pagedown-footnote-number="14" style="white-space: pre-line;"><a href="https://pma.ipums.org/pma-action/variables/FQWEIGHT#codes_section">FQWEIGHT</a> adjusts <a href="https://pma.ipums.org/pma-action/variables/HQWEIGHT#codes_section">HQWEIGHT</a> for female non-response within the EA, normalized at the population-level - see <a href="https://pma.ipums.org/pma/weightguide.shtml#female">female weighting guide</a> for details.</span></li>
<li><a href="https://pma.ipums.org/pma-action/variables/EAWEIGHT#description_section">EAWEIGHT</a> can be used to compare the selection probability of a particular household with that of its EA.</li>
</ul>
<p>Additionally, PMA created a new weight, <a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#description_section">PANELWEIGHT</a>,
which should be used in longitudinal analyses spanning multiple phases, as it adjusts for loss to follow-up. <a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a> is available only for <strong>Longitudinal</strong> data extracts.</p>
<p>PMA sample clusters are identified by the variable <a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID</a>, while sample strata are identified by <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA</a>. We’ll demonstrate how to use each of these survey design elements in R below.</p>
<div id="set-survey-design" class="section level3" number="1.6.1">
<h3><span class="header-section-number">1.6.1</span> Set survey design</h3>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="http://gdfe.co/srvyr/index.html">
<img src="images/hex/srvyr.png"/>
</a>
<br/>
© Greg Freedman Ellis
<br/>
(GPL-2 | GPL-3)
</div>
</aside>
<p>Throughout this guide, we’ll use tools from the <a href="http://gdfe.co/srvyr/">srvyr</a> package to incorporate survey design elements into our analyses.<span id="fn15" class="footnote" data-pagedown-footnote-number="15" style="white-space: pre-line;">The <a href="http://gdfe.co/srvyr/">srvyr</a> package is a <a href="https://tidyverse.tidyverse.org">tidyverse</a> implementation of the popular <a href="http://r-survey.r-forge.r-project.org/survey/">survey</a> package for R, authored by Dr. Thomas Lumley. For thorough discussion of the types of weights available in both R and Stata, we recommend <a href="https://notstatschat.rbind.io/2020/08/04/weights-in-statistics/">this blog post</a> by Dr. Lumley.</span> You can install or update <a href="http://gdfe.co/srvyr/">srvyr</a> like so:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;srvyr&quot;</span>)</span></code></pre></div>
<p>Load <a href="http://gdfe.co/srvyr/">srvyr</a> for use in an R session with:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span></code></pre></div>
<p>Let’s return to the <strong>Wide</strong> data extract described in the previous section, which includes Phase 1 and Phase 2 <strong>Female Respondents</strong> from Burkina Faso. In the following example, we’ll show how to use IPUMS PMA survey design elements to estimate the proportion of reproductive age women in Burkina Faso who were using contraception at the time of data collection for both Phase 1 and Phase 2. In a <strong>Cross-sectional</strong> or <strong>Long</strong> format longitudinal extract, you’d find this information in the variable <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>. In the <strong>Wide</strong> extract featured here, you’ll find it in <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_1</a> for Phase 1, and in <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_2</a> for Phase 2.</p>
<p>Here is how to count the <em>unweighted</em> number of sampled women using and not using contraception in both phases. (We drop 5 cases coded 99 for “NIU (not in universe)” in Phase 1).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CP_1 <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">&amp;</span> CP_2 <span class="sc">&lt;</span> <span class="dv">90</span>) </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(CP_1, CP_2)</span></code></pre></div>
<pre><code># A tibble: 4 × 3
  CP_1      CP_2          n
  &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int&gt;
1 0 [No]    0 [No]     2589
2 0 [No]    1 [Yes]     821
3 1 [Yes]   0 [No]      556
4 1 [Yes]   1 [Yes]    1241</code></pre>
<div class="page-break-after"></div>
<p>To estimate a population percentage, we’ll need to tell <a href="http://gdfe.co/srvyr/">srvyr</a> that we are working with a sample survey dataset and specify the IPUMS PMA survey design elements. This is accomplished with <a href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a>: we use <a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a> as the sampling <code>weight</code>. We also use <a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID_1</a> to <code>id</code> the sample clusters,<span id="fn16" class="footnote" data-pagedown-footnote-number="16" style="white-space: pre-line;">As we’ll see in Chapter 3, women are considered <strong>lost to follow-up</strong> if they moved outside the study area after Phase 1. Therefore, <a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID_1</a> and <a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID_2</a> are identical for all panel members: you can use either one to identify sample clusters.</span> and <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a> to represent sample <code>strata</code>.<span id="fn17" class="footnote" data-pagedown-footnote-number="17" style="white-space: pre-line;">As with <a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID</a>, you may use either <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a> or <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_2</a> if your analysis is restricted to panel members</span></p>
<p>Summary functions like <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a> use information from <a href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a> to derive weighted population estimates with cluster-adjusted standard errors. The argument <code>vartype = "ci"</code> reports a cluster-robust 95% confidence interval,<span id="fn18" class="footnote" data-pagedown-footnote-number="18" style="white-space: pre-line;">The confidence level in <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a> can be adjusted with <code>level</code> (e.g. <code>level = 0.99)</code></span> while <code>prop = TRUE</code> and <code>prop_method = "logit"</code> ensure that no estimated proportion includes values beyond 0% and 100%.<span id="fn19" class="footnote" data-pagedown-footnote-number="19" style="white-space: pre-line;">See <a href="https://rdrr.io/pkg/survey/man/svyciprop.html">svyciprop</a> for a complete list of available adjustment methods.</span></p>
<aside>
<p><code>coef</code> shows the estimated population proportion</p>
<code>_low</code> and <code>_upp</code> show the lower and upper bounds of a 95% confidence interval
</aside>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> PANELWEIGHT, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> EAID_1, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">strata =</span> STRATA_1</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">survey_mean</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">*</span> CP_2,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">proportion =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code># A tibble: 1 × 3
   coef `_low` `_upp`
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 0.188  0.164  0.214</code></pre>
<p>Using the survey design information for this sample, we estimate that about 18.8% of all reproductive age women in Burkina Faso were using contraception at the time both Phase 1 and Phase 2 data were collected. We’re 95% certain that this value falls between 16.4% and 21.4%.</p>
</div>
<div id="sample-strata-for-drc" class="section level3" number="1.6.2">
<h3><span class="header-section-number">1.6.2</span> Sample strata for DRC</h3>
<p>Importantly, the variable <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA</a> is <em>not available</em> for samples collected from DRC - Kinshasa or DRC - Kongo Central. If your extract includes any DRC sample, you’ll need to amend this variable to include one unique numeric code for each of those regions.</p>
<p>For example, let’s look at a different <strong>Wide</strong> extract, <code>dat2</code>, containing all of the samples included in this data release. Notice that <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a> lists the sample strata for every <a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a> <em>except</em> for DRC, where you see the value <code>NA</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00002.xml&quot;</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00002.dat.gz&quot;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    CP_1 <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">&amp;</span> CP_2 <span class="sc">&lt;</span> <span class="dv">90</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(STRATA_1)) <span class="sc">%&gt;%</span> <span class="fu">count</span>(COUNTRY, STRATA_1)</span></code></pre></div>
<pre><code># A tibble: 1 × 3
  COUNTRY                        STRATA_1      n
  &lt;int+lbl&gt;                      &lt;int+lbl&gt; &lt;int&gt;
1 2 [Congo, Democratic Republic] NA         3478</code></pre>
<p>Now let’s see what happens when we try to produce population-level estimates with <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_1) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COUNTRY, GEOCD, GEONG) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">survey_mean</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">*</span> CP_2,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">proportion =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>Error in (function (object, ...) : missing values in `strata&#39;</code></pre>
<p>This fails because <a href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a> encounters <code>NA</code> values in <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a>. Fortunately, we can replace those values with numeric codes from the variable <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(GEOCD)</span></code></pre></div>
<pre><code># A tibble: 3 × 2
  GEOCD                  n
  &lt;int+lbl&gt;          &lt;int&gt;
1  1 [Kinshasa]       1967
2  2 [Kongo Central]  1511
3 NA                 14227</code></pre>
<p>If <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a> is not <code>NA</code>, we’ll use its numeric code in place of <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a>. Otherwise, we’d like to leave <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a> unchanged. However, because both variables include <em>value labels</em>, we’ll first need remove them with <a href="https://rdrr.io/r/base/numeric.html">as.numeric</a>. To avoid confusion with the original variable <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a>, we’ll call our new variable <code>STRATARC</code> (for “strata recoded”).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">STRATARC =</span> <span class="fu">if_else</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(GEOCD), </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(STRATA_1), </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(GEOCD)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<div class="page-break-after"></div>
<p>Notice that <code>STRATARC</code> replaces the <code>NA</code> values in <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a>, leaving its numeric values unchanged.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(GEOCD, STRATA_1, STRATARC)</span></code></pre></div>
<pre><code># A tibble: 28 × 4
   GEOCD              STRATA_1                          STRATARC     n
   &lt;int+lbl&gt;          &lt;int+lbl&gt;                            &lt;dbl&gt; &lt;int&gt;
 1  1 [Kinshasa]         NA                                    1  1967
 2  2 [Kongo Central]    NA                                    2  1511
 3 NA                 40410 [Bungoma - urban, Kenya]       40410   153
 4 NA                 40411 [Bungoma - rural, Kenya]       40411   488
 5 NA                 40412 [Kakamega - urban, Kenya]      40412   133
 6 NA                 40413 [Kakamega - rural, Kenya]      40413   438
 7 NA                 40414 [Kericho - urban, Kenya]       40414   249
 8 NA                 40415 [Kericho - rural, Kenya]       40415   453
 9 NA                 40416 [Kiambu - urban, Kenya]        40416   213
10 NA                 40417 [Kiambu - rural, Kenya]        40417   311
11 NA                 40418 [Kilifi - urban, Kenya]        40418   170
12 NA                 40419 [Kilifi - rural, Kenya]        40419   455
13 NA                 40420 [Kitui - urban, Kenya]         40420   153
14 NA                 40421 [Kitui - rural, Kenya]         40421   585
15 NA                 40422 [Nairobi - urban, Kenya]       40422   493
16 NA                 40423 [Nandi - urban, Kenya]         40423   260
17 NA                 40424 [Nandi - rural, Kenya]         40424   711
18 NA                 40425 [Nyamira - urban, Kenya]       40425   143
19 NA                 40426 [Nyamira - rural, Kenya]       40426   382
20 NA                 40427 [Siaya - urban, Kenya]         40427   130
21 NA                 40428 [Siaya - rural, Kenya]         40428   437
22 NA                 40429 [West Pokot - urban, Kenya]    40429   104
23 NA                 40430 [West Pokot - rural, Kenya]    40430   473
24 NA                 56606 [Lagos, Nigeria]               56606  1088
25 NA                 56611 [Kano - Urban]                 56611   437
26 NA                 56612 [Kano - Rural]                 56612   561
27 NA                 85401 [Urban, Burkina Faso]          85401  3053
28 NA                 85402 [Rural, Burkina Faso]          85402  2154</code></pre>
<div class="page-break-after"></div>
<p>Finally, we can use the updated survey design information to estimate the proportion of women who were using contraception at both Phase 1 and Phase 2 in every sample (including those from Kinshasa and Kongo Central).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COUNTRY, GEOCD, GEONG) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">survey_mean</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">*</span> CP_2,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">proportion =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code># A tibble: 6 × 6
# Groups:   COUNTRY, GEOCD [5]
  COUNTRY                        GEOCD              GEONG        coef `_low` `_upp`
  &lt;int+lbl&gt;                      &lt;int+lbl&gt;          &lt;int+lbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 1 [Burkina Faso]               NA                 NA         0.188  0.164  0.214 
2 2 [Congo, Democratic Republic]  1 [Kinshasa]      NA         0.320  0.288  0.353 
3 2 [Congo, Democratic Republic]  2 [Kongo Central] NA         0.268  0.215  0.329 
4 7 [Kenya]                      NA                 NA         0.366  0.350  0.382 
5 9 [Nigeria]                    NA                  2 [Lagos] 0.293  0.259  0.330 
6 9 [Nigeria]                    NA                  4 [Kano]  0.0537 0.0322 0.0880</code></pre>
</div>
</div>
</div>
<div id="longitudinal-data-extracts" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Longitudinal Data Extracts</h1>
<p>This chapter provides a guided tour of the <a href="https://pma.ipums.org/pma/">IPUMS PMA data extract system</a>. While you may also access the original data directly from our partners at <a href="https://www.pmadata.org/">PMA</a>, harmonized data from IPUMS have a few additional features. For instance, you can request an extract that:</p>
<aside>
<a href="https://pma.ipums.org/pma/register.shtml">Register here</a> to access IPUMS PMA data <strong>at no cost.</strong> See our <a href="https://pma.ipums.org/pma/userguide.shtml">user guide</a> for details.
</aside>
<ul>
<li>includes samples from multiple countries<br />
</li>
<li>includes samples from multiple rounds of data collection</li>
<li>are formatted in either <strong>Long</strong> or <strong>Wide</strong> format</li>
</ul>
<p>IPUMS PMA also makes it easy to switch between multiple <a href="https://pma.ipums.org/pma-action/variables/group">units of analysis</a> covered in PMA surveys. In addition to the data featured in this guide, you’ll find surveys representing:</p>
<aside>
A video tour of the longitudinal extract system is available <a href="https://www.youtube.com/embed/VwjYHDvpHk0">here</a> on the IPUMS PMA Youtube channel.
</aside>
<ul>
<li><a href="https://tech.popdata.org/pma-data-hub/#category:Service_Delivery_Points">Service Delivery Points (SDPs)</a></li>
<li><a href="https://tech.popdata.org/pma-data-hub/#category:Client_Exit_Interviews">Client Exit Interviews conducted at SDPs</a></li>
<li>Participants in special surveys covering topics like <a href="https://tech.popdata.org/pma-data-hub/#category:COVID-19">COVID-19</a>, <a href="https://tech.popdata.org/pma-data-hub/#category:Nutrition">nutrition</a>, and maternal &amp; newborn health</li>
</ul>
<p>To get started with a longitudinal data extract, you’ll need to select the <strong>Family Planning</strong> topic under the <strong>Person</strong> unit of analysis.</p>
<p><img src="images/unit.png" width="85%" style="display: block; margin: auto;" /></p>
<div id="sample-selection" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Sample Selection</h2>
<p>Once you’ve selected the <strong>Family Planning</strong> option, you’ll next need to choose between cross-sectional or longitudinal samples. Cross-sectional samples are selected by default; these are nationally or sub-nationally representative samples collected each year dating backward as far as 2013.</p>
<p><img src="images/cross-sectional.png" width="85%" style="display: block; margin: auto;" /></p>
<p>Longitudinal samples are only available from 2019 onward, and they include all of the available phases for each sampled country (sub-nationally representative samples for DRC and Nigeria are listed separately). You’ll only find longitudinal samples for countries where Phase 2 data has been made available; Phase 1 data for Cote d’Ivoire, India, and Uganda can currently be found under the Cross-sectional sample menu (Phase 2 data will be released soon!).</p>
<div class="page-break-after"></div>
<p>Clicking the Longitudinal button reveals options for either <strong>Long</strong> or <strong>Wide</strong> format. You’ll find the same samples available in either case.</p>
<p><strong>Important:</strong> if you decide to change formats after selecting variables, your Data Cart will be emptied and you’ll need to begin again from scratch.</p>
<p><img src="images/wide.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>After you’ve selected one of the available longitudinal formats, choose one or more samples listed below. There are also several Sample Members options listed.</p>
<p><img src="images/cases.png" width="85%" style="display: block; margin: auto;" /></p>
<aside>
<p><a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN</a> indicates whether an individual is a member of the panel study.</p>
<a href="https://pma.ipums.org/pma-action/variables/ELIGIBLE#codes_section">ELIGIBLE</a> indicates whether an individual was eligible for the female questionnaire.
</aside>
<p><strong>Female Respondents</strong> only includes women who completed <em>all or part</em> of a Female Questionnaire. <strong>This option selects all members of the panel study.</strong> In addition, it includes women who only participated in only one phase - we will demonstrate how to identify and drop these cases below.<span id="fn20" class="footnote" data-pagedown-footnote-number="20" style="white-space: pre-line;">Women who completed all or part of the Female Questionnaire in <em>more than one phase</em> of the study are considered <strong>panel members</strong>. Women who completed it only at Phase 1 are included in a longitudinal extract, but they are not <strong>panel members</strong>. Likewise, women who completed it for the first time at Phase 2 are included, but are not <strong>panel members</strong> if they 1) will reach age 50 before Phase 3, or 2) declined the invitation to participate again in Phase 3.</span></p>
<p><strong>Female Respondents and Female Non-respondents</strong> includes all women who were eligible to participate in a Female Questionnaire. Eligible women are those age 15-49 who were listed on the roster collected in a Household Questionnaire. If an eligible woman declined the Female Questionnaire or was not available, variables associated with that questionnaire will be coded “Not interviewed (female questionnaire)”.</p>
<div class="page-break-after"></div>
<aside>
<p><a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a> indicates whether an individual completed the Female Questionnaire.</p>
<a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ</a> indicates whether a member of the individual’s household completed the Household Questionnaire.
</aside>
<p><strong>Female Respondents and Household Members</strong> adds records for all other members of a Female Respondent’s household. These household members did not complete the Female Questionnaire, but were listed on the household roster provided by the respondent to a Household Questionnaire. Basic <a href="https://internal.pma.ipums.org/pma-action/variables/group?id=hh_roster">demographic</a> variables are available for each household member, as are common <a href="https://internal.pma.ipums.org/pma-action/variables/group?id=hh_wealth">wealth</a>, <a href="https://internal.pma.ipums.org/pma-action/variables/group?id=water_watersource">water</a>, <a href="https://internal.pma.ipums.org/pma-action/variables/group?id=water_wash">sanitation</a>, and other variables shared for all members of the same household.</p>
<p><strong>All Cases</strong> includes all members listed on the household roster from a Household Questionnaire. If the Household Questionnaire was declined or if no respondent was available, any panel member appearing in other phases of the study will be coded “Not interviewed (household questionnaire)” for variables associated with the missing Household Questionnaire.</p>
<p>After you’ve selected samples and sample members for your extract, click the “Submit Sample Selections” button to return to the main data browsing menu.</p>
</div>
<div id="variable-selection" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Variable Selection</h2>
<p>You can browse IPUMS PMA variables by topic or alphabetically by name, or you can <a href="https://pma.ipums.org/pma-action/variables/search">search</a> for a particular term in a variable name, label, value labels, or description.</p>
<p><img src="images/topics.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>In this example, we’ll select the <a href="https://pma.ipums.org/pma-action/variables/group?id=fem_fpst">Discontinuation of Family Planning</a> topic. The availability of each associated variable is shown in a table containing all of the samples we’ve selected.</p>
<ul>
<li><code>X</code> indicates that the variable is available for <em>all phases</em></li>
<li><code>/</code> indicates that the variable is available for <em>one phase</em></li>
<li><code>-</code> indicates that the variable is not available for <em>any phase</em></li>
</ul>
<p>You can click the <code>+</code> button to add a variable to your cart, or click a variable name to learn more.</p>
<p><img src="images/table.png" width="85%" style="display: block; margin: auto;" /></p>
<div id="codes" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Codes</h3>
<aside>
“Case-count view” is not available for longitudinal samples. For cross-sectional samples, this option shows the frequency of each response.
</aside>
<p>Let’s take a look at the variable <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a>. You’ll find the variable name and label shown at the top of the page. Below, you’ll see several tabs beginning with the <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">CODES</a> tab. For discrete variables, this tab shows all of the available codes and value labels associated with each response. You’ll also see the same <code>X</code>, <code>/</code>, and <code>-</code> symbols in a table indicating the availability of each response in each sample.</p>
<p><img src="images/codes-fr.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>Above, there are no responses for “Not interviewed (female questionnaire)” and “Not interviewed (household questionnaire)”; this is because only samples members included in a “Female Respondents” extract are displayed by default. If we instead choose “All Cases”, this variable will include those response options because we’ll include every person listed on the household roster (even if the Household or Female Questionnaire was not completed).</p>
<p><img src="images/codes-all.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>The symbol <code>/</code> again indicates that a particular response is available for some - but not all - phases of the study. For <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a> it indicates that one of the options was either unavailable or was not selected by any sample respondents in a particular phase. If a variable was not included in all phases of the study, all response options will be marked with this symbol. For example, consider the variable <a href="https://pma.ipums.org/pma-action/variables/COVIDCONCERN#codes_section">COVIDCONCERN</a>, indicating the respondent’s level of concern about becoming infected with COVID-19.</p>
<p><img src="images/covidconcern.png" width="85%" style="display: block; margin: auto;" /></p>
<p>Because Phase 1 questionnaires were administered prior to the emergence of COVID-19, this variable only appeared on Phase 2 questionnaires. The symbol <code>/</code> indicates limited availability across phases.</p>
</div>
<div id="variable-description" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Variable Description</h3>
<p>You’ll find a detailed description for each variable on the <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#description_section">DESCRIPTION</a> tab. This tab also indicates whether a particular question appeared on the Household or Female Questionnaire.</p>
<p><img src="images/desc.png" width="85%" style="display: block; margin: auto;" /></p>
</div>
<div id="comparability-notes" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Comparability Notes</h3>
<p>The <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#comparability_section">COMPARABILITY</a> tab describes important differences between samples. Additionally, it may contain information about similar variables appearing in <a href="https://dhsprogram.com/">DHS</a> samples provided by <a href="https://www.idhsdata.org/idhs/">IPUMS DHS</a>.</p>
<p><img src="images/comp.png" width="85%" style="display: block; margin: auto;" /></p>
</div>
<div id="sample-universe" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Sample Universe</h3>
<p>The <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#universe_section">UNIVERSE</a> tab describes selection criteria for this question. In this case, there are some differences between samples:</p>
<ul>
<li>In DRC samples, all women aged 15-49 received this question.</li>
<li>For all other samples, the question was skipped if any such woman previously indicated that she was menopausal or had a hysterectomy.</li>
</ul>
<p><img src="images/universe.png" width="85%" style="display: block; margin: auto;" /></p>
</div>
<div id="availability-across-samples" class="section level3" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Availability Across Samples</h3>
<p>The <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#availability_section">AVAILABILITY</a> tab shows all other samples (including cross-sectional samples) where this variable is available.</p>
<p><img src="images/avail.png" width="85%" style="display: block; margin: auto;" /></p>
</div>
<div id="questionnaire-text" class="section level3" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Questionnaire Text</h3>
<p>Finally, you’ll find the full text of each question on the <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#questionnaire_text_section">QUESTIONNAIRE TEXT</a> tab. Each phase of the survey is shown separately, and you may click the “view entire document: text” link to view the complete questionnaire for a particular sample in any given phase.</p>
<p><img src="images/question.png" width="85%" style="display: block; margin: auto;" /></p>
</div>
<div id="checkout" class="section level3" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> Checkout</h3>
<p>Use the buttons at the top of this page to add the variable to your Data Cart, or to “VIEW CART” and begin checkout.</p>
<img src="images/buttons.png" style="margin-top: 20px; margin-bottom: 25px; max-width: 100%; width: 1033px;"/>
</div>
</div>
<div id="data-for-r-users" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Data for R Users</h2>
<p>Your Data Cart shows all of the variables you’ve selected, plus several “preselected” variables that will be automatically included in your extract. Click the “CREATE DATA EXTRACT” button to prepare your download.</p>
<p><img src="images/cart.png" width="85%" style="display: block; margin: auto;" /></p>
<div id="select-a-fixed-width-file" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Select a Fixed-width File</h3>
<p>Before you submit an extract request, you’ll have the opportunity to choose a “Data Format”. <strong>R users should select a Fixed-width text file (.dat)</strong> - you’ll notice that data formatted for Stata, SPSS, and SAS are also available. CSV files are provided, but not recommended. (If you wish to change Sample Members, you may do so again here.)</p>
<p><img src="images/checkout1.png" width="85%" style="display: block; margin: auto;" /></p>
<p>Once the Fixed-width option is selected, you may add a description and then proceed to the download page.</p>
</div>
<div id="download" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Download</h3>
<p>After a few moments, you’ll receive an email indicating that your extract has been created. You’ll need to obtain two files from the download page:</p>
<ul>
<li>Click the green “Download DAT” button to download the data file. You’ll receive a file with a number like <code>pma_00001.dat.gz</code>.<br />
</li>
<li>Right click on “DDI” and click “Save link as”. You’ll receive a corresponding XML file like <code>pma_00001.xml</code>.</li>
</ul>
<img src="images/download.png" style="margin-top: 20px; margin-bottom: 25px;"/>
<p>Place both files in a folder that R can use as its <a href="https://r4ds.had.co.nz/workflow-projects.html?q=working%20directory#where-does-your-analysis-live">working directory</a>. We <strong>strongly recommend</strong> using <a href="https://r4ds.had.co.nz/workflow-projects.html?q=working%20directory#rstudio-projects">RStudio projects</a> to manage all of the files and analysis scripts used for a particular research project. We’ll place our files in a sub-folder called “data” within our own RStudio project folder.</p>
<p>Open RStudio (or R) and load the packages <a href="https://www.ipums.org">ipumsr</a> and <a href="https://tidyverse.tidyverse.org">tidyverse</a>. If you are not using an RStudio project, you will need to change your working directory to match the location of your downloaded files.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;~/Downloads&quot;</span>) <span class="co"># ONLY if not using an RStudio project (change as needed)</span></span></code></pre></div>
<p>We’ll now demonstrate loading both a long and a wide extract, and we’ll take a brief look at the structure of each.</p>
</div>
</div>
<div id="long-data-structure" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Long Data Structure</h2>
<p>We’ve downloaded a <strong>Long</strong> data extract (<strong>Female Respondents</strong> only) and saved it in a folder called “data” in our working directory. We’ll now load it into R as an object called <code>long</code>.</p>
<p>To load an IPUMS PMA extract into R, you’ll need to reference <em>both</em> the DDI file <em>and</em> the fixed-width data file in the function <a href="https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html">read_ipums_micro</a> from <a href="https://www.ipums.org">ipumsr</a>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00095.xml&quot;</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00095.dat.gz&quot;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In a <strong>Long</strong> extract, data from each phase will be organized in <em>separate rows</em>. Here, responses from three panel members are shown:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>long <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FQINSTID <span class="sc">%&gt;%</span> <span class="fu">str_starts</span>(<span class="st">&quot;011&quot;</span>) <span class="sc">|</span> FQINSTID <span class="sc">%&gt;%</span> <span class="fu">str_starts</span>(<span class="st">&quot;015&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(FQINSTID) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FQINSTID, PHASE, AGE, PANELWOMAN)</span></code></pre></div>
<pre><code># A tibble: 6 × 4
  FQINSTID                  PHASE               AGE       PANELWOMAN
  &lt;chr&gt;                     &lt;int+lbl&gt;           &lt;int+lbl&gt; &lt;int+lbl&gt; 
1 011W5S0HN91I4H4I3T9JCMBHB 1 [Baseline]        29        NA        
2 011W5S0HN91I4H4I3T9JCMBHB 2 [First follow up] 30         1 [Yes]  
3 015NP6FJTIA98FYCBBBS1FOF7 1 [Baseline]        47        NA        
4 015NP6FJTIA98FYCBBBS1FOF7 2 [First follow up] 48         1 [Yes]  
5 015WYNNO2WXHH6JA4HA9PL1MR 1 [Baseline]        20        NA        
6 015WYNNO2WXHH6JA4HA9PL1MR 2 [First follow up] 21         1 [Yes]  </code></pre>
<p>Each panel member receives a unique ID shown in <a href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a>. The variable <a href="https://pma.ipums.org/pma-action/variables/PHASE#codes_section">PHASE</a> shows that each woman’s responses to the Phase 1 Female Questionnaire appears in the first row, while her Phase 2 responses appear in the second. <a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE</a> shows each woman’s age when she completed the Female Questionnaire for each phase.</p>
<p><a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN</a> indicates whether the woman completed all or part of the Female Questionnaire in a <em>prior</em> phase, and that she’d agreed to continue participating in the panel study at that time. The value <code>NA</code> appears in the rows for Phase 1, as <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN</a> was not included in Phase 1 surveys.</p>
<div class="page-break-after"></div>
<p>We mentioned above that you’ll also include responses from some non-panel members when you request an extract with <strong>Female Respondents</strong>. These include women who did not complete all or part the Female Questionnaire in a prior phase, as indicated by <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN</a>. These women are not assigned a value for <a href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a> - instead, you’ll find an empty string:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>long <span class="sc">%&gt;%</span> <span class="fu">count</span>(PHASE, PANELWOMAN, FQINSTID <span class="sc">==</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 3 × 4
  PHASE               PANELWOMAN `FQINSTID == &quot;&quot;`     n
  &lt;int+lbl&gt;           &lt;int+lbl&gt;  &lt;lgl&gt;            &lt;int&gt;
1 1 [Baseline]        NA         FALSE            23591
2 2 [First follow up]  0 [No]    TRUE              6586
3 2 [First follow up]  1 [Yes]   FALSE            18194</code></pre>
<p>Chapter 1 describes <strong>Inclusion Criteria for Analysis</strong> and shows how to identify women in a <strong>Wide</strong> extract who did not complete the Female Questionnaire in both phases. In <strong>Long</strong> format, we use <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a> to ensure that there is one row for every <a href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a> where <code>PHASE == 1</code> and another row where <code>PHASE == 2 &amp; RESULTFQ == 1</code>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> long <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FQINSTID) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(PHASE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;</span> <span class="fu">any</span>(PHASE <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> RESULTFQ <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code></pre></div>
<p>The <em>de facto</em> population is identified where <a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a> takes the value <code>11</code> or <code>22</code> in both rows.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> long <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FQINSTID) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">all</span>(RESIDENT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code></pre></div>
<div class="page-break-after"></div>
<p>Following these steps, you can check the size of each analytic sample like so. (Reminder: samples for DRC and Nigeria are sub-nationally representative, so we’ll show separate frequencies for each <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a> and <a href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a>).</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>long <span class="sc">%&gt;%</span> <span class="fu">count</span>(COUNTRY, GEOCD, GEONG, PHASE)</span></code></pre></div>
<pre><code># A tibble: 12 × 5
   COUNTRY                        GEOCD              GEONG      PHASE                  n
   &lt;int+lbl&gt;                      &lt;int+lbl&gt;          &lt;int+lbl&gt;  &lt;int+lbl&gt;          &lt;int&gt;
 1 1 [Burkina Faso]               NA                 NA         1 [Baseline]        5212
 2 1 [Burkina Faso]               NA                 NA         2 [First follow u…  5212
 3 2 [Congo, Democratic Republic]  1 [Kinshasa]      NA         1 [Baseline]        1973
 4 2 [Congo, Democratic Republic]  1 [Kinshasa]      NA         2 [First follow u…  1973
 5 2 [Congo, Democratic Republic]  2 [Kongo Central] NA         1 [Baseline]        1514
 6 2 [Congo, Democratic Republic]  2 [Kongo Central] NA         2 [First follow u…  1514
 7 7 [Kenya]                      NA                 NA         1 [Baseline]        6939
 8 7 [Kenya]                      NA                 NA         2 [First follow u…  6939
 9 9 [Nigeria]                    NA                  2 [Lagos] 1 [Baseline]        1089
10 9 [Nigeria]                    NA                  2 [Lagos] 2 [First follow u…  1089
11 9 [Nigeria]                    NA                  4 [Kano]  1 [Baseline]         998
12 9 [Nigeria]                    NA                  4 [Kano]  2 [First follow u…   998</code></pre>
</div>
<div id="wide-data-structure" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Wide Data Structure</h2>
<p>We’ve also downloaded a <strong>Wide</strong> data extract (<strong>Female Respondents</strong> only) and saved it in the “data” folder in our working directory. We’ll also load this extract into R as an object named <code>wide</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>wide <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00084.xml&quot;</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00084.dat.gz&quot;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In a <strong>Wide</strong> extract, all of the responses from one woman appear in the <em>same row</em>. The IPUMS PMA extract system appends a numeric suffix to each variable name corresponding with the phase from which it was drawn. Consider our three example panel members again:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FQINSTID <span class="sc">%&gt;%</span> <span class="fu">str_starts</span>(<span class="st">&quot;011&quot;</span>) <span class="sc">|</span> FQINSTID <span class="sc">%&gt;%</span> <span class="fu">str_starts</span>(<span class="st">&quot;015&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FQINSTID, AGE_1, AGE_2, PANELWOMAN_1, PANELWOMAN_2)</span></code></pre></div>
<pre><code># A tibble: 3 × 5
  FQINSTID                  AGE_1     AGE_2     PANELWOMAN_1 PANELWOMAN_2
  &lt;chr&gt;                     &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt;    &lt;int+lbl&gt;   
1 011W5S0HN91I4H4I3T9JCMBHB 29        30        NA           1 [Yes]     
2 015NP6FJTIA98FYCBBBS1FOF7 47        48        NA           1 [Yes]     
3 015WYNNO2WXHH6JA4HA9PL1MR 20        21        NA           1 [Yes]     </code></pre>
<p>Each panel member has one unique ID shown in <a href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a>. However, <a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE</a> is parsed into two columns: <a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE_1</a> shows each woman’s age at Phase 1, and <a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE_2</a> shows her age at Phase 2.</p>
<p>As we’ve discussed, <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN</a> is not available for Phase 1, as it indicates whether the woman completed all or part of the Female Questionnaire in a <em>prior</em> phase. For this reason, all values in <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN_1</a> are <code>NA</code>. Most variables are copied once for each phase, even if they - like <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN_1</a> - are not available for all phases.</p>
<div class="page-break-after"></div>
<p>You might expect the total length of a <strong>Wide</strong> extract to be half the length of a corresponding <strong>Long</strong> extract. This is not the case! A <strong>Wide</strong> extract includes one row for each woman who completed all or part of the Female Questionnaire <em>for any phase</em> - you’ll find placeholder columns for phases where the interview was not conducted.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FQINSTID <span class="sc">==</span> <span class="st">&quot;0C8VQU6B03BXLAVVZ8SB90EKQ&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RESULTFQ_1, AGE_1, RESULTFQ_2, AGE_2)</span></code></pre></div>
<pre><code># A tibble: 1 × 4
  RESULTFQ_1    AGE_1     RESULTFQ_2      AGE_2                                      
  &lt;int+lbl&gt;     &lt;int+lbl&gt; &lt;int+lbl&gt;       &lt;int+lbl&gt;                                  
1 1 [Completed] 31        2 [Not at home] 95 [Not interviewed (female questionnaire)]</code></pre>
<p>In a <strong>Long</strong> extract, rows for the missing phase are dropped. In this example, the woman was “not at home” for the Phase 2 Female Questionnaire. When we select a <strong>Long</strong> extract containing only Female Respondents, her Phase 2 row is excluded automatically (it will be included if you request an extract containing Female Respondents and Female Non-respondents).</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>long <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FQINSTID <span class="sc">==</span> <span class="st">&quot;0C8VQU6B03BXLAVVZ8SB90EKQ&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PHASE, RESULTFQ, AGE)</span></code></pre></div>
<pre><code># A tibble: 1 × 3
  PHASE        RESULTFQ      AGE      
  &lt;int+lbl&gt;    &lt;int+lbl&gt;     &lt;int+lbl&gt;
1 1 [Baseline] 1 [Completed] 31       </code></pre>
<p>The <strong>Inclusion Criteria for Analysis</strong> section in Chapter 1 shows how to identify members of the <em>de facto</em> population who completed the Female Questionnaire in both phases for a <strong>Wide</strong> extract. Those steps are repeated here:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>wide <span class="ot">&lt;-</span> wide <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  )  </span></code></pre></div>
<p>Following these steps, each analytic sample contains the same number of cases shown in the final <strong>Long</strong> format extract above.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">%&gt;%</span> <span class="fu">count</span>(COUNTRY, GEOCD, GEONG) </span></code></pre></div>
<pre><code># A tibble: 6 × 4
  COUNTRY                        GEOCD              GEONG          n
  &lt;int+lbl&gt;                      &lt;int+lbl&gt;          &lt;int+lbl&gt;  &lt;int&gt;
1 1 [Burkina Faso]               NA                 NA          5212
2 2 [Congo, Democratic Republic]  1 [Kinshasa]      NA          1973
3 2 [Congo, Democratic Republic]  2 [Kongo Central] NA          1514
4 7 [Kenya]                      NA                 NA          6939
5 9 [Nigeria]                    NA                  2 [Lagos]  1089
6 9 [Nigeria]                    NA                  4 [Kano]    998</code></pre>
</div>
<div id="which-format-is-best-for-me" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Which format is best for me?</h2>
<p>The choice between <strong>Long</strong> and <strong>Wide</strong> formats ultimately depends on your research objectives.</p>
<p>Many data manipulation tasks, for example, are faster and easier to perform in the <strong>Wide</strong> format. In the example above, we needed to identify women who completed a Female Questionnaire and were members of the <em>de facto</em> population in both phases. In the <strong>Long</strong> format, we first had to group the data by <a href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a> with <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a>, thereby ensuring that a Phase 1 and Phase 2 check could be performed for each woman. In preparing for this post, this approach took about 36.5 seconds. By comparison, the same task was achieved without <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a> in <strong>Wide</strong> format in just 0.16 seconds. If your workflow requires multiple comparisons between phases, the <strong>Wide</strong> format may be the best choice!</p>
<p>On the other hand, many of the longitudinal modeling packages available for R require data to be in a <strong>Long</strong> format - this includes both the <a href="https://github.com/therneau/survival">survival</a> package used in Chapter 6 and the <a href="https://github.com/lme4/lme4/">lme4</a> package for multilevel models. Users who prefer the <strong>Wide</strong> format for data cleaning and exploration can manually switch to <strong>Long</strong> format with help from <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>, for example:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">%&gt;%</span> <span class="fu">select</span>(FQINSTID, AGE_1, PREGNANT_1, AGE_2, PREGNANT_2)</span></code></pre></div>
<pre><code># A tibble: 17,725 × 5
   FQINSTID                                  AGE_1     PREGNANT_1 AGE_2     PREGNANT_2
   &lt;chr&gt;                                     &lt;int+lbl&gt; &lt;int+lbl&gt;  &lt;int+lbl&gt; &lt;int+lbl&gt; 
 1 uuid:0005f6d7-b7cd-46f6-8a6f-5f051b6ab4a2 30        0 [No]     31        0 [No]    
 2 uuid:0006cb76-09d1-4f2a-a92d-c12fcaf194b5 34        1 [Yes]    34        0 [No]    
 3 uuid:00204481-5cae-4188-abb3-0367d0ed9c14 17        0 [No]     18        0 [No]    
 4 uuid:002398f4-8f2d-4095-8019-c306d39cf2b9 29        0 [No]     29        0 [No]    
 5 uuid:00407300-c1e6-4e24-ab8d-8af5e1ca85a6 25        0 [No]     25        0 [No]    
 6 uuid:00413ed1-d176-44fb-a232-7e53c1db0958 32        0 [No]     32        0 [No]    
 7 uuid:0048a052-66ff-4ed5-9fa9-fc72e6dab696 38        0 [No]     39        0 [No]    
 8 uuid:004d80f0-90c6-4b77-bb4d-21d09c84fe74 38        0 [No]     38        0 [No]    
 9 uuid:00504cf5-870c-4a02-aad7-ea5d47b135ff 33        0 [No]     34        0 [No]    
10 uuid:00534792-fb84-47b4-8606-e145d74cd089 24        0 [No]     25        0 [No]    
11 uuid:0058cbb8-9892-4a60-b9ed-fb556a21f862 29        0 [No]     30        0 [No]    
12 uuid:00682e93-0483-42b4-8f8d-2e0c36a26d37 16        0 [No]     17        0 [No]    
# … with 17,713 more rows</code></pre>
<div class="page-break-after"></div>
<p>With <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>, you can strip the suffix <code>1</code> or <code>2</code> from each variable, placing the result in a new column called <code>PHASE</code>. Then, we’ll pivot each woman’s age and pregnancy status from 2 <strong>Wide</strong> columns into a single <strong>Long</strong> one.</p>
<aside>
We will revisit <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> when analyzing PMA Contraceptive Calendar data in Chapter 6.
</aside>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FQINSTID, AGE_1, PREGNANT_1, AGE_2, PREGNANT_2) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>FQINSTID, </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;(.*)_([1-2])&quot;</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;PHASE&quot;</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code># A tibble: 35,450 × 4
   FQINSTID                                  PHASE AGE       PREGNANT 
   &lt;chr&gt;                                     &lt;chr&gt; &lt;int+lbl&gt; &lt;int+lbl&gt;
 1 uuid:0005f6d7-b7cd-46f6-8a6f-5f051b6ab4a2 1     30        0 [No]   
 2 uuid:0005f6d7-b7cd-46f6-8a6f-5f051b6ab4a2 2     31        0 [No]   
 3 uuid:0006cb76-09d1-4f2a-a92d-c12fcaf194b5 1     34        1 [Yes]  
 4 uuid:0006cb76-09d1-4f2a-a92d-c12fcaf194b5 2     34        0 [No]   
 5 uuid:00204481-5cae-4188-abb3-0367d0ed9c14 1     17        0 [No]   
 6 uuid:00204481-5cae-4188-abb3-0367d0ed9c14 2     18        0 [No]   
 7 uuid:002398f4-8f2d-4095-8019-c306d39cf2b9 1     29        0 [No]   
 8 uuid:002398f4-8f2d-4095-8019-c306d39cf2b9 2     29        0 [No]   
 9 uuid:00407300-c1e6-4e24-ab8d-8af5e1ca85a6 1     25        0 [No]   
10 uuid:00407300-c1e6-4e24-ab8d-8af5e1ca85a6 2     25        0 [No]   
11 uuid:00413ed1-d176-44fb-a232-7e53c1db0958 1     32        0 [No]   
12 uuid:00413ed1-d176-44fb-a232-7e53c1db0958 2     32        0 [No]   
# … with 35,438 more rows</code></pre>
<p>Manipulating patterns in variable names with <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> takes practice, and we imagine many users will find it easier to simply work with data in the <strong>Long</strong> format from the beginning.</p>
<p>Fortunately, the IPUMS PMA extract system makes it easy to select the samples, sample members, and variables that matter to your particular research question. Choices for <strong>Long</strong> and <strong>Wide</strong> data formats save an additional data cleaning step, allowing you to jump into longitudinal analysis as quickly as possible.</p>
</div>
</div>
<div id="panel-membership" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Panel Membership</h1>
<p>In Chapter 1, we mentioned that PMA uses a <strong>multi-stage cluster sample design</strong> for each phase of the panel study. This means you’ll find data from a Household Questionnaire administered once each year, and you’ll find data from a subsequent Female Questionnaire collected shortly afterward. Three years - or phases - of data will be collected in total.</p>
<p>Because data are collected through two questionnaires administered in three phases, there are several places where incomplete or missing data may indicate <strong>loss to follow-up</strong> - dropped cases from the original panel design. At the same time, PMA uses an <strong>open panel</strong> design, whereby women who move into the study area or reach participation age after Phase 1 are permitted to join the panel at any subsequent phase.</p>
<p>In Chapter 3, we’ll cover these issues in detail. To illustrate, we’ll be using a <strong>Wide</strong> format data extract from IPUMS PMA that includes <strong>All cases</strong> from both currently available phases. In other words, we’ll include every member of the household roster collected in the Household Questionnaire at the start of each phase (even if no Female Questionnaire was completed by that person).</p>
<aside>
R code showing how to build a combined CONSORT diagram with <a href="https://ggplot2.tidyverse.org">ggplot2</a> is available on the <a href="https://tech.popdata.org/pma-data-hub/posts/2022-04-01-phase2-members/">IPUMS PMA data analysis blog</a>.
</aside>
<p>To make our explanation easier to follow, we’ll make use of a data visualization tool known in clinical research settings as a <a href="http://www.consort-statement.org/consort-statement/flow-diagram">CONSORT diagram</a>. This type of diagram is a flowchart showing enrollment and attrition points, most typically in longitudinal studies. PMA publishes a CONSORT diagram together with the User Notes for each longitudinal sample, which you can find via the links below:</p>
<ul>
<li><a href="https://pma.ipums.org/pma/resources/longitudinal_flowcharts/Burkina_Faso_panel_phase2.pdf">Burkina Faso</a></li>
<li><a href="https://pma.ipums.org/pma/resources/longitudinal_flowcharts/Kinshasa_panel_phase2.pdf">DRC - Kinshasa</a></li>
<li><a href="https://pma.ipums.org/pma/resources/longitudinal_flowcharts/Kongo_Central_panel_phase2.pdf">DRC - Kongo Central</a></li>
<li><a href="https://pma.ipums.org/pma/resources/longitudinal_flowcharts/Kenya_panel_phase2.pdf">Kenya</a></li>
<li><a href="https://pma.ipums.org/pma/resources/longitudinal_flowcharts/Lagos_panel_phase2.pdf">Nigeria - Lagos</a></li>
<li><a href="https://pma.ipums.org/pma/resources/longitudinal_flowcharts/Kano_panel_phase2.pdf">Nigeria - Kano</a></li>
</ul>
<p>We’ve constructed a single diagram showing all six samples available from IPUMS PMA, and we’ll demonstrate how to identify cases for each level in turn:</p>
<div class="page-break-after"></div>
<p><img src="images/consort.png" width="100%" style="display: block; margin: auto;" /></p>
<div id="chapter-setup" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Chapter Setup</h2>
<p>This chapter features a <strong>Wide</strong> longitudinal extract with all 6 of the available samples, including <strong>All Cases</strong> (Respondents and Non-respondents to Household and Female Questionnaires). As mentioned in Chapter 2, both phases are included with each sample when you request a longitudinal extract.</p>
<p><img src="images/select-samples2.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>Variables describing sample composition are located under the “Technical” topics heading. Our extract will contain all of the variables in the <a href="https://pma.ipums.org/pma-action/variables/group?id=tech_techvar">Technical Variables</a> and <a href="https://pma.ipums.org/pma-action/variables/group?id=tech_panel">Longitudinal Panel</a> subheadings shown:</p>
<p><img src="images/technical.png" width="85%" style="display: block; margin: auto;" /></p>
<p>Once you’ve finished selecting variables and downloaded an extract, you’ll receive two files: an <code>.xml</code> DDI codebook, and a <code>.dat.gz</code> data file. We’ve saved both of these files in a folder called “data” in our R Working Directory, so we’ll load them into R together with the <a href="https://tidyverse.tidyverse.org">tidyverse</a> and <a href="https://www.ipums.org">ipumsr</a> packages described in Chapter 1.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00086.xml&quot;</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00086.dat.gz&quot;</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="page-break-after"></div>
<p>We mentioned in Chapter 1 that variables in a <strong>Wide</strong> extract include a numeric suffix corresponding with a data collection phase. For example, you’ll find two versions of <a href="https://pma.ipums.org/pma-action/variables/SAMPLE#codes_section">SAMPLE</a>: <a href="https://pma.ipums.org/pma-action/variables/SAMPLE#codes_section">SAMPLE_1</a> represents the sample codes for Phase 1:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(SAMPLE_1)</span></code></pre></div>
<pre><code># A tibble: 5 × 2
  SAMPLE_1                                                                          n
  &lt;int+lbl&gt;                                                                     &lt;int&gt;
1 18012 [Congo, Democratic Republic (Kinshasa and Kongo Central) 2019 Baseline] 19245
2 40410 [Kenya 2019 Baseline]                                                   42708
3 56609 [Nigeria (Kano and Lagos) 2019 Baseline]                                12000
4 85409 [Burkina Faso 2019 Baseline]                                            30357
5    NA                                                                         98687</code></pre>
<p>Whereas <a href="https://pma.ipums.org/pma-action/variables/SAMPLE#codes_section">SAMPLE_2</a> represents the sample codes for Phase 2:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(SAMPLE_2)</span></code></pre></div>
<pre><code># A tibble: 5 × 2
  SAMPLE_2                                                                         n
  &lt;int+lbl&gt;                                                                    &lt;int&gt;
1 18015 [Congo, Democratic Republic (Kinshasa and Kongo Central) 2020 Phase 2] 23186
2 40413 [Kenya 2020 Phase 2]                                                   48975
3 56612 [Nigeria (Kano and Lagos) 2020 Phase 2]                                13227
4 85412 [Burkina Faso 2021 Phase 2]                                            33931
5    NA                                                                        83678</code></pre>
<div class="page-break-after"></div>
<p>We also mentioned in Chapter 1 that IPUMS PMA combines sub-nationally representative samples for DRC (Kinshasa and Kongo Central) and Nigeria (Kano and Lagos) with one <a href="https://pma.ipums.org/pma-action/variables/SAMPLE#codes_section">SAMPLE</a> code each. Here, we’ll separate those samples and abbreviate country names. Let’s call this variable <code>POP</code> (for “population of interest”).</p>
<ul>
<li><code>pop</code> - Population of interest</li>
</ul>
<p>We’ll combine the <a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a> name for each sample together with the DRC and Nigeria regions labelled in <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a> and <a href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a>, respectively.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Abbreviate &quot;DRC&quot; and combine `COUNTRY` with `GEOCD` and `GEONG`</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(COUNTRY, GEOCD, GEONG),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">as_factor</span>(.x) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">COUNTRY =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(COUNTRY, <span class="st">&quot;Congo&quot;</span>), <span class="st">&quot;DRC&quot;</span>, COUNTRY),</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP =</span> <span class="fu">case_when</span>(</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(GEOCD) <span class="sc">~</span> <span class="fu">paste</span>(COUNTRY, <span class="st">&quot;-&quot;</span>, GEOCD),</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(GEONG) <span class="sc">~</span> <span class="fu">paste</span>(COUNTRY, <span class="st">&quot;-&quot;</span>, GEONG),</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> COUNTRY</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(POP)</span></code></pre></div>
<pre><code># A tibble: 6 × 2
  POP                     n
  &lt;chr&gt;               &lt;int&gt;
1 Burkina Faso        57990
2 DRC - Kinshasa      20831
3 DRC - Kongo Central 17625
4 Kenya               83645
5 Nigeria - Kano      10970
6 Nigeria - Lagos     11936</code></pre>
</div>
<div id="phase-1" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Phase 1</h2>
<p>Phase 1 marks the beginning of the PMA panel study (baseline). As we’ve mentioned, it consists of two separate questionnaires administered in stages: first, resident enumerators visited 35 household dwellings selected at random within each sample cluster, or <strong>enumeration area</strong>. If a qualifying respondent was available, they were invited to complete a <a href="https://pma.ipums.org/pma/resources/questionnaires/hhf/PMA-Household-Questionnaire-English-2019.10.09.pdf">Household Questionnaire</a><span id="fn21" class="footnote" data-pagedown-footnote-number="21" style="white-space: pre-line;">Questionnaires administered in each country may vary from this <strong>Core Household Questionnaire</strong> - <a href="https://pma.ipums.org/pma/enum_materials.shtml">click here</a> for details.</span> including a census of all household members and visitors who stayed there during the night before the interview. If this census included any women aged 15-49, the enumerator would later return to the household and invite each eligible woman to complete a <a href="https://pma.ipums.org/pma/resources/questionnaires/hhf/PMA-Female-Questionnaire-English-2019.10.09.pdf">Female Questionnaire</a><span id="fn22" class="footnote" data-pagedown-footnote-number="22" style="white-space: pre-line;">Questionnaires administered in each country may vary from this <strong>Core Female Questionnaire</strong> - <a href="https://pma.ipums.org/pma/enum_materials.shtml">click here</a> for details.</span> and participate in the three-year panel study.</p>
<p>We’ll take a look at the inclusion criteria and missing data codes for each questionnaire, in turn.</p>
<div id="household-questionnaire" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Household Questionnaire</h3>
<p>In our <strong>Wide</strong> data extract, each <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN</a> is a woman who completed all or part of the Phase 1 Female Questionnaire and agreed to participate in the longitudinal panel study: as a result, you’ll find all of her Phase 1 responses and her Phase 2 responses together in <em>a single row</em>.</p>
<p>This is <em>not</em> the case for household members who are not, themselves, participants in the panel study. These household members are represented by <em>one row per phase</em>. For example, if a young child was listed on the Phase 1 Household Questionnaire, you’ll find details about their age in <a href="https://pma.ipums.org/pma-action/variables/AGEHQ#codes_section">AGEHQ_1</a>, their sex in <a href="https://pma.ipums.org/pma-action/variables/SEX#codes_section">SEX_1</a>, and their relationship to the head of household in <a href="https://pma.ipums.org/pma-action/variables/RELATE#codes_section">RELATE_1</a>. If you look in the same row for corresponding Phase 2 variables (<a href="https://pma.ipums.org/pma-action/variables/AGEHQ#codes_section">AGEHQ_2</a>, <a href="https://pma.ipums.org/pma-action/variables/SEX#codes_section">SEX_2</a>, and <a href="https://pma.ipums.org/pma-action/variables/RELATE#codes_section">RELATE_2</a>), you’ll find <code>NA</code> values even if the child still lived in the household at Phase 2: their Phase 2 data may be located in another row (with <code>NA</code> values listed for Phase 1), or it may not exist if the child was not listed on the Phase 2 household roster. It is not possible to link Phase 1 and Phase 2 responses for household members who were not participants in the panel study.</p>
<p>This explains why, for example, you’ll see a large number of <code>NA</code> values in <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_1</a>, which gives the result of the Phase 1 Household Questionnaire.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESULTHQ_1)</span></code></pre></div>
<pre><code># A tibble: 10 × 2
   RESULTHQ_1                         n
   &lt;int+lbl&gt;                      &lt;int&gt;
 1  1 [Completed]                103411
 2  2 [Not at home]                 210
 3  3 [Postponed]                     8
 4  4 [Refused]                     230
 5  5 [Partly completed]             47
 6  6 [Vacant or not a dwelling]     95
 7  7 [Destroyed]                    10
 8  8 [Not found]                     3
 9  9 [Absent extended period]      296
10 NA                             98687</code></pre>
<p>Close to half of the values in <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_1</a> are <code>NA</code>: these are household members for whom no linked Phase 2 data exists.</p>
<div class="page-break-after"></div>
<p>What about the other values in <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_1</a>? You’ll notice a range of outcomes including:</p>
<ul>
<li><code>1</code> - Completed</li>
<li><code>5</code> - Partly completed</li>
<li>several other codes giving the reason why no household interview occurred</li>
</ul>
<p>If no household interview occurred, PMA creates one row to represent the household in <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_1</a>. Otherwise, if the household roster was completed during the interview, PMA creates one row for each person on the roster.</p>
<p>In order to determine the proportion of households that completed all or part of the Household Questionnaire - or any other <strong>household-level statistics</strong> - you must count only one row per household. Each Phase 1 household receives a unique identifier in <a href="https://pma.ipums.org/pma-action/variables/HHID#codes_section">HHID_1</a> - this value is an empty string <code>""</code> for household members included only in Phase 2. All Phase 1 households have a unique <a href="https://pma.ipums.org/pma-action/variables/HHID#codes_section">HHID_1</a>, regardless of the outcome recorded in <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_1</a>.</p>
<p>Therefore, you can use <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a> to find the <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_1</a> outcome for each household via <a href="https://pma.ipums.org/pma-action/variables/HHID#codes_section">HHID_1</a>. To obtain the proportion of Phase 1 households that completed all or part of the questionnaire, we’ll first use <a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a> to drop Phase 2 households with the value <code>""</code>. Then, we’ll use <a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a> to include only the first row in each household. Finally, we’ll count the number of fully (code 1) or partly (code 5) completed questionnaires in <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_1</a> - the base R function <a href="https://rdrr.io/r/base/proportions.html">prop.table</a> derives proportions for these counts.</p>
<aside>
Across samples, 96.4% of households completed all or part of the Phase 1 Household Questionnaire.
</aside>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HHID_1 <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># drop Phase 2 households</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HHID_1) <span class="sc">%&gt;%</span>     </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># include only one row per household</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>            </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(RESULTHQ_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n))</span></code></pre></div>
<pre><code># A tibble: 2 × 3
  `RESULTHQ_1 %in% c(1, 5)`     n   prop
  &lt;lgl&gt;                     &lt;int&gt;  &lt;dbl&gt;
1 FALSE                       852 0.0365
2 TRUE                      22494 0.964 </code></pre>
<div class="page-break-after"></div>
<aside>
Total number of Phase 1 household members, per sample
</aside>
<p>It is also often useful to exclude non-interviewed households when calculating <strong>person-level statistics</strong>. In the first row of our CONSORT diagram above, we drop these households before we count the total number of sampled Phase 1 household members.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RESULTHQ_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(POP)</span></code></pre></div>
<pre><code># A tibble: 6 × 2
  POP                     n
  &lt;chr&gt;               &lt;int&gt;
1 Burkina Faso        30210
2 DRC - Kinshasa      10309
3 DRC - Kongo Central  8847
4 Kenya               42308
5 Nigeria - Kano       5722
6 Nigeria - Lagos      6062</code></pre>
</div>
<div id="female-questionnaire" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Female Questionnaire</h3>
<p>IPUMS PMA uses a <strong>non-response code</strong> labeled “Not interviewed (household questionnaire)” for variables related to questions that were only relevant if the Household Questionnaire was fully or partly completed. This includes <a href="https://pma.ipums.org/pma-action/variables/ELIGIBLE#codes_section">ELIGIBLE_1</a>, which indicates whether a particular household member was a woman aged 15-49 at Phase 1, and therefore eligible for the Phase 1 Female Questionnaire. If the household was not interviewed, eligibility for the Female Questionnaire could not be determined.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESULTHQ_1, ELIGIBLE_1)</span></code></pre></div>
<pre><code># A tibble: 12 × 3
   RESULTHQ_1                    ELIGIBLE_1                                         n
   &lt;int+lbl&gt;                     &lt;int+lbl&gt;                                      &lt;int&gt;
 1  1 [Completed]                 0 [No]                                        79091
 2  1 [Completed]                 1 [Yes, eligible female respondent]           24320
 3  2 [Not at home]              96 [Not interviewed (household questionnaire)]   210
 4  3 [Postponed]                96 [Not interviewed (household questionnaire)]     8
 5  4 [Refused]                  96 [Not interviewed (household questionnaire)]   230
 6  5 [Partly completed]          0 [No]                                           31
 7  5 [Partly completed]          1 [Yes, eligible female respondent]              16
 8  6 [Vacant or not a dwelling] 96 [Not interviewed (household questionnaire)]    95
 9  7 [Destroyed]                96 [Not interviewed (household questionnaire)]    10
10  8 [Not found]                96 [Not interviewed (household questionnaire)]     3
11  9 [Absent extended period]   96 [Not interviewed (household questionnaire)]   296
12 NA                            NA                                             98687</code></pre>
<p><a href="https://pma.ipums.org/pma-action/variables/RESULTLFQ#codes_section">RESULTLFQ_1</a> shows the result of the Female Questionnaire for eligible women. The <strong>non-response code</strong> “NIU (not in universe)” is used for household members who were not eligible.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESULTFQ_1)</span></code></pre></div>
<pre><code># A tibble: 9 × 2
  RESULTFQ_1                                         n
  &lt;int+lbl&gt;                                      &lt;int&gt;
1  1 [Completed]                                 23542
2  2 [Not at home]                                 427
3  3 [Postponed]                                    20
4  4 [Refused]                                     150
5  5 [Partly completed]                             49
6 10 [Incapacitated]                               145
7 96 [Not interviewed (household questionnaire)]   852
8 99 [NIU (not in universe)]                     79124
9 NA                                             98687</code></pre>
<div class="page-break-after"></div>
<aside>
Across samples, 96.9% of eligible women completed the Phase 1 Female Questionnaire.
</aside>
<p>You can calculate the proportion of eligible women who completed the Phase 1 Female Questionnaire like so:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ELIGIBLE_1 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># drop if ineligible </span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(RESULTFQ_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n))</span></code></pre></div>
<pre><code># A tibble: 2 × 3
  `RESULTFQ_1 %in% c(1, 5)`     n   prop
  &lt;lgl&gt;                     &lt;int&gt;  &lt;dbl&gt;
1 FALSE                       745 0.0306
2 TRUE                      23591 0.969 </code></pre>
<p>Our CONSORT diagram shows the total number of women who were eligible to participate in the panel study at Phase 1, after excluding women who:</p>
<aside>
Total number of eligible women, per sample, who completed all or part of the Phase 1 Female Questionnaire
</aside>
<ul>
<li>were members of a household where no Phase 1 Household Questionnaire was administered</li>
<li>were not eligible (aged 15-49)</li>
<li>did not complete at least part of the Phase 1 Female Questionnaire</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RESULTFQ_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(POP)</span></code></pre></div>
<pre><code># A tibble: 6 × 2
  POP                     n
  &lt;chr&gt;               &lt;int&gt;
1 Burkina Faso         6790
2 DRC - Kinshasa       2639
3 DRC - Kongo Central  1970
4 Kenya                9558
5 Nigeria - Kano       1127
6 Nigeria - Lagos      1507</code></pre>
<div class="page-break-after"></div>
<p>Enumerators invited these women to participate in Phase 2 of the panel study one year later. Only women who agreed to participate at that time are considered panel members at Phase 2, as shown in <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN_2</a>.<span id="fn23" class="footnote" data-pagedown-footnote-number="23" style="white-space: pre-line;">Women who completed the Phase 1 Female Questionnaire but declined to participate in the panel were given an opportunity to join the panel again at Phase 2 (if eligible). They are not panel members as shown in <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN_2</a>, but they may be listed as such in <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN_3#codes_section">PANELWOMAN_3</a> if they agree to participation in the panel going forward.</span></p>
<aside>
Total number of women, per sample, who consented at Phase 1 to the Phase 2 follow-up
</aside>
<p>Their responses to the panel invitation are recorded in <a href="https://pma.ipums.org/pma-action/variables/SURVEYWILLING#codes_section">SURVEYWILLING_1</a>. IPUMS PMA uses the <strong>non-response code</strong> “Not interviewed (female questionnaire)” to indicate women who were eligible, but not interviewed for the Female Questionnaire as shown in <a href="https://pma.ipums.org/pma-action/variables/RESULTLFQ#codes_section">RESULTLFQ_1</a>. Additionally, “No response or missing” is used for women who did not respond to the panel invitation.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SURVEYWILLING_1 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(POP)</span></code></pre></div>
<pre><code># A tibble: 6 × 2
  POP                     n
  &lt;chr&gt;               &lt;int&gt;
1 Burkina Faso         6597
2 DRC - Kinshasa       2578
3 DRC - Kongo Central  1920
4 Kenya                8897
5 Nigeria - Kano       1098
6 Nigeria - Lagos      1425</code></pre>
<aside class="nudge_down">
Across samples, 95.4% of women who completed the Phase 1 Female Questionnaire agreed to participate in panel follow-ups one year later.
</aside>
<p>Make sure to include “No response or missing” cases in the denominator when calculating the proportion of Phase 1 female respondents who agreed to participate in the panel follow-up:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RESULTFQ_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(SURVEYWILLING_1) <span class="sc">%&gt;%</span> </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n))</span></code></pre></div>
<pre><code># A tibble: 3 × 3
  SURVEYWILLING_1                 n    prop
  &lt;int+lbl&gt;                   &lt;int&gt;   &lt;dbl&gt;
1  0 [No]                      1023 0.0434 
2  1 [Yes]                    22515 0.954  
3 98 [No response or missing]    53 0.00225</code></pre>
</div>
</div>
<div id="phase-2" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Phase 2</h2>
<p>Both questionnaires were administered again in Phase 2, approximately one year after Phase 1. Resident enumerators visited the same dwellings where Phase 1 interviews occurred; if the woman’s household had moved elsewhere within the study area,<span id="fn24" class="footnote" data-pagedown-footnote-number="24" style="white-space: pre-line;">The “study area” is area within which resident enumerators should attempt to find panel women that have moved out of their Phase 1 dwelling. This may extend beyond the woman’s original EA as determined by in-country administrators - see <a href="https://www.pmadata.org/data/survey-methodology">PMA Phase 2 and Phase 3 Survey Protocol</a> for details.</span> enumerators used local contacts to find its new location. If found, they administered a Household Questionnaire including an updated household roster.</p>
<p>As we’ve mentioned, any woman aged 15-49 listed on the Phase 2 household roster was eligible to complete a Phase 2 Female Questionnaire. However, only women who completed all or part of a Phase 1 Female Questionnaire are considered members of the panel in <a href="https://pma.ipums.org/pma-action/variables/PANELWOMAN#codes_section">PANELWOMAN_2</a>.</p>
<div id="household-questionnaire-1" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Household Questionnaire</h3>
<p>Several variables are available to describe the <a href="https://pma.ipums.org/pma-action/variables/group?id=tech_panel">status of households</a> surveyed at Phase 2. As with Phase 1, <a href="https://pma.ipums.org/pma-action/variables/RESULTHQ#codes_section">RESULTHQ_2</a> describes the result of the Phase 2 Household Questionnaire.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESULTHQ_2)</span></code></pre></div>
<pre><code># A tibble: 10 × 2
   RESULTHQ_2                         n
   &lt;int+lbl&gt;                      &lt;int&gt;
 1  1 [Completed]                116955
 2  2 [Not at home]                 298
 3  3 [Postponed]                    15
 4  4 [Refused]                     425
 5  5 [Partly completed]             16
 6  6 [Vacant or not a dwelling]    861
 7  7 [Destroyed]                   227
 8  8 [Not found]                   209
 9  9 [Absent extended period]      313
10 NA                             83678</code></pre>
<p><a href="https://pma.ipums.org/pma-action/variables/SAMEDWELLING#codes_section">SAMEDWELLING_2</a> indicates whether the Household Questionnaire was administered at the same physical dwelling from Phase 1, or whether the enumerator located the woman’s household in a new dwelling.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(SAMEDWELLING_2)</span></code></pre></div>
<pre><code># A tibble: 6 × 2
  SAMEDWELLING_2                                      n
  &lt;int+lbl&gt;                                       &lt;int&gt;
1  0 [No]                                          7255
2  1 [Yes]                                       110973
3 95 [Not interviewed (female questionnaire)]        15
4 96 [Not interviewed (household questionnaire)]     19
5 99 [NIU (not in universe)]                       1057
6 NA                                              83678</code></pre>
<div class="page-break-after"></div>
<p>Each Phase 2 sample may also include new households that were not included in Phase 1, as indicated by <a href="https://pma.ipums.org/pma-action/variables/HHTYPE#codes_section">HHTYPE_2</a>: these are replacement households drawn for enumeration areas where more than 10% of Phase 1 households were no longer present. They account for all of the <strong>non-response code</strong> shown in <a href="https://pma.ipums.org/pma-action/variables/SAMEDWELLING#codes_section">SAMEDWELLING_2</a>, as no prior dwelling was sampled.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(SAMEDWELLING_2, HHTYPE_2)</span></code></pre></div>
<pre><code># A tibble: 6 × 3
  SAMEDWELLING_2                                 HHTYPE_2                            n
  &lt;int+lbl&gt;                                      &lt;int+lbl&gt;                       &lt;int&gt;
1  0 [No]                                         3 [Panel woman followup]        7255
2  1 [Yes]                                        1 [Phase 1 Dwelling]          110973
3 95 [Not interviewed (female questionnaire)]     2 [Replacement cross-section]     15
4 96 [Not interviewed (household questionnaire)]  2 [Replacement cross-section]     19
5 99 [NIU (not in universe)]                      2 [Replacement cross-section]   1057
6 NA                                             NA                              83678</code></pre>
<p>As mentioned above, it is not possible to link Phase 1 and Phase 2 records for household members who were not women participating in the panel study. However, the variable <a href="https://pma.ipums.org/pma-action/variables/HHMEMSTAT#codes_section">HHMEMSTAT_2</a> does describe whether a Phase 1 household member was listed on the household roster for Phase 2; if not, PMA creates a Phase 2 record for that person indicating whether they moved or were deceased.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(HHMEMSTAT_2)</span></code></pre></div>
<pre><code># A tibble: 10 × 2
   HHMEMSTAT_2                                        n
   &lt;int+lbl&gt;                                      &lt;int&gt;
 1  1 [Still a resident in household]             84402
 2  2 [Moved within EA]                            1155
 3  3 [Moved outside of EA]                        4815
 4  4 [Moved out of household for school]          1117
 5  5 [Deceased]                                    437
 6 95 [Not interviewed (female questionnaire)]      213
 7 96 [Not interviewed (household questionnaire)]  2337
 8 97 [Don&#39;t know]                                   30
 9 99 [NIU (not in universe)]                     24813
10 NA                                             83678</code></pre>
<div class="page-break-after"></div>
<p>After excluding women who reached age 50 at Phase 2, our CONSORT diagram diverges to show whether panel members were found in their Phase 1 dwelling or a new one. Women whose household was not found in the study area are considered <strong>lost to follow-up</strong>, as are those where the Phase 2 Household Questionnaire was not completed.</p>
<p>The variable <a href="https://pma.ipums.org/pma-action/variables/HHPANELP2#codes_section">HHPANELP2_2</a> indicates whether any woman who completed the Phase 1 Female Questionnaire was living in the dwelling at Phase 2. Women who were no longer residents of the household are also considered <strong>lost to follow-up</strong>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(HHPANELP2_2)</span></code></pre></div>
<pre><code># A tibble: 3 × 2
  HHPANELP2_2     n
  &lt;int+lbl&gt;   &lt;int&gt;
1  0 [No]     29587
2  1 [Yes]    89732
3 NA          83678</code></pre>
</div>
<div id="female-questionnaire-1" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Female Questionnaire</h3>
<p>Finally, eligible women who were found in a household at Phase 2 were invited to complete a Female Questionnaire. <a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ_2</a> indicates the result of the Phase 2 Female Questionnaire both for panel members and women who were otherwise eligible to participate.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(RESULTFQ_2)</span></code></pre></div>
<pre><code># A tibble: 11 × 2
   RESULTFQ_2                                         n
   &lt;int+lbl&gt;                                      &lt;int&gt;
 1  1 [Completed]                                 24756
 2  2 [Not at home]                                 343
 3  3 [Postponed]                                    40
 4  4 [Refused]                                     278
 5  5 [Partly completed]                             24
 6  7 [Respondent moved]                             57
 7 10 [Incapacitated]                               241
 8 95 [Not interviewed (female questionnaire)]        9
 9 96 [Not interviewed (household questionnaire)]  2337
10 99 [NIU (not in universe)]                     91234
11 NA                                             83678</code></pre>
<aside class="nudge_down">
<p>Across samples, 73.4% of women completing the Phase 2 Female Questionnaire also did so at Phase 1.</p>
26.6% are newcomers at Phase 2.
</aside>
<p>You can find the proportion of women who completed the Phase 2 Female Questionnaire that were also available at Phase 1 (i.e. panel members) like so:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(PANELWOMAN_2) <span class="sc">%&gt;%</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n))</span></code></pre></div>
<pre><code># A tibble: 2 × 3
  PANELWOMAN_2     n  prop
  &lt;int+lbl&gt;    &lt;int&gt; &lt;dbl&gt;
1 0 [No]        6576 0.266
2 1 [Yes]      18180 0.734</code></pre>
<p><strong>Wide</strong> data extracts make it particularly easy to combine Phase 1 and Phase 2 variables for the same woman. Note that potential panel members were identified at Phase 1: they are women who agreed to participate in <a href="https://pma.ipums.org/pma-action/variables/SURVEYWILLING#codes_section">SURVEYWILLING_1</a> and were under age 49 in <a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE_1</a>. In order to calculate the proportion of potential panel members who ultimately completed the Female Questionnaire at Phase 2, you must include Phase 1 female respondents for whom no Phase 2 data exists.</p>
<div class="page-break-after"></div>
<aside>
Across samples, 81.7% of potential panel members completed the Phase 2 Female Questionnaire.
</aside>
<p>These cases are marked <code>NA</code> in <a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ_2</a>, so they are easily included like so:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SURVEYWILLING_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> AGE_1 <span class="sc">&lt;</span> <span class="dv">49</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n))</span></code></pre></div>
<pre><code># A tibble: 3 × 3
  `RESULTFQ_2 == 1`     n   prop
  &lt;lgl&gt;             &lt;int&gt;  &lt;dbl&gt;
1 FALSE              2452 0.110 
2 TRUE              18180 0.817 
3 NA                 1632 0.0733</code></pre>
<aside class="nudge_down">
Total number and proportion of potential panel members, per Phase 1 sample, that ultimately completed a Phase 2 Female Questionnaire
</aside>
<p>The final row of our CONSORT diagram shows the total number of completed Phase 2 Female Questionnaires for each sample. The totals below match the results reported in each of the PMA User Guides published for individual samples.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SURVEYWILLING_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> AGE_1 <span class="sc">&lt;</span> <span class="dv">49</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">final =</span> RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(final) <span class="sc">%&gt;%</span> </span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>final)</span></code></pre></div>
<pre><code># A tibble: 6 × 3
# Groups:   POP [6]
  POP                     n  prop
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt;
1 Burkina Faso         5491 0.841
2 DRC - Kinshasa       2006 0.787
3 DRC - Kongo Central  1534 0.807
4 Kenya                7018 0.798
5 Nigeria - Kano       1001 0.923
6 Nigeria - Lagos      1130 0.808</code></pre>
</div>
</div>
<div id="summary" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Summary</h2>
<p>There are ultimately several causes of <strong>loss to follow-up</strong> that may occur at different time points throughout the panel study. An individual is considered <strong>lost to follow-up</strong> if:</p>
<ol style="list-style-type: decimal">
<li>The household moved out of the Phase 1 dwelling, and the new dwelling could not be located within the study area</li>
<li>The Phase 2 Household Questionnaire was not completed (a respondent refused, was not available, etc)</li>
<li>A panel member from the household was no longer a resident (deceased, moved, or status unknown)</li>
<li>A panel member did not complete a Phase 2 Household Questionnaire (she refused, was not available, etc)</li>
</ol>
<p>At the same time, the <strong>open panel design</strong> allows new participants to complete a Female Questionnaire at any phase. These women are not panel members at Phase 2, but they may become panel members at Phase 3 if they are eligible and agree to complete a forthcoming Phase 3 Female Questionnaire. Women can join the panel at Phase 2, for example, if they:</p>
<ol style="list-style-type: decimal">
<li>Reach age 15 only after Phase 1 interviews were completed</li>
<li>Move into a household sampled at Phase 2</li>
</ol>
<p>For more details on sample design, check out the IPUMS PMA <a href="https://pma.ipums.org/pma/sample_notes.shtml#long">sample notes</a> and User Guides published for individual samples at <a href="https://www.pmadata.org/">pmadata.org</a>.</p>
</div>
</div>
<div id="family-planning-indicators" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Family Planning Indicators</h1>
<p>In Chapter 4, we’ll demonstrate how to calculate key family planning indicators appearing in the <strong>PMA Longitudinal Brief</strong> for each of the longitudinal samples currently available from IPUMS PMA. The brief for each sample is linked below.</p>
<aside>
Chapter 5 includes code you can use to reproduce the <strong>alluvial plots</strong> seen in these briefs.
</aside>
<ul>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Burkina%20National_Phase%202_Panel_Results%20Brief_English_Final.pdf">Burkina Faso</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kinshasa_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC - Kinshasa</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kongo%20Central_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC - Kongo Central</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Kenya%20National_Phase%202_Panel%20Results%20Brief_Final.pdf">Kenya</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20KANO_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria - Kano</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20LAGOS_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria - Lagos</a></li>
</ul>
<p>Indicators calculated in this chapter cover topics like:</p>
<ul>
<li>pregnancy intentions and outcomes</li>
<li>current use of long-acting, short-acting, and traditional contraceptives</li>
<li>discontinuation of family planning</li>
<li>intentions for future use of family planning</li>
<li>unmet need for family planning</li>
<li>partner’s support for use of family planning</li>
</ul>
<p>As we demonstrate how to calculate these indicators, we will also compare population estimates between subgroups within each sample. This chapter demonstrates how to conduct a <strong>Rao-Scott chi-square test</strong> for significant differences between subgroups, but we will primarily rely on an informal comparison of confidence intervals plotted on <strong>grouped bar charts</strong>. This approach facilitates visual comparisons for several indicators repeated for multiple samples in the same IPUMS PMA data extract, but we’ll see that it produces somewhat conservative estimation of statistical difference compared to the chi-square test. We include both the formal and the informal-visual comparison, as each is useful in the appropriate context.</p>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="https://ggplot2.tidyverse.org/index.html">
<img src="images/hex/ggplot2.png"/>
</a>
<br/>
© RStudio, Inc.
<br/>
(MIT)
</div>
</aside>
<p>This chapter demonstrates how to build a single function capable of producing several similar bar charts for multiple indicators. To do so, we’ll use the <a href="https://ggplot2.tidyverse.org">ggplot2</a> package loaded with the <a href="https://tidyverse.tidyverse.org">tidyverse</a> toolkit for R. If you installed <a href="https://tidyverse.tidyverse.org">tidyverse</a> in Chapter 1, no additional installation is necessary to use <a href="https://ggplot2.tidyverse.org">ggplot2</a>. If not, we recommend installing the <a href="https://tidyverse.tidyverse.org">tidyverse</a> now:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<div id="chapter-setup-1" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Chapter Setup</h2>
<p>Chapter 4 features a <strong>Wide</strong> longitudinal extract with all six of the available samples. Unlike Chapter 3, the data extract used in this chapter includes only <strong>Female Respondents</strong>.</p>
<p><img src="images/samples.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>Following the steps outlined in Chapter 2, you’ll need to request a <code>.dat</code> (fixed-width) data extract with the following variables (<a href="https://pma.ipums.org/pma-action/faq#ques28">preselected</a> variables are included automatically).</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a> - Result of female questionnaire</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a> - Phase 2 female panel weight</li>
<li><a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a> - Household residence / membership</li>
<li><a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE</a> - Age in female questionnaire</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a> - Pregnancy status</li>
<li><a href="https://pma.ipums.org/pma-action/variables/BIRTHEVENT#codes_section">BIRTHEVENT</a> - Number of birth events</li>
<li><a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> - Highest level of school attended (4 categories)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/MARSTAT#codes_section">MARSTAT</a> - Marital status</li>
<li><a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a> - Province, DRC</li>
<li><a href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a> - State, Nigeria</li>
<li><a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a> - Contraceptive user</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> - Most effective current FP method</li>
<li><a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a> - Total unmet need</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPARTSUPPORT#codes_section">FPPARTSUPPORT</a> - Husband / partner would be supportive of FP use</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a> - When will start using FP method in the future - value</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a> - When will start using FP method in the future - unit</li>
<li><a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a> - PMA country (preselected)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID</a> - Enumeration area (preselected)</li>
</ul>
<p>Download and save your extract in the <code>data</code> folder of your R working directory, and then load the following packages together with your extract.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00106.xml&quot;</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00106.dat.gz&quot;</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Chapter 1 describes <strong>Inclusion Criteria for Analysis</strong>: to summarise, we’ll be focusing on members of the <em>de facto</em> population who participated in both phases of the panel study (excluding a small number of women marked “NIU (not in universe)” for a key measure of current contraceptive use recorded in <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>).</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>),</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    CP_1 <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">&amp;</span> CP_2 <span class="sc">&lt;</span> <span class="dv">90</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Recall that only the Burkina Faso and Kenya samples are <strong>nationally representative</strong>. Samples from DRC represent regions identified by <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a>, while samples from Nigeria represent regions identified by <a href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a>. In order to distinguish each population of interest, we’ll again define a custom variable <code>POP</code> that shows each sample’s <a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a> label concatenated with each of these regions where appropriate.</p>
<ul>
<li><code>POP</code> - Population of interest</li>
</ul>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">POP =</span> <span class="fu">case_when</span>(</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(GEOCD) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;DRC -&quot;</span>, <span class="fu">as_factor</span>(GEOCD)),</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(GEONG) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Nigeria -&quot;</span>, <span class="fu">as_factor</span>(GEONG)),</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as_factor</span>(COUNTRY) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>We’ll be using survey design information to derive population estimates throughout this chapter, so we’ll also need to use <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a> to update <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a> for DRC samples. As in Chapter 1, we create <code>STRATARC</code> using unique numeric codes from <a href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA_1</a>, except that we also include unique identifiers for each sampled region in <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a>.</p>
<ul>
<li><code>STRATARC</code> - Numeric codes for PMA sample strata (recoded for DRC samples)</li>
</ul>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">STRATARC =</span> <span class="fu">if_else</span>(</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(GEOCD), </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(STRATA_1), </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(GEOCD)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Finally, Chapter 1 demonstrates how to use survey design information to estimate the proportion of women in each population <code>POP</code> who were using a contraceptive method both at Phase 1 and at Phase 2. Let’s revisit that example again, expect that we’ll now estimate the proportion of users and non-users alike:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CP_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="page-break-after"></div>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>cp_tbl</span></code></pre></div>
<pre><code># A tibble: 24 × 6
# Groups:   POP [6]
   POP                 CP_1      CP_2        coef `_low` `_upp`
   &lt;chr&gt;               &lt;int+lbl&gt; &lt;int+lbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso        0 [No]    0 [No]    0.790  0.763  0.815 
 2 Burkina Faso        0 [No]    1 [Yes]   0.210  0.185  0.237 
 3 Burkina Faso        1 [Yes]   0 [No]    0.347  0.306  0.391 
 4 Burkina Faso        1 [Yes]   1 [Yes]   0.653  0.609  0.694 
 5 DRC - Kinshasa      0 [No]    0 [No]    0.739  0.685  0.787 
 6 DRC - Kinshasa      0 [No]    1 [Yes]   0.261  0.213  0.315 
 7 DRC - Kinshasa      1 [Yes]   0 [No]    0.275  0.239  0.314 
 8 DRC - Kinshasa      1 [Yes]   1 [Yes]   0.725  0.686  0.761 
 9 DRC - Kongo Central 0 [No]    0 [No]    0.736  0.685  0.782 
10 DRC - Kongo Central 0 [No]    1 [Yes]   0.264  0.218  0.315 
11 DRC - Kongo Central 1 [Yes]   0 [No]    0.270  0.207  0.343 
12 DRC - Kongo Central 1 [Yes]   1 [Yes]   0.730  0.657  0.793 
13 Kenya               0 [No]    0 [No]    0.697  0.676  0.717 
14 Kenya               0 [No]    1 [Yes]   0.303  0.283  0.324 
15 Kenya               1 [Yes]   0 [No]    0.200  0.183  0.217 
16 Kenya               1 [Yes]   1 [Yes]   0.800  0.783  0.817 
17 Nigeria - Kano      0 [No]    0 [No]    0.946  0.910  0.968 
18 Nigeria - Kano      0 [No]    1 [Yes]   0.0544 0.0321 0.0905
19 Nigeria - Kano      1 [Yes]   0 [No]    0.440  0.308  0.581 
20 Nigeria - Kano      1 [Yes]   1 [Yes]   0.560  0.419  0.692 
21 Nigeria - Lagos     0 [No]    0 [No]    0.757  0.713  0.796 
22 Nigeria - Lagos     0 [No]    1 [Yes]   0.243  0.204  0.287 
23 Nigeria - Lagos     1 [Yes]   0 [No]    0.240  0.196  0.290 
24 Nigeria - Lagos     1 [Yes]   1 [Yes]   0.760  0.710  0.804 </code></pre>
<aside class="nudge_down">
You may change the confidence interval to, for example, 99% by setting <code>level = 0.99</code> in <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>.
</aside>
<p>This table <code>cp_tbl</code> shows a population estimate for each row reported in the column <code>_coef</code>, while the columns <code>_low</code> and <code>_upp</code> report the limits of a 95% confidence interval. Comparing these confidence intervals gives us an informal, conservative way to test for a significant difference between outcomes for each <code>POP</code>: if the intervals for any pair of outcomes in the same sample include no common values, we’ll say that a significant difference exists.</p>
<p><em>Formal testing may also reveal significant differences between pairs of outcomes where these intervals overlap only slightly.</em> This informal comparison is well suited for data visualization, but it should not replace formal testing. Fortunately, you can adapt this code to replace (or complement) the output from <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a> with a formal test.</p>
</div>
<div id="significance-test" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Significance Test</h2>
<p>Continuing with the previous example, we will now demonstrate how to calculate a Rao-Scott chi-square test for significant differences between the estimated population proportions for each <code>POP</code> and the proportions we would <em>expect</em> to observe if Phase 2 outcomes were statistically independent from Phase 1 conditions.<span id="fn25" class="footnote" data-pagedown-footnote-number="25" style="white-space: pre-line;">The Rao-Scott second-order correction to Pearson’s chi-square test is used to incorporate survey design information from <a href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a>. Wald-type chi-square tests are also available: see <a href="https://rdrr.io/pkg/survey/man/svychisq.html">svychisq</a> for details.</span> Because we’re interested in just one summary statistic per sample, we no longer need to <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a> <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_1</a> and <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_2</a>; instead, we’ll use the formula <code>~CP_1 + CP_2</code> in the function <a href="https://rdrr.io/pkg/survey/man/svychisq.html">svychisq</a>. Elements of the chi-square test can be extracted <a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a> like so:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1,  <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">rao =</span> <span class="fu">svychisq</span>(<span class="sc">~</span>CP_1 <span class="sc">+</span> CP_2, <span class="at">design =</span> .) <span class="sc">%&gt;%</span> list)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">F</span><span class="st">`</span> <span class="ot">=</span> rao<span class="sc">$</span>statistic, <span class="at">p.value =</span> rao<span class="sc">$</span>p.value, <span class="at">sig95 =</span> p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span></code></pre></div>
<pre><code># A tibble: 6 × 5
# Rowwise: 
  POP                 rao          F   p.value sig95
  &lt;chr&gt;               &lt;list&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;lgl&gt;
1 Burkina Faso        &lt;htest&gt;  468.  4.62e- 50 TRUE 
2 DRC - Kinshasa      &lt;htest&gt;  216.  4.80e- 21 TRUE 
3 DRC - Kongo Central &lt;htest&gt;  123.  9.43e- 16 TRUE 
4 Kenya               &lt;htest&gt; 1140.  8.58e-102 TRUE 
5 Nigeria - Kano      &lt;htest&gt;   89.2 2.23e-  9 TRUE 
6 Nigeria - Lagos     &lt;htest&gt;  204.  2.85e- 19 TRUE </code></pre>
<p>For each <code>POP</code>, the <code>p.value</code> associated with our test falls below 0.05 (as indicated in <code>sig95</code>). This suggests that we may be at least 95% sure that the mean Phase 2 contraceptive use status for Phase 1 contraceptive users is not identical to the mean for non-users.</p>
</div>
<div id="data-visualization" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Data Visualization</h2>
<p>We’ll use simple <strong>grouped bar charts</strong> to show population estimates for each proportion calculated throughout the remainder of this chapter. We’ll also include <strong>error bars</strong> representing a 95% confidence interval for each proportion.</p>
<p>For example, let’s plot the estimates created in <code>cp_tbl</code> above. As a preliminary step, we’ll recode <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_1</a> and <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_2</a> with <a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a> and sort their levels with <a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a>. This ensures that the <em>value labels</em> for each variable will be printed on our plot.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="ot">&lt;-</span> cp_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(CP_1, CP_2), </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>.x <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>() <span class="sc">%&gt;%</span> <span class="fu">fct_relevel</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Next, we’ll use <a href="https://ggplot2.tidyverse.org">ggplot2</a> to build the plot. One of the powerful features of <a href="https://ggplot2.tidyverse.org">ggplot2</a> is that you can use <a href="https://ggplot2.tidyverse.org/reference/theme.html">pre-built themes</a> to customize this baseline layout. We’ll build on <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a> to create our own <code>theme_pma</code>.<span id="fn26" class="footnote" data-pagedown-footnote-number="26" style="white-space: pre-line;">This manual uses the proprietary font <a href="https://fonts.adobe.com/fonts/cabrito-sans">cabrito sans</a>, which is implemented in figures via the <a href="https://github.com/yixuan/showtext">showtext</a> package for R. You can purchase a license to use <a href="https://fonts.adobe.com/fonts/cabrito-sans">cabrito sans</a>, or substitute with a font of your choice.</span></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>theme_pma <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>() <span class="sc">%+replace%</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;cabrito&quot;</span>, <span class="at">size =</span> <span class="dv">42</span>),</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">72</span>, <span class="at">color =</span> <span class="st">&quot;#00263A&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>, </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">5</span>)),</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">10</span>), <span class="at">lineheight =</span> <span class="fl">0.3</span>),</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Because we’ll be constructing the same type of plot for each indicator, we’ll wrap this theme together with several <a href="https://ggplot2.tidyverse.org">ggplot2</a> functions we’ll want to reuse every time we make a plot. This prevents copy/paste errors and eliminates redundant code. We’ll call our custom function <code>pma_bars</code>.</p>
<div class="page-break-after"></div>
<p>We’ll design <code>pma_bars</code> to include all of the following <a href="https://ggplot2.tidyverse.org">ggplot2</a> functions:</p>
<ul>
<li><code>theme_pma</code> created above</li>
<li><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a> for plot labels (passed from function arguments)</li>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a> formatting for continuous x-axis labels</li>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a> formatting for discrete y-axis labels</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a> for grouped bars</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a> for error bars</li>
<li><a href="https://scales.r-lib.org/reference/label_percent.html">scales::label_percent</a> to format proportions as percentages<span id="fn27" class="footnote" data-pagedown-footnote-number="27" style="white-space: pre-line;"><a href="https://scales.r-lib.org">scales</a> is installed, but not loaded, with the <a href="https://tidyverse.tidyverse.org">tidyverse</a>.</span></li>
</ul>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>pma_bars <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,     <span class="co"># an optional title </span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="cn">NULL</span>,  <span class="co"># an optional subtitle </span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xaxis =</span> <span class="cn">NULL</span>,     <span class="co"># an optional label for the x-axis (displayed above)</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">yaxis =</span> <span class="cn">NULL</span>      <span class="co"># an optional label for the y-axis (displayed left)</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  components <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    theme_pma,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">toupper</span>(title),</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> subtitle,</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">str_wrap</span>(yaxis, <span class="dv">10</span>),</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NULL</span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="st">&#39;bottom&#39;</span>,</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>., <span class="at">name =</span> xaxis, <span class="at">breaks =</span> <span class="cn">NULL</span>),</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev),</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#98579BB0&quot;</span>),</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(</span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">_low</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">_upp</span><span class="st">`</span>), </span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="fl">0.2</span>, </span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;#00263A&quot;</span></span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="page-break-after"></div>
<p>Going forward, we’ll incorporate <code>pma_bars</code> together with a <a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a> and <a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet</a> function for a given set of variables like so:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CP_2)) <span class="sc">+</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP), <span class="at">cols =</span> <span class="fu">vars</span>(CP_1)) <span class="sc">+</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Change in Contracptive Use Status&quot;</span>,</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;A grouped bar chart, faceted by population of interest&quot;</span>,</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1&quot;</span>,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2&quot;</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/bar1.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="contraceptive-use-or-non-use" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Contraceptive Use or Non-Use</h2>
<p>Let’s continue our examination of <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>. In the PMA reports for each sample linked above, you’ll notice that women who were pregnant at either phase are distinguished from women who reported use or non-use in <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_1</a> or <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP_2</a>. We’ll identify these women in the variable <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a>, and then we’ll create a combined indicator called <code>FPSTATUS</code>.</p>
<ul>
<li><code>FPSTATUS</code> - Pregnant, using contraception, or using no contraception</li>
</ul>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPSTATUS_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>      PREGNANT_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Pregnant&quot;</span>,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Using FP&quot;</span>,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPSTATUS_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>      PREGNANT_2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Pregnant&quot;</span>,</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>      CP_2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Using FP&quot;</span>,</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>      CP_2 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(FPSTATUS_1, FPSTATUS_2),</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>.x <span class="sc">%&gt;%</span> <span class="fu">fct_relevel</span>(<span class="st">&quot;Pregnant&quot;</span>, <span class="st">&quot;Not Using FP&quot;</span>, <span class="st">&quot;Using FP&quot;</span>)</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We’ll now revise <code>cp_tbl</code> to include information from <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>. This will help us answer key questions like:</p>
<ul>
<li>Are women who were pregnant at Phase 1 more likely to use or not use family planning at Phase 2?</li>
<li>Are women who were using (or not using) contraception at Phase 1 likely to maintain the same status at Phase 2?</li>
</ul>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPSTATUS_1, FPSTATUS_2) <span class="sc">%&gt;%</span> </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="page-break-after"></div>
<p>This new version of <code>cp_tbl</code> includes the labels we assigned to <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>. The first dozen rows are shown below.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>cp_tbl</span></code></pre></div>
<pre><code># A tibble: 54 × 6
# Groups:   POP [6]
   POP            FPSTATUS_1   FPSTATUS_2     coef `_low` `_upp`
   &lt;chr&gt;          &lt;fct&gt;        &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso   Pregnant     Pregnant     0.0302 0.0137 0.0652
 2 Burkina Faso   Pregnant     Not Using FP 0.568  0.491  0.642 
 3 Burkina Faso   Pregnant     Using FP     0.401  0.329  0.478 
 4 Burkina Faso   Not Using FP Pregnant     0.0779 0.0651 0.0929
 5 Burkina Faso   Not Using FP Not Using FP 0.739  0.711  0.765 
 6 Burkina Faso   Not Using FP Using FP     0.183  0.158  0.211 
 7 Burkina Faso   Using FP     Pregnant     0.0993 0.0815 0.121 
 8 Burkina Faso   Using FP     Not Using FP 0.248  0.213  0.287 
 9 Burkina Faso   Using FP     Using FP     0.653  0.609  0.694 
10 DRC - Kinshasa Pregnant     Pregnant     0.0367 0.0140 0.0930
11 DRC - Kinshasa Pregnant     Not Using FP 0.464  0.338  0.594 
12 DRC - Kinshasa Pregnant     Using FP     0.500  0.370  0.629 
# … with 42 more rows</code></pre>
<p>Next, we’ll plot <code>cp_tbl</code> with <code>pma_bars</code>.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> FPSTATUS_2)) <span class="sc">+</span> </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(FPSTATUS_1), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE USE OR NON-USE&quot;</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent women age 15-49 who changed contraceptive use status&quot;</span>,</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1&quot;</span>,</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2&quot;</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/bar2.png" width="100%" style="display: block; margin: auto;" /></p>
<p>To reiterate: comparing the error bars within each of these 18 panels gives us a informal, but conservative test for significant difference. We’ll say that a significant difference occurs where two pairs of error bars <strong>do not overlap</strong> (but additional testing may be necessary to determine whether a significant difference occurs where error bars overlap only slightly). A few observations:</p>
<ul>
<li>For women who were pregnant at Phase 1, there is usually no apparent difference between using and not using family planning at Phase 2. Kenya and Nigeria - Kano are the exception: in Kenya, pregnant women at Phase 1 were appear more likely to be using FP at Phase 2, while the opposite is true in Kano.<br />
</li>
<li>Overall, non-pregnant women at Phase 1 appeared more likely to maintain the same status (use or non-use) at Phase 2 than they were to switch or become pregnant.</li>
</ul>
</div>
<div id="contraceptive-method-type" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Contraceptive Method Type</h2>
<p>PMA surveys also ask contraceptive users to indicate which method they are currently using at each phase of the study. If a woman reports using more than one method, <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETH#codes_section">FPCURREFFMETH</a> shows her most <em>effective</em> currently used method. These responses are combined with detailed information about use of the lactational amenorrhea method (LAM), emergency contraception, or injectable type in <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>. PMA reports use <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> to determine whether each woman’s most effective current method is a short-acting, long-acting, or traditional method.</p>
<p>Long-acting methods include:</p>
<ul>
<li>IUDs</li>
<li>implants</li>
<li>male sterilization</li>
<li>female sterilization</li>
</ul>
<p>Short-acting methods include:</p>
<ul>
<li>injectables (intramuscular and subcutaneous)</li>
<li>the pill</li>
<li>emergency contraception</li>
<li>male condoms</li>
<li>female condoms</li>
<li>LAM</li>
<li>diaphragm</li>
<li>foam/jelly</li>
<li>standard days method</li>
</ul>
<p>Traditional methods include:</p>
<ul>
<li>rhythm</li>
<li>withdrawal</li>
<li>other traditional</li>
</ul>
<p>Women who were using no method are “NIU (not in universe)”.</p>
<div class="page-break-after"></div>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(FPCURREFFMETHRC_1)</span></code></pre></div>
<pre><code># A tibble: 19 × 2
   FPCURREFFMETHRC_1                             n
   &lt;int+lbl&gt;                                 &lt;int&gt;
 1 101 [Female Sterilization]                  198
 2 102 [Male Sterilization]                      1
 3 111 [Implants]                             2248
 4 112 [IUD]                                   226
 5 121 [Injectables (3 months)]               1412
 6 123 [Injectables (Sayana Press)]            296
 7 131 [Pill]                                  547
 8 132 [Emergency Contraception]               243
 9 141 [Male condom]                           791
10 142 [Female condom]                           1
11 151 [Diaphragm]                               1
12 152 [Foam]                                    1
13 160 [Standard Days/Cycle Beads Method]       70
14 170 [Lactational amenorrhea method (LAM)]    24
15 210 [Rhythm]                                569
16 220 [Withdrawal]                            351
17 240 [Other traditional]                     153
18 998 [No response or missing]                  1
19 999 [NIU (not in universe)]               10572</code></pre>
<p>We’ll use <a href="https://dplyr.tidyverse.org/reference/across.html">across</a> to recode the Phase 1 and Phase 2 versions of <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> simultaneously. We’ll also attach the prefix <code>CAT</code> to each variable, indicating that we’ve created “categorized” versions of each.</p>
<ul>
<li><code>CAT_FPCURREFFMETHRC</code> - Contraceptive method type (4 categories)</li>
</ul>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(FPCURREFFMETHRC_1, FPCURREFFMETHRC_2),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">case_when</span>(</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">&lt;</span> <span class="dv">120</span> <span class="sc">~</span> <span class="st">&quot;long-acting&quot;</span>,</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">&quot;short-acting&quot;</span>,</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">&lt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;traditional&quot;</span>,</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;none&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fct_relevel</span>( <span class="st">&quot;long-acting&quot;</span>, <span class="st">&quot;short-acting&quot;</span>, <span class="st">&quot;traditional&quot;</span>, <span class="st">&quot;none&quot;</span>),</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">&quot;CAT_{.col}&quot;</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<div class="page-break-after"></div>
<p>Next, we’ll generate population estimates for our derived variables, <code>CAT_FPCURREFFMETHRC_1</code> and <code>CAT_FPCURREFFMETHRC_2</code>.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>meth_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_FPCURREFFMETHRC_1, CAT_FPCURREFFMETHRC_2) <span class="sc">%&gt;%</span> </span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>meth_tbl</span></code></pre></div>
<pre><code># A tibble: 95 × 6
# Groups:   POP [6]
   POP          CAT_FPCURREFFMETHRC_1 CAT_FPCURREFFMETHRC_2    coef  `_low` `_upp`
   &lt;chr&gt;        &lt;fct&gt;                 &lt;fct&gt;                   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso long-acting           long-acting           0.680   0.629   0.727 
 2 Burkina Faso long-acting           short-acting          0.0658  0.0448  0.0955
 3 Burkina Faso long-acting           traditional           0.00611 0.00325 0.0115
 4 Burkina Faso long-acting           none                  0.248   0.196   0.308 
 5 Burkina Faso short-acting          long-acting           0.0584  0.0367  0.0917
 6 Burkina Faso short-acting          short-acting          0.465   0.405   0.526 
 7 Burkina Faso short-acting          traditional           0.0328  0.0205  0.0519
 8 Burkina Faso short-acting          none                  0.444   0.382   0.507 
 9 Burkina Faso traditional           long-acting           0.0635  0.0215  0.174 
10 Burkina Faso traditional           short-acting          0.217   0.121   0.357 
11 Burkina Faso traditional           traditional           0.302   0.178   0.464 
12 Burkina Faso traditional           none                  0.418   0.289   0.558 
# … with 83 more rows</code></pre>
<p>And, we’ll again use <code>pma_bars</code> to plot the results.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>meth_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_FPCURREFFMETHRC_2)) <span class="sc">+</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CAT_FPCURREFFMETHRC_1), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE METHOD TYPE&quot;</span>,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who changed contraceptive method or use status&quot;</span>,</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1&quot;</span>,</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2&quot;</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/bar3.png" width="100%" style="display: block; margin: auto;" /></p>
<p>What do we learn from this plot? Let’s consider each column in turn:</p>
<ul>
<li>Users of “long-acting” methods at Phase 1 appear more likely to have used “long-acting” methods at Phase 2 than to have changed status (except perhaps in Kano, where the intervals for “long-acting” and “none” overlap at Phase 2).</li>
<li>Users of “short-acting” methods at Phase 1 appeared generally likely to use them again at Phase 2, but some samples show that women are equally likely to be using “none” at Phase 2. A difference between these two outcomes is visually apparent only in Kinshasa, Kenya, and Lagos (where women were more likely to be using “short-acting” methods than “none”).</li>
<li>The status of Phase 1 “traditional” users is generally unclear at Phase 2. In Kinshasa, Kongo Central, and Lagos, these women seem most likely to remain “traditional” users at Phase 2. Elsewhere, there are no clear trends.</li>
<li>Users of “none” at Phase 1 were clearly most likely to remain as such at Phase 2.</li>
</ul>
</div>
<div id="contraceptive-dynamics-by-subgroup" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Contraceptive Dynamics by Subgroup</h2>
<p>We can also use <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> to see whether women switched methods, stopped using any method, started using any method, or made no changes. Let’s summarize this information as <code>CHG_FPCURR</code>:</p>
<ul>
<li><code>CHG_FPCURR</code> - Change in contraceptive use between Phase 1 and Phase 2</li>
</ul>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CHG_FPCURR =</span> <span class="fu">case_when</span>(</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">&amp;</span> FPCURREFFMETHRC_2 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;Continued non-use&quot;</span>,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;Started using&quot;</span>,</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_2 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;Stopped using&quot;</span>,</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">!=</span> FPCURREFFMETHRC_2 <span class="sc">~</span> <span class="st">&quot;Changed methods&quot;</span>,</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">==</span> FPCURREFFMETHRC_2 <span class="sc">~</span> <span class="st">&quot;Continued method&quot;</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>PMA reports disaggregate the outcomes captured in <code>CHG_FPCURR</code> by age, marital status, education level, and parity (number of live childbirths).</p>
<div id="age" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Age</h3>
<p>We’ll use PMA’s categorization of <a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE_2</a> to examine differences between women in three categories.</p>
<ul>
<li><code>CAT_AGE_2</code> - Phase 2 age (3 categories)</li>
</ul>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_AGE_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>      AGE_2 <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&quot;15-19&quot;</span>,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>      AGE_2 <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">&quot;20-24&quot;</span>,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;25-49&quot;</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Plotting <code>CAT_AGE_2</code> on the y-axis allows us to compare confidence intervals across age groups. For example, notice that women aged 15-19 in every population seem more likely to continue non-use than women who are aged 20-24 or 25-49 (column 3).</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_AGE_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_AGE_2)) <span class="sc">+</span> </span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(<span class="st">&quot;CHANGE IN CONTRACEPTIVEUSE STATUS, BY AGE AT PHASE 2&quot;</span>)</span></code></pre></div>
<p><img src="images/bar4.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="education-level" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Education level</h3>
<p>The variable <a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> standardizes educational categories across countries (see <a href="https://pma.ipums.org/pma-action/variables/EDUCATT#codes_section">EDUCATT</a> for country-specific codes). To match PMA reports, we’ll recode <a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> into just three groups:</p>
<ul>
<li><code>CAT_EDUCATTGEN_2</code> - Phase 2 education level (3 categories)</li>
</ul>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_EDUCATTGEN_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>      EDUCATTGEN_2 <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;None / Primary&quot;</span>,</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>      EDUCATTGEN_2 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;Secondary&quot;</span>,</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>      EDUCATTGEN_2 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">&quot;Tertiary&quot;</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>As with age, we’ll plot <code>CAT_EDUCATTGEN_2</code> on the y-axis. There aren’t many clear takeaways here: confidence intervals overlap in each column for almost every education level, so visual inspection reveals no clear significant differences:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EDUCATTGEN_2 <span class="sc">&lt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> <span class="co"># drop if missing </span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_EDUCATTGEN_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_EDUCATTGEN_2)) <span class="sc">+</span> </span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(<span class="st">&quot;CHANGE IN CONTRACEPTIVEUSE STATUS, BY EDUCATION LEVEL AT PHASE 2&quot;</span>)</span></code></pre></div>
<p><img src="images/bar5.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="marital-status" class="section level3" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Marital status</h3>
<p>The variable <a href="https://pma.ipums.org/pma-action/variables/MARSTAT#codes_section">MARSTAT</a> indicates each woman’s marital / partnership status. PMA considers women “in union” to be those who are currently married (code <code>21</code>) or currently living with their partner (code <code>22</code>). Otherwise, women who were never married, divorced / separated, or widowed are considered “not in union”.</p>
<ul>
<li><code>CAT_MARSTAT_2</code> - Phase 2 marital status (2 categories)</li>
</ul>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_MARSTAT_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>      MARSTAT_2 <span class="sc">%in%</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">22</span> <span class="sc">~</span> <span class="st">&quot;In union&quot;</span>,</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Not in union&quot;</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Here, we see that women who were <em>not</em> in a union at Phase 2 were significantly more likely to continue non-use of contraception compared to married / partnered women in each population. On the other hand, women who <em>were</em> in a union mainly appeared more likely to continue using the same method, or perhaps to change methods (most clearly in Kenya).</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_MARSTAT_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_MARSTAT_2)) <span class="sc">+</span> </span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(<span class="st">&quot;CHANGE IN CONTRACEPTIVE METHOD TYPE, BY MARITAL STATUS AT PHASE 2&quot;</span>)</span></code></pre></div>
<p><img src="images/bar6.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="parity" class="section level3" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> Parity</h3>
<p>Parity refers to the number of times a women has given live birth (excluding stillbirths). This information is recorded in the IPUMS variable <a href="https://pma.ipums.org/pma-action/variables/BIRTHEVENT#codes_section">BIRTHEVENT</a>, in which the values <code>0</code> and <code>99</code> (not in universe) can both be interpreted as “none”.</p>
<ul>
<li><code>CAT_BIRTHEVENT_2</code> - Phase 2 number of live births (4 categories)</li>
</ul>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_BIRTHEVENT_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">99</span>) <span class="sc">~</span> <span class="st">&quot;None&quot;</span>,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">&quot;One-two&quot;</span>,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="st">&quot;Three-four&quot;</span>,</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;Five +&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct_relevel</span>(<span class="st">&quot;None&quot;</span>, <span class="st">&quot;One-two&quot;</span>, <span class="st">&quot;Three-four&quot;</span>, <span class="st">&quot;Five +&quot;</span>)</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>There are few clear patterns related to parity, except that women who have never given birth are also more likely to continue non-use of contraception between phases.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(BIRTHEVENT_2 <span class="sc">!=</span> <span class="dv">98</span>) <span class="sc">%&gt;%</span> <span class="co"># drops 2 missing cases (code 98)</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_BIRTHEVENT_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_BIRTHEVENT_2)) <span class="sc">+</span> </span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(<span class="st">&quot;CHANGE IN CONTRACEPTIVE METHOD TYPE, BY PARITY AT PHASE 2&quot;</span>)</span></code></pre></div>
<p><img src="images/bar7.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="outcomes-for-phase-1-non-users" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Outcomes for Phase 1 Non-users</h2>
<p>The final page in each PMA report covers family planning dynamics related to unmet need, partner support, and plans for future use of family planning methods. In each case, we’ll be focusing on women who were <em>not</em> using any method at Phase 1. We’ll show how each of these dynamics impacts the likelihood that Phase 1 non-users would have adopted any family planning method at Phase 2.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CP_1 <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<div id="unmet-need" class="section level3" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Unmet need</h3>
<p>PMA defines unmet need for family planning according to each woman’s fertility preferences, current use of family planning methods, and risk factors for pregnancy. Women may have “unmet need” for birth spacing (e.g. pregnant women whose pregnancy was mistimed) or for limiting births (e.g. pregnant women whose pregnancy was unwanted), while women are considered “not at risk” if they are not sexually active or cannot become pregnant. The variable <a href="https://pma.ipums.org/pma-action/variables/UNMETNEED#codes_section">UNMETNEED</a> provides detailed information on types of need for each woman, and on related variables that were used to calculate unmet need.</p>
<p>The binary variable <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a> recodes <a href="https://pma.ipums.org/pma-action/variables/UNMETNEED#codes_section">UNMETNEED</a> as either “Unmet need”, or “No unmet need”. We’ll reword these labels only slightly to minimize the amount of repeated text on our plot:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">UNMETYN_1 =</span> <span class="fu">if_else</span>(UNMETYN_1 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(UNMETYN_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CP_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> UNMETYN_1)) <span class="sc">+</span> </span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;UNMET NEED FOR FAMILY PLANNING&quot;</span>,</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who were not using a method at Phase 1&quot;</span>,</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 2: Adopted a method&quot;</span>,</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 1: Unmet Need&quot;</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="images/bar8.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Overall, these results suggest that non-users with unmet need for family planning at Phase 1 were more likely to adopt a method at Phase 2 compared to non-users who had none (e.g. women who were not sexually active, could not become pregnant, etc.). However, formal testing is needed to determine whether these trends were statistically significant in Burkina Faso and Nigeria - Kano.</p>
</div>
<div id="partner-support" class="section level3" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Partner support</h3>
<p>Women who were not using family planning and not pregnant at Phase 1 were asked whether they thought their husband / partner would be supportive of use of family planning in the future. These results are recorded in <a href="https://pma.ipums.org/pma-action/variables/FPPARTSUPPORT#codes_section">FPPARTSUPPORT</a>. We’ll exclude non-partnered women here, as they are “NIU (not in universe)”.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FPPARTSUPPORT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">97</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FPPARTSUPPORT_1 =</span> FPPARTSUPPORT_1 <span class="sc">%&gt;%</span> as_factor) <span class="sc">%&gt;%</span> </span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPPARTSUPPORT_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CP_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> FPPARTSUPPORT_1)) <span class="sc">+</span> </span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;PARTNER SUPPORT FOR FAMILY PLANNING&quot;</span>,</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who were not using a method at Phase 1&quot;</span>,</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 2: Adopted a method&quot;</span>,</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 1: Partner would support FP&quot;</span></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/bar9.png" width="100%" style="display: block; margin: auto;" /></p>
<p>We’ve included responses for women who were unsure whether their partner would or would not support future use of FP (“Don’t know”), but Phase 2 outcomes for these women were usually not visually distinct from those who answered “Yes” or “No”. Formal testing is needed to determine whether any significant differences exist.</p>
<p>Setting aside women who answered “Don’t know”, women with Phase 1 partner support in DRC - Kongo Central and Kenya (“Yes”) were more likely to adopt a method than those without (“No”). Outcomes for women in other populations are not visibly different based on partner support, one way or the other (again, formal testing may prove otherwise).</p>
</div>
<div id="intentions" class="section level3" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> Intentions</h3>
<p>Lastly, we’ll demonstrate the impact of women’s plans for future family planning use at Phase 1. The variable <a href="https://pma.ipums.org/pma-action/variables/FPUSPLAN#codes_section">FPUSPLAN</a> indicates whether women had plans for future use <em>at any point</em> in the future, but here we’ll consider whether women had plans to adopt a method <em>within the next year</em> to correspond with the timing of Phase 2 surveys.</p>
<p>There are two variables that describe the approximate time when women said they would adopt a family planning method (if at all). <a href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a> contains a raw number that should be matched with a <em>unit</em> of time (months, years) or a categorical response (“soon / now”, “after the birth of this child”) in <a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a>:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(FPPLANWHEN_1)</span></code></pre></div>
<pre><code># A tibble: 7 × 2
  FPPLANWHEN_1                           n
  &lt;int+lbl&gt;                          &lt;int&gt;
1  1 [Months]                          932
2  2 [Years]                          3039
3  3 [Soon / Now]                      685
4  4 [After the birth of this child]   338
5 97 [Don&#39;t know]                      893
6 98 [No response or missing]           18
7 99 [NIU (not in universe)]          4668</code></pre>
<p>We’ll create <code>FPPLANYR_1</code> to indicate whether each woman planned to use family planning within a year’s time at Phase 1.</p>
<ul>
<li><code>FPPLANYR_1</code> - Phase 1 plans to use FP within one year</li>
</ul>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPPLANYR_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> FPPLANVAL_1 <span class="sc">&lt;=</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, <span class="co"># Within 12 months </span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> FPPLANVAL_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, <span class="co"># Within 1 year</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, <span class="co"># Soon / now or after current pregnancy</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;No&quot;</span> <span class="co"># Includes date unknown, no response, or no intention (FPUSPLAN)</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Our final plot shows the difference in FP adoption between women who planned to do so within the year, compared with women with no such plans.</p>
<div class="page-break-after"></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span> </span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPPLANYR_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CP_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> FPPLANYR_1)) <span class="sc">+</span> </span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;INTENTION TO USE FAMIILY PLANNING WITHIN ONE YEAR&quot;</span>,</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who were not using a method at Phase 1&quot;</span>,</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 2: Adopted a method&quot;</span>,</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 1: Plan to use FP&quot;</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/bar10.png" width="90%" style="display: block; margin: auto;" /></p>
<p>In every population, Phase 1 non-users who planned to adopt a method by Phase 2 were significantly more likely to do so. However, a significant <em>majority</em> of Phase 1 non-users with plans to adopt a method actually did so only in Kenya, where the 95% confidence interval for “Yes” responses includes only proportions greater than the 50% threshold.</p>
</div>
</div>
<div id="limitations" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Limitations</h2>
<p>As we’ve seen, <strong>grouped bar charts</strong> give us a simple way to identify clear differences between Phase 2 outcomes for subgroups defined by baseline family planning conditions or key demographic features. Additionally, when we <strong>facet</strong> populations of interest on the same axis, we can easily compare differences between subgroups for many samples in a single figure.</p>
<p>One drawback to this approach is that it’s more conservative than formal statistical tests. We are not able to easily spot differences near the conventional 95% certainty threshold. However, we demonstrated how you can adapt our code to conduct formal hypothesis tests like the <a href="https://rdrr.io/cran/survey/man/svychisq.html">Rao-Scott chi-square test</a> for proportions in a complex survey sample.</p>
<p>Another drawback to this approach is that we’ve been unable to showcase estimates for the proportion of responses at any <em>one</em> phase of the study. For example, in our last figure, we estimated that about 35% of women who <em>planned to use</em> contraception within the year at Phase 1 did so at Phase 2; our figure does not show how many women planned to use contraception within the year <em>as a share of the Phase 1 population</em>.</p>
<p>To better understand the change over time relative to the size of each subgroup in our analysis, we’ll turn to a slightly more complicated data visualization method. In Chapter 5, we’ll show how to create <strong>alluvial plots</strong>, like those shown in the first two pages of each PMA report.</p>
</div>
</div>
<div id="advanced-data-visualization" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Advanced Data Visualization</h1>
<p>In Chapter 4, we demonstrated how to calculate key family planning indicators and plot our estimates in a way that allows the reader to compare confidence intervals for each population.</p>
<p>Chapter 5 digs into some of the other data visualization tools that are commonly used for two-phase panel data: this will include color-coded crosstabs - or <strong>heatmaps</strong> - and <strong>alluvial plots</strong> resembling those shown in the PMA Longitudinal Brief for each panel survey.</p>
<p>R users can build heatmaps with the same <a href="https://ggplot2.tidyverse.org">ggplot2</a> package featured in Chapter 4, but alluvial plots are a bit more challenging. To make things easier, we’ll build ours with <a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a>, an extension package for <a href="https://ggplot2.tidyverse.org">ggplot2</a> that includes tools designed specifically for alluvial plots.<span id="fn28" class="footnote" data-pagedown-footnote-number="28" style="white-space: pre-line;"><a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a> © Cory Brunson et al. (GPL-3)</span></p>
<div id="chapter-setup-2" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Chapter Setup</h2>
<p>In addition to <a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a>, we’ll also load three packages featured throughout this manual: <a href="https://tidyverse.tidyverse.org">tidyverse</a>, <a href="https://www.ipums.org">ipumsr</a>, and <a href="http://gdfe.co/srvyr/">srvyr</a>.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalluvial)</span></code></pre></div>
<p>This chapter features the same data extract showcased in Chapter 4, which includes all six of the available samples. It is organized in <strong>Wide</strong> format with only <strong>Female Respondents</strong> selected. This chapter focuses on the following variables included in that extract:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a> - Result of female questionnaire</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a> - Phase 2 female panel weight</li>
<li><a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a> - Household residence / membership</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a> - Pregnancy status</li>
<li><a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a> - Province, DRC</li>
<li><a href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a> - State, Nigeria</li>
<li><a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a> - Contraceptive user</li>
<li><a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a> - PMA country (preselected)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID</a> - Enumeration area (preselected)</li>
</ul>
<p>Recall that our analysis in Chapter 4 concerned only <em>de facto</em> panel members who completed all or part of the Female Questionnaire in both Phase 1 and Phase 2. We also excluded women who are marked “NIU (not in universe)” for a key question concerning current contraceptive use (<a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>). As a reminder, you can load the extract into R and select relevant cases like so:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import the data extract and metadata files</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00106.xml&quot;</span>,</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00106.dat.gz&quot;</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inclusion criteria for analysis</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>    RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>,  <span class="co"># must have completed Phase 1 FQ</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>    RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> <span class="co"># must be de facto population (both phases)</span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>      RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>),</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>    CP_1 <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">&amp;</span> CP_2 <span class="sc">&lt;</span> <span class="dv">90</span> <span class="co"># must answer &quot;current FP use&quot; question (both phases)</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<div class="page-break-after"></div>
<p>Additionally, we will reference four variables created in Chapter 4:</p>
<ul>
<li><code>POP</code> - Population of interest</li>
<li><code>STRATARC</code> - Numeric codes for PMA sample strata (recoded for DRC samples)</li>
<li><code>FPSTATUS_1</code> - Pregnant, using contraception, or using no contraception at Phase 1</li>
<li><code>FPSTATUS_2</code> - Pregnant, using contraception, or using no contraception at Phase 2</li>
</ul>
<p>These variables were created like so:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># custom variables: `POP` and `FPSTATUS`</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Population of interest (country + region, where applicable)</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP =</span> <span class="fu">case_when</span>(</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(GEOCD) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;DRC -&quot;</span>, <span class="fu">as_factor</span>(GEOCD)),</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(GEONG) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Nigeria -&quot;</span>, <span class="fu">as_factor</span>(GEONG)),</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as_factor</span>(COUNTRY) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># strata: includes placeholder values for DRC regions </span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">STRATARC =</span> <span class="fu">if_else</span>(</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(GEOCD), </span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(STRATA_1), </span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(GEOCD)</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Family planning use-status at Phase 1 </span></span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPSTATUS_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>      PREGNANT_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Pregnant&quot;</span>,</span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Using FP&quot;</span>,</span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Family planning use-status at Phase 2 </span></span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPSTATUS_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>      PREGNANT_2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Pregnant&quot;</span>,</span>
<span id="cb142-25"><a href="#cb142-25" aria-hidden="true" tabindex="-1"></a>      CP_2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Using FP&quot;</span>,</span>
<span id="cb142-26"><a href="#cb142-26" aria-hidden="true" tabindex="-1"></a>      CP_2 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb142-27"><a href="#cb142-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb142-28"><a href="#cb142-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create factors to control order of display in graphics output </span></span>
<span id="cb142-29"><a href="#cb142-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb142-30"><a href="#cb142-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(FPSTATUS_1, FPSTATUS_2),</span>
<span id="cb142-31"><a href="#cb142-31" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>.x <span class="sc">%&gt;%</span> <span class="fu">fct_relevel</span>(<span class="st">&quot;Pregnant&quot;</span>, <span class="st">&quot;Not Using FP&quot;</span>, <span class="st">&quot;Using FP&quot;</span>)</span>
<span id="cb142-32"><a href="#cb142-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb142-33"><a href="#cb142-33" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="grouped-bar-charts" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Grouped Bar Charts</h2>
<p>Now let’s revisit the <strong>grouped bar chart</strong> we made to compare <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code> for each population <code>POP</code> in Chapter 4. We made this chart in basically two steps.</p>
<p>First, we used <a href="http://gdfe.co/srvyr/">srvyr</a> to build a summary table that incorporates survey weights from <a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a> and generates a 95% confidence interval for each estimate. We used <a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID_1</a> to generate the cluster-robust standard errors underlying each confidence interval, and we stratified standard error estimation by <code>STRATARC</code>.</p>
<p>Notice that we <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a> <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code> here. When we do this, <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a> estimates the proportion of outcomes represented by the variable that appears <em>last</em>, which is <code>FPSTATUS_2</code>. The proportions sum to <code>1.0</code> for each combination of <code>POP</code> and <code>FPSTATUS_1</code>: in other words, we obtain the proportion of <code>FPSTATUS_2</code> <em>on the condition</em> that women from a given <code>POP</code> held a particular status represented by <code>FPSTATUS_1</code>. For this reason, this is known as a <strong>conditional distribution</strong>.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>status_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPSTATUS_1, FPSTATUS_2) <span class="sc">%&gt;%</span> </span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>))</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>status_tbl</span></code></pre></div>
<pre><code># A tibble: 54 × 6
# Groups:   POP [6]
   POP            FPSTATUS_1   FPSTATUS_2     coef `_low` `_upp`
   &lt;chr&gt;          &lt;fct&gt;        &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso   Pregnant     Pregnant     0.0302 0.0137 0.0652
 2 Burkina Faso   Pregnant     Not Using FP 0.568  0.491  0.642 
 3 Burkina Faso   Pregnant     Using FP     0.401  0.329  0.478 
 4 Burkina Faso   Not Using FP Pregnant     0.0779 0.0651 0.0929
 5 Burkina Faso   Not Using FP Not Using FP 0.739  0.711  0.765 
 6 Burkina Faso   Not Using FP Using FP     0.183  0.158  0.211 
 7 Burkina Faso   Using FP     Pregnant     0.0993 0.0815 0.121 
 8 Burkina Faso   Using FP     Not Using FP 0.248  0.213  0.287 
 9 Burkina Faso   Using FP     Using FP     0.653  0.609  0.694 
10 DRC - Kinshasa Pregnant     Pregnant     0.0367 0.0140 0.0930
# … with 44 more rows</code></pre>
<div class="page-break-after"></div>
<p>The <strong>grouped bar chart</strong> made in Chapter 4 plots the estimated values in <code>coef</code> together with the confidence interval represented by <code>_low</code> and <code>_upp</code>. This chart is useful because it packs a lot of information into a single, reader-friendly graphic. However, we also mentioned at the end of Chapter 4 that it has some considerable drawbacks. Most importantly, we weren’t able to include information from the <strong>marginal distribution</strong> in each phase.</p>
<p><img src="images/bar2.png" width="100%" style="display: block; margin: auto;" /></p>
<p>A <strong>marginal distribution</strong> for <code>FPSTATUS_1</code> would indicate the likelihood that a woman began the survey period pregnant, using family planning, or not using family planning. Likewise the marginal distribution for <code>FPSTATUS_2</code> estimates the likelihood that a woman would hold any such status at Phase 2, <em>independently of</em> her status at Phase 1. We call these distributions “marginal” because they’re usually included in the row or column margins of a crosstab.</p>
</div>
<div id="heatmaps" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Heatmaps</h2>
<p>Let’s return to <code>status_tbl</code>, but this time we’ll plot it as a <strong>heatmap</strong> with <code>color</code> and <code>alpha</code> (transparency) aesthetics. As in Chapter 4, we’ll design a function that combines several <a href="https://ggplot2.tidyverse.org">ggplot2</a> tools we’ll recycle in each plot.<span id="fn29" class="footnote" data-pagedown-footnote-number="29" style="white-space: pre-line;">This manual uses the proprietary font <a href="https://fonts.adobe.com/fonts/cabrito-sans">cabrito sans</a>, which is implemented in figures via the <a href="https://github.com/yixuan/showtext">showtext</a> package for R. You can purchase a license to use <a href="https://fonts.adobe.com/fonts/cabrito-sans">cabrito sans</a>, or substitute with a font of your choice.</span></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>pma_heatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="cn">NULL</span>,     <span class="co"># an optional title </span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,  <span class="co"># an optional subtitle </span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="cn">NULL</span>,     <span class="co"># an optional label for the x-axis (displayed below)</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="cn">NULL</span>      <span class="co"># an optional label for the y-axis (displayed right)</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  components <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">%+replace%</span> <span class="fu">theme</span>(</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;cabrito&quot;</span>, <span class="at">size =</span> <span class="dv">42</span>, <span class="at">lineheight =</span> <span class="fl">0.3</span>),</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">64</span>, <span class="at">color =</span> <span class="st">&quot;#00263A&quot;</span>, </span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">5</span>)),  </span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">28</span>),</span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">l =</span> <span class="dv">20</span>), <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x.bottom =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>)),</span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb145-22"><a href="#cb145-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb145-23"><a href="#cb145-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb145-24"><a href="#cb145-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">subtitle =</span> subtitle, <span class="at">x =</span> xaxis, <span class="at">y =</span> <span class="fu">str_wrap</span>(yaxis, <span class="dv">10</span>)),</span>
<span id="cb145-25"><a href="#cb145-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Pregnant&quot;</span> <span class="ot">=</span> <span class="st">&quot;#B4B3B3&quot;</span>, <span class="st">&quot;Not Using FP&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4E4F71&quot;</span>, </span>
<span id="cb145-26"><a href="#cb145-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Using FP&quot;</span> <span class="ot">=</span> <span class="st">&quot;#EFD372&quot;</span>)),</span>
<span id="cb145-27"><a href="#cb145-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>)),</span>
<span id="cb145-28"><a href="#cb145-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">&quot;right&quot;</span>, <span class="at">limits =</span> rev)</span>
<span id="cb145-29"><a href="#cb145-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb145-30"><a href="#cb145-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>A simple <strong>heatmap</strong> can be built with rectangles from <a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a> and text labels from <a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a>. We’ll also tell <a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a> to use one <code>fill</code> color for each type of response in <code>FPSTATUS_1</code>: this makes it easy for the reader to see that the totals in each tile sum to 100% in columns (not rows). The <code>alpha</code> aesthetic uses the value in <code>coef</code> to control the transparency of each color.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>status_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> FPSTATUS_1, <span class="at">y =</span> FPSTATUS_2)) <span class="sc">+</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> FPSTATUS_1, <span class="at">alpha =</span> coef)) <span class="sc">+</span> </span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(coef, <span class="dv">1</span>),</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> coef <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> FPSTATUS_1 <span class="sc">==</span> <span class="st">&quot;Not Using FP&quot;</span> <span class="co"># white vs black text</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span> </span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>POP, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">&quot;fixed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_heatmap</span>(</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE USE OR NON-USE&quot;</span>,</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent women age 15-49 who changed contraceptive use status&quot;</span>,</span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1 Status&quot;</span>,</span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Status&quot;</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="images/heat1.png" width="85%" style="display: block; margin: auto;" /></p>
<p>The nice thing about this heatmap layout is that - compared with our bar chart - it’s much easier to include data from the marginal distribution of <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>. To do so, we’ll first need to add them to <code>status_tbl</code>.</p>
<div class="page-break-after"></div>
<aside>
We use <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a>, but both <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a> and <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a> would work equally well in this case.
</aside>
<p>First, we use <code>group_by(FPSTATUS_1)</code> to make the column margins and <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a> them to <code>status_tbl</code>. (Note that we set <code>vartype = NULL</code> because we won’t be able to include confidence intervals on our heatmap.)</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>status_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPSTATUS_1) <span class="sc">%&gt;%</span> </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">cols =</span> <span class="fu">survey_mean</span>(<span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">vartype =</span> <span class="cn">NULL</span>))</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(status_tbl, ., <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;POP&quot;</span>, <span class="st">&quot;FPSTATUS_1&quot;</span>))</span></code></pre></div>
<p>Next, we use <code>group_by(FPSTATUS_2)</code> to add row margins to <code>status_tbl</code>.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>status_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPSTATUS_2) <span class="sc">%&gt;%</span> </span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">rows =</span> <span class="fu">survey_mean</span>(<span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">vartype =</span> <span class="cn">NULL</span>))</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(status_tbl, ., <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;POP&quot;</span>, <span class="st">&quot;FPSTATUS_2&quot;</span>))</span></code></pre></div>
<p>The column margins now appear in <code>cols</code>, while the row margins appear in <code>rows</code>.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>status_tbl</span></code></pre></div>
<pre><code># A tibble: 54 × 8
# Groups:   POP [6]
   POP            FPSTATUS_1   FPSTATUS_2     coef `_low` `_upp`   cols   rows
   &lt;chr&gt;          &lt;fct&gt;        &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso   Pregnant     Pregnant     0.0302 0.0137 0.0652 0.0879 0.0799
 2 Burkina Faso   Pregnant     Not Using FP 0.568  0.491  0.642  0.0879 0.583 
 3 Burkina Faso   Pregnant     Using FP     0.401  0.329  0.478  0.0879 0.337 
 4 Burkina Faso   Not Using FP Pregnant     0.0779 0.0651 0.0929 0.624  0.0799
 5 Burkina Faso   Not Using FP Not Using FP 0.739  0.711  0.765  0.624  0.583 
 6 Burkina Faso   Not Using FP Using FP     0.183  0.158  0.211  0.624  0.337 
 7 Burkina Faso   Using FP     Pregnant     0.0993 0.0815 0.121  0.288  0.0799
 8 Burkina Faso   Using FP     Not Using FP 0.248  0.213  0.287  0.288  0.583 
 9 Burkina Faso   Using FP     Using FP     0.653  0.609  0.694  0.288  0.337 
10 DRC - Kinshasa Pregnant     Pregnant     0.0367 0.0140 0.0930 0.0552 0.0533
# … with 44 more rows</code></pre>
<div class="page-break-after"></div>
<p>Now, we can simply <a href="https://rdrr.io/r/base/paste.html">paste</a> these values together with the original labels from <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>status_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(cols, <span class="dv">1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, FPSTATUS_1) <span class="sc">%&gt;%</span> as_factor, </span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(rows, <span class="dv">1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, FPSTATUS_2) <span class="sc">%&gt;%</span> as_factor</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> FPSTATUS_1, <span class="at">alpha =</span> coef)) <span class="sc">+</span> </span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(coef, <span class="dv">1</span>),</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> coef <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> FPSTATUS_1 <span class="sc">==</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span> </span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>POP, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_heatmap</span>(</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE USE OR NON-USE&quot;</span>,</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent women age 15-49 who changed contraceptive use status&quot;</span>,</span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1 Status&quot;</span>,</span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Status&quot;</span></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="images/heat2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>The information contained in our heatmap is similar to what we saw in our bar chart, except for two things:</p>
<ol style="list-style-type: decimal">
<li>There are no error bars on our heatmap. If we wanted to include information about the confidence interval for each estimation, we would have to include <a href="https://rdrr.io/pkg/gtools/man/stars.pval.html">text symbols</a>.</li>
<li>While both plots show information about the conditional distribution of <code>FPSTATUS_2</code> given a starting point in <code>FPSTATUS_1</code>, only the heatmap includes the marginal distribution of each variable in its row and column margins.</li>
</ol>
<p>The marginal distribution may provide crucial information about the conditional distribution that we would otherwise miss. Consider Burkina Faso, where both users and non-users of family planning at Phase 1 were generally most likely to maintain their status at Phase 2. The marginal distribution adds additional information: non-users comprise a larger share of the overall population at Phase 1.</p>
<p>In certain contexts, you may want to combine information from the Phase 1 marginal distribution together with the conditional distribution of outcomes at Phase 2. To continue with our example from Burkina Faso, you might report that - because
non-users represent about 62% of the population, only about 11% of the population adopted family planning at Phase 2 following non-use at Phase 1. That is: 18% of 62% is 11%.</p>
<p>In contrast with the conditional distribution, this type of distribution describes the share of the population that experiences some combination of Phase 1 and Phase 2 outcomes <em>without</em> assuming a particular starting point at Phase 1. It’s known as a <strong>joint distribution</strong> because it gives the probability that two events will happen together in sequence. Let’s return to our summary table, <code>status_tbl</code>: to find the estimated joint distribution for each combination of <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>, you could simply multiply each value in <code>cols</code> by the value in <code>coef</code>:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>status_tbl <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">joint =</span> cols <span class="sc">*</span> coef)</span></code></pre></div>
<pre><code># A tibble: 54 × 9
# Groups:   POP [6]
   POP            FPSTATUS_1   FPSTATUS_2     coef `_low` `_upp`   cols   rows   joint
   &lt;chr&gt;          &lt;fct&gt;        &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 Burkina Faso   Pregnant     Pregnant     0.0302 0.0137 0.0652 0.0879 0.0799 0.00266
 2 Burkina Faso   Pregnant     Not Using FP 0.568  0.491  0.642  0.0879 0.583  0.0499 
 3 Burkina Faso   Pregnant     Using FP     0.401  0.329  0.478  0.0879 0.337  0.0353 
 4 Burkina Faso   Not Using FP Pregnant     0.0779 0.0651 0.0929 0.624  0.0799 0.0486 
 5 Burkina Faso   Not Using FP Not Using FP 0.739  0.711  0.765  0.624  0.583  0.461  
 6 Burkina Faso   Not Using FP Using FP     0.183  0.158  0.211  0.624  0.337  0.114  
 7 Burkina Faso   Using FP     Pregnant     0.0993 0.0815 0.121  0.288  0.0799 0.0286 
 8 Burkina Faso   Using FP     Not Using FP 0.248  0.213  0.287  0.288  0.583  0.0713 
 9 Burkina Faso   Using FP     Using FP     0.653  0.609  0.694  0.288  0.337  0.188  
10 DRC - Kinshasa Pregnant     Pregnant     0.0367 0.0140 0.0930 0.0552 0.0533 0.00203
# … with 44 more rows</code></pre>
<div class="page-break-after"></div>
<p>In practice, you’ll usually want to let <a href="http://gdfe.co/srvyr/">srvyr</a> calculate a confidence interval for each joint probability. To do so, we’ll add an <a href="http://gdfe.co/srvyr/reference/interact.html">interact</a> function listing the variables in <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a> that we want to model jointly.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>joint_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATARC) <span class="sc">%&gt;%</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="fu">interact</span>(FPSTATUS_1, FPSTATUS_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">joint =</span> <span class="fu">survey_mean</span>(<span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>))</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>joint_tbl</span></code></pre></div>
<pre><code># A tibble: 54 × 6
# Groups:   POP [6]
   POP            FPSTATUS_1   FPSTATUS_2     joint joint_low joint_upp
   &lt;chr&gt;          &lt;fct&gt;        &lt;fct&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Burkina Faso   Pregnant     Pregnant     0.00266  0.00120    0.00587
 2 Burkina Faso   Pregnant     Not Using FP 0.0499   0.0404     0.0615 
 3 Burkina Faso   Pregnant     Using FP     0.0353   0.0291     0.0427 
 4 Burkina Faso   Not Using FP Pregnant     0.0486   0.0402     0.0588 
 5 Burkina Faso   Not Using FP Not Using FP 0.461    0.428      0.495  
 6 Burkina Faso   Not Using FP Using FP     0.114    0.100      0.130  
 7 Burkina Faso   Using FP     Pregnant     0.0286   0.0228     0.0357 
 8 Burkina Faso   Using FP     Not Using FP 0.0713   0.0613     0.0829 
 9 Burkina Faso   Using FP     Using FP     0.188    0.164      0.214  
10 DRC - Kinshasa Pregnant     Pregnant     0.00203  0.000794   0.00515
# … with 44 more rows</code></pre>
<p>Now, the values in <code>joint</code> sum to <code>1.0</code> for each <code>POP</code>. Returning to our heatmap, we’ll want to use the same color for all columns, indicating that the percentages sum for 100% for each population.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>joint_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> FPSTATUS_1, <span class="at">y =</span> FPSTATUS_2)) <span class="sc">+</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> joint), <span class="at">fill =</span> <span class="st">&quot;#98579B&quot;</span>) <span class="sc">+</span> </span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(joint, <span class="dv">1</span>),</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> joint <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> FPSTATUS_1 <span class="sc">==</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span> </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>POP, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">&quot;fixed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_heatmap</span>(</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE USE OR NON-USE&quot;</span>,</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent women age 15-49 who changed contraceptive use status&quot;</span>,</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1 Status&quot;</span>,</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Status&quot;</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="images/heat3.png" width="85%" style="display: block; margin: auto;" /></p>
<p>Information provided by the joint distribution nuances our story a bit further. To continue with our examination of Burkina Faso: we knew that family planning users and non-users at Phase 1 were each most likely to maintain, rather than switch their status at Phase 2. However, it’s now clear that <em>continuous non-users</em> (non-users at both Phase 1 and Phase 2) represent a near-majority of the population.</p>
</div>
<div id="alluvial-plots" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Alluvial plots</h2>
<p><strong>Alluvial plots</strong> are an especially popular way to visualize longitudinal data, in part, because they combine information from each of the three distributions we’ve discussed. They also make it possible to show data from more than two variables (we’ll use them again when Phase 3 data become available). You’ll find alluvial plots on the first two pages of the PMA report for each sample.</p>
<p>In an alluvial plot, the marginal distribution of responses for each variable are usually plotted in vertical stacks. The <a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a> package authors refer to these stacks as “strata”, and they may be layered onto a <a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a> with <a href="http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html">geom_stratum</a>. In our case, the strata will show the marginal distribution of women in <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>.</p>
<p>The <strong>joint distribution</strong> for any pair of variables is plotted in horizontal splines called “alluvia”, which bridge the space between any given pair of strata. Alluvia are plotted with <a href="http://corybrunson.github.io/ggalluvial/reference/geom_flow.html">geom_flow</a>.</p>
<p>Finally, we’ll use color to map each alluvium with an originating stratum from <code>FPSTATUS_1</code>. This will help the reader visualize the conditional distribution of <code>FPSTATUS_2</code> responses given a starting point in <code>FPSTATUS_1</code>.</p>
<p>To begin, let’s revisit <code>joint_tbl</code>, which only contains the joint distribution for <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>. In fact, <a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a> will calculate the marginal distribution for both variables automatically if we reshape <code>joint_tbl</code> with <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> like so:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>joint_tbl <span class="ot">&lt;-</span> joint_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="st">&quot;alluvium&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(FPSTATUS_1, FPSTATUS_2), <span class="at">names_to =</span> <span class="st">&quot;x&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;stratum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">&quot;FPSTATUS_1&quot;</span>, <span class="st">&quot;Phase 1&quot;</span>, <span class="st">&quot;Phase 2&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x, alluvium)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>joint_tbl</span></code></pre></div>
<pre><code># A tibble: 108 × 7
# Groups:   POP [6]
   alluvium POP              joint joint_low joint_upp x       stratum     
      &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;fct&gt;       
 1        1 Burkina Faso   0.00266  0.00120    0.00587 Phase 1 Pregnant    
 2        2 Burkina Faso   0.0499   0.0404     0.0615  Phase 1 Pregnant    
 3        3 Burkina Faso   0.0353   0.0291     0.0427  Phase 1 Pregnant    
 4        4 Burkina Faso   0.0486   0.0402     0.0588  Phase 1 Not Using FP
 5        5 Burkina Faso   0.461    0.428      0.495   Phase 1 Not Using FP
 6        6 Burkina Faso   0.114    0.100      0.130   Phase 1 Not Using FP
 7        7 Burkina Faso   0.0286   0.0228     0.0357  Phase 1 Using FP    
 8        8 Burkina Faso   0.0713   0.0613     0.0829  Phase 1 Using FP    
 9        9 Burkina Faso   0.188    0.164      0.214   Phase 1 Using FP    
10       10 DRC - Kinshasa 0.00203  0.000794   0.00515 Phase 1 Pregnant    
# … with 98 more rows</code></pre>
<p>Here, we create the column <code>alluvium</code> to hold the original row number for each of the 56 combinations of <code>POP</code>, <code>FPSTATUS_1</code>, and <code>FPSTATUS_2</code>. When we <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>, we repeat the value in <code>joint</code> once for each end of the same <code>alluvium</code>. The values in <code>stratum</code> describe the strata to to which each alluvium is attached, and <code>x</code> indicates whether the stratum is located in the Phase 1 or Phase 2 stack.</p>
<p>As with our heatmap, we’ll want to define some custom layout options in a function we’ll call <code>pma_alluvial</code>:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>pma_alluvial <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="cn">NULL</span>,     <span class="co"># an optional title </span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cn">NULL</span>,  <span class="co"># an optional subtitle </span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="cn">NULL</span>,     <span class="co"># an optional label for the x-axis (displayed below)</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="cn">NULL</span>      <span class="co"># an optional label for the y-axis (displayed left)</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  components <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">%+replace%</span> <span class="fu">theme</span>(</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;cabrito&quot;</span>, <span class="at">size =</span> <span class="dv">42</span>, <span class="at">lineheight =</span> <span class="fl">0.3</span>),</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">64</span>, <span class="at">color =</span> <span class="st">&quot;#541E5A&quot;</span>, </span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">mar =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">5</span>)),</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">20</span>)),</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">5</span>)),</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#541E5A&quot;</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> title,</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> subtitle,</span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> xaxis,</span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">str_wrap</span>(yaxis, <span class="dv">10</span>),</span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Pregnant&quot;</span> <span class="ot">=</span> <span class="st">&quot;#B4B3B3&quot;</span>, </span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Not Using FP&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4E4F71&quot;</span>, </span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Using FP&quot;</span> <span class="ot">=</span> <span class="st">&quot;#EFD372&quot;</span></span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb159-37"><a href="#cb159-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="page-break-after"></div>
<p>We’ll start by mapping common aesthetics in a <a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a> function. We’ll map the values in <code>x</code> onto our x-axis, and we’ll map the values in <code>joint</code> onto the y-axis. The remaining aesthetics are specific to the functions from <a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a>: we’ll use <code>stratum</code> to build vertical strata and to define colors mapped with “fill”. We also use the identifying numbers in <code>alluvium</code> to organize responses into alluvia.</p>
<p>The remaining functions are straightforward, since they mainly use information passed from <a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a>. We make only one small modification to <a href="http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html">geom_stratum</a>: setting <code>size = 0</code> removes border lines that appear around each stratum, by default.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>status_alluvial <span class="ot">&lt;-</span> joint_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x, </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> joint,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> stratum,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">stratum =</span> stratum,</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">alluvium =</span> alluvium</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span> </span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_flow</span>() <span class="sc">+</span> </span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stratum</span>(<span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>POP, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_alluvial</span>(</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE USE OR NON-USE&quot;</span>,</span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent women age 15-49 who changed contraceptive use status&quot;</span>,</span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>status_alluvial</span></code></pre></div>
<p><img src="images/alluvial1.png" width="85%" style="display: block; margin: auto;" /></p>
<p>Of course, you should always include either y-axis gridlines or text labels for the probabilities shown on a plot like this one. We find it clearer to include the latter, which we’ll build with <a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a>.</p>
<aside>
Values may not add to 100% due to rounding (values rounded to 0% are not labelled).
</aside>
<p>These labels are a bit tricky, but the basic idea is that you use <code>stat = "stratum"</code> to label strata, and <code>stat = "flow"</code> to label alluvia. Then, you use <a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a> to build labels from statistics that <a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a> uses to construct the plot - check out <a href="https://corybrunson.github.io/ggalluvial/reference/stat_stratum.html#computed-variables">this list</a> of available statistics for details. We’ll use the <code>prop</code> statistic to obtain <em>both</em> the marginal and joint probabilities.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>status_alluvial <span class="sc">+</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;stratum&quot;</span>,   <span class="co"># label strata</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>( </span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">==</span> <span class="dv">1</span>, <span class="co"># labels the strata for Phase 1, otherwise blank &quot;&quot;           </span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">after_stat</span>(prop), <span class="dv">1</span>), </span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.2</span>,  <span class="co"># nudge a bit to the left </span></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="st">&quot;right&quot;</span>, <span class="co"># right-justify</span></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;stratum&quot;</span>, <span class="co"># label strata</span></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(</span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">==</span> <span class="dv">2</span>, <span class="co"># labels the strata for Phase 2, otherwise blank &quot;&quot;    </span></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">after_stat</span>(prop), <span class="dv">1</span>), </span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="fl">0.2</span>,  <span class="co"># nudge a bit to the right </span></span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="co"># left-justify</span></span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;flow&quot;</span>,   <span class="co"># label alluvia </span></span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>( </span>
<span id="cb161-25"><a href="#cb161-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">after_stat</span>(flow) <span class="sc">==</span> <span class="st">&quot;to&quot;</span> <span class="sc">&amp;</span>  <span class="co"># only label the destination (right-side)</span></span>
<span id="cb161-26"><a href="#cb161-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">after_stat</span>(prop) <span class="sc">&gt;=</span> <span class="fl">0.01</span>, <span class="co"># hide if 0%</span></span>
<span id="cb161-27"><a href="#cb161-27" aria-hidden="true" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">after_stat</span>(prop), <span class="dv">1</span>), </span>
<span id="cb161-28"><a href="#cb161-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;&quot;</span> </span>
<span id="cb161-29"><a href="#cb161-29" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb161-30"><a href="#cb161-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.2</span>,  <span class="co"># nudge a bit to the left</span></span>
<span id="cb161-31"><a href="#cb161-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="st">&quot;right&quot;</span>, <span class="co"># right-justify</span></span>
<span id="cb161-32"><a href="#cb161-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span>         <span class="co"># use a slightly smaller font </span></span>
<span id="cb161-33"><a href="#cb161-33" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Now, it’s easy to identify the proportion of women at each phase <em>and</em> the proportion who switched or maintained their status between phases.</p>
<p><img src="images/alluvial2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="contraceptive-calendar" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Contraceptive Calendar</h1>
<p>As we’ve seen, PMA panel surveys represent annual interviews that will ultimately include three phases of data collection. Most questions will be repeated for a total of three observations each spaced one year apart. However, some data in PMA panel surveys are reported <em>monthly</em> up to three years prior to the interview in each phase. These data are provided as a comma-delimited character string known as the <strong>Contraceptive Calendar</strong>.</p>
<p>Chapter 6 includes code you can use to parse and analyze data from the <strong>Contraceptive Calendar</strong>. These data are particularly exciting because they offer researchers an opportunity to explore longitudinal analysis techniques like <a href="https://github.com/therneau/survival">survival</a> to model the duration of events like:</p>
<ul>
<li>continuous use (or non-use) of a contraceptive method</li>
<li>birth spacing</li>
<li>pregnancies leading to birth or termination</li>
</ul>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="https://github.com/therneau/survival">
<img src="images/hex/survival.png"/>
</a>
<br/>
© Terry M. Therneau et al.
<br/>
(LGPL &gt;=2)
</div>
</aside>
<p>To demonstrate, we’ll test whether women with <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">unmet need</a> or <a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">plans to adopt</a> a family planning method at Phase 1 were quicker to begin using one in the months between Phase 1 and Phase 2. In R, this type of analysis is facilitated by the <a href="https://github.com/therneau/survival">survival</a> package, which can be installed from CRAN like so:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;survival&quot;</span>)</span></code></pre></div>
<p>The term “survival analysis” refers to the probability that a person “survives” a particular condition for a given period of time, most commonly in clinical research settings. In the social sciences, this type of analysis is also known as “event history”, “time-to-event”, or “duration” analysis. We use the term “survival” in order to match the terminology used in the R package featured in this chapter.</p>
<p>There are many additional R packages available for plotting Time-to-Event curves showing the probability of survival over time.<span id="fn30" class="footnote" data-pagedown-footnote-number="30" style="white-space: pre-line;">For example, see <a href="https://github.com/ddsjoberg/ggsurvfit">ggsurvfit</a>.</span> Here, we will show how to construct these figures with the same <a href="https://ggplot2.tidyverse.org">ggplot2</a> toolkit featured in previous chapters.</p>
<div id="chapter-setup-3" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Chapter Setup</h2>
<p>Two calendar variables are available for each country in the PMA panel study. The main calendar - which we refer to as the <strong>Contraceptive Calendar</strong> - is named as follows:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARBF#codes_section">CALENDARBF</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARCD#codes_section">CALENDARCD</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#codes_section">CALENDARKE</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARNG#codes_section">CALENDARNG</a></li>
</ul>
<p>This calendar represents contraceptive use, pregnancy, pregnancy termination, and birth information for each month preceding the interview for the Female Questionnaire in a particular phase of the panel study. Women are asked to recall their status for each month in the calendar period, and their responses are recorded in a single comma-delimited string with the following codes:</p>
<ul>
<li><code>B</code> - Birth</li>
<li><code>P</code> - Pregnant</li>
<li><code>T</code> - Pregnancy ended</li>
<li><code>0</code> - No family planning method used</li>
<li><code>1</code> - Female Sterilization</li>
<li><code>2</code> - Male Sterilization</li>
<li><code>3</code> - Implant</li>
<li><code>4</code> - IUD</li>
<li><code>5</code> - Injectables</li>
<li><code>7</code> - Pill</li>
<li><code>8</code> - Emergency Contraception</li>
<li><code>9</code> - Male Condom</li>
<li><code>10</code> - Female Condom</li>
<li><code>11</code> - Diaphragm</li>
<li><code>12</code> - Foam / Jelly</li>
<li><code>13</code> - Standard Days / Cycle beads</li>
<li><code>14</code> - LAM</li>
<li><code>30</code> - Rhythm method</li>
<li><code>31</code> - Withdrawal</li>
<li><code>39</code> - Other traditional methods</li>
</ul>
<p>For example, consider a woman sampled in Kenya who gave birth during the month of the interview following 8 prior months of pregnancy. If she had used the pill every month up until the month she became pregnant, her string in <a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#codes_section">CALENDARKE</a> would look like this:</p>
<p><code>B,P,P,P,P,P,P,P,P,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7</code></p>
<div class="page-break-after"></div>
<p>The second calendar is the <strong>Discontinuation Calendar</strong>, and it gives the <em>reason why</em> a woman stopped using a contraceptive method for each month following an episode of continuous use. This calendar is represented by the following variables:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARBFWHY#codes_section">CALENDARBFWHY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARCDWHY#codes_section">CALENDARCDWHY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARKEWHY#codes_section">CALENDARKEWHY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CALENDARNGWHY#codes_section">CALENDARNGWHY</a></li>
</ul>
<p>Like the <strong>Contraceptive Calendar</strong>, the <strong>Discontinuation Calendar</strong> is a single comma-delimited string. It contains the following codes for months when a method was discontinued (and is blank otherwise):</p>
<ul>
<li><code>1</code> - Infrequent sex / husband away</li>
<li><code>2</code> - Became pregnant while using</li>
<li><code>3</code> - Wanted to become pregnant</li>
<li><code>4</code> - Husband / partner disapproved</li>
<li><code>5</code> - Wanted more effective method</li>
<li><code>6</code> - Side effects / health concerns</li>
<li><code>7</code> - Lack of access / too far</li>
<li><code>8</code> - Costs too much</li>
<li><code>9</code> - Inconvenient to use</li>
<li><code>10</code> - Up to God / fatalistic</li>
<li><code>11</code> - Difficult to get pregnant / menopausal</li>
<li><code>12</code> - Marital dissolution / separation</li>
<li><code>96</code> - Other</li>
</ul>
<p>Returning to our example, if the same woman reported that she stopped using the pill because she wanted to become pregnant, her string in <code>r_link(CALENDARKEWHY)</code> would look like this:</p>
<p><code>,,,,,,,,,3,,,,,,,,,,,,,,,,,,,,,,,,,,</code></p>
<p>Note that the length of the string is padded by blank values before and after the only month in which this woman stopped using the pill. This ensures that <em>all calendars in the same sample contain the same number of values</em> including blanks. Women who were interviewed one month before the final interviews were collected, for example, will always have a blank value for the left-most space on their calendar.</p>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="https://tidyr.tidyverse.org/index.html">
<img src="images/hex/tidyr.png"/>
</a>
<br/>
© RStudio, Inc.
<br/>
(MIT)
</div>
</aside>
<p>However, calendars from <em>different samples may be different lengths</em>. In this chapter, we’ll demonstrate how to work with a data extract containing multiple samples. We will use tools from the <a href="https://tidyr.tidyverse.org">tidyr</a> package to <a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a> the comma-delimited string into multiple columns, and then reshape the columns into rows with <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>. <a href="https://tidyr.tidyverse.org">tidyr</a> is included in the <a href="https://tidyverse.tidyverse.org">tidyverse</a> toolkit for R. Following these steps, you’ll be able to merge and analyze data from calendars collected in multiple countries covering a range of different dates.</p>
<div class="page-break-after"></div>
<p>All six of the currently available longitudinal samples are included in the data extract featured in this chapter (<strong>Female Respondents</strong> only). We’ve selected a <strong>wide</strong> format extract, so that the variables from each phase appear together in the same row. For example, the Kenya contraceptive calendar from Phase 1 is named <a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#codes_section">CALENDARKE_1</a>, while the Kenya contraceptive calendar from Phase 2 is named <a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#codes_section">CALENDARKE_2</a>.</p>
<p>We’ve selected all of the calendar variables listed above, plus these additional variables that we’ll need for our analysis:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a> - Result of female questionnaire</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a> - Unique ID for female questionnaire</li>
<li><a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a> - Household residence / membership</li>
<li><a href="https://pma.ipums.org/pma-action/variables/COUNTRYSTR#codes_section">COUNTRYSTR</a> - Country two-letter ISO code</li>
<li><a href="https://pma.ipums.org/pma-action/variables/INTFQMON#codes_section">INTFQMON</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/INTFQYEAR#codes_section">INTFQYEAR</a> - Date of Female Questionnaire interview</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> - Most effective current family planning method (recoded<span id="fn31" class="footnote" data-pagedown-footnote-number="31" style="white-space: pre-line;">The related variable <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETH#codes_section">FPCURREFFMETH</a> reports the most effective method reported by each woman. In <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>, these responses are combined with detailed information about her use of the lactational amenorrhea method (LAM), emergency contraception, or specific types of injectable methods.</span>)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a> - Current pregnancy status</li>
<li><a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a> - Total unmet need</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a> - When will start using FP method in the future - value</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a> - When will start using FP method in the future - unit</li>
<li><a href="https://pma.ipums.org/pma-action/variables/KID1STBIRTHMO#codes_section">KID1STBIRTHMO</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/KID1STBIRTHYR#codes_section">KID1STBIRTHYR</a> - Date of first childbirth</li>
<li><a href="https://pma.ipums.org/pma-action/variables/LASTBIRTHMO#codes_section">LASTBIRTHMO</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/LASTBIRTHYR#codes_section">LASTBIRTHYR</a> - Date of most recent childbirth</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PANELBIRTHMO#codes_section">PANELBIRTHMO</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/PANELBIRTHYR#codes_section">PANELBIRTHYR</a> - Date of childbirth during the panel study</li>
<li><a href="https://pma.ipums.org/pma-action/variables/OTHERBIRTHMO#codes_section">OTHERBIRTHMO</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/OTHERBIRTHYR#codes_section">OTHERBIRTHYR</a> - Date of any other childbirth during the calendar period</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PREGENDMO#codes_section">PREGENDMO</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/PREGENDYR#codes_section">PREGENDYR</a> - Date of most recent pregnancy termination (miscarriage, abortion, or stillbirth)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PANELPREGENDMO#codes_section">PANELPREGENDMO</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/PANELPREGENDYR#codes_section">PANELPREGENDYR</a> - Date of pregnancy termination during the panel study (miscarriage, abortion, or stillbirth)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPBEGINUSEMO#codes_section">FPBEGINUSEMO</a> &amp; <a href="https://pma.ipums.org/pma-action/variables/FPBEGINUSEYR#codes_section">FPBEGINUSEYR</a> - Date of adoption for currently used family planning method</li>
</ul>
<p>We’ll load the data extract into R together with each of the packages we’ll feature in this post. Then, *Inclusion Criteria for Analysis** described in Chapter 1, we’ll drop cases for women who did not complete the Female Questionnaire or were not members of the <em>de facto</em> population in both phases.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00111.xml&quot;</span>,</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00111.dat.gz&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>, RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>))</span></code></pre></div>
<p>In order to make this chapter a bit easier to follow, we’re going to omit survey design information - weights and identifiers for samples clusters and strata - featured in previous chapters. R users can find several functions adapted from the <a href="https://github.com/therneau/survival">survival</a> package in the <a href="http://r-survey.r-forge.r-project.org/survey/">survey</a> package, but we recommend that beginners start with the basics before confronting complex survey design.<span id="fn32" class="footnote" data-pagedown-footnote-number="32" style="white-space: pre-line;">The <code>survival</code> function <a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a> used to fit a Kaplan-Meier curve in the Analysis section of this chapter is analogous to the <code>survey</code> function <a href="https://rdrr.io/pkg/survey/man/svykm.html">svykm</a>, except that the latter incorporates complex survey information. For simplicity, the confidence intervals shown in this chapter do not account for cluster sampling, and may be narrower as a result.</span></p>
<aside>
Use <a href="https://haven.tidyverse.org/reference/zap_labels.html">zap_labels</a> to remove all labels from an IPUMS variable.
</aside>
<p>We’ll instead organize results by country (combining sub-national samples for Nigeria and the DRC, which use the same calendar variables). Two-letter ISO codes for each country are available in the variable <a href="https://pma.ipums.org/pma-action/variables/COUNTRYSTR#codes_section">COUNTRYSTR_1</a>; we’ll extract these codes with <a href="https://haven.tidyverse.org/reference/zap_labels.html">zap_labels</a> to make a new variable called <code>CNTRY</code>.<span id="fn33" class="footnote" data-pagedown-footnote-number="33" style="white-space: pre-line;">The same ISO codes are also available in <a href="https://pma.ipums.org/pma-action/variables/COUNTRYSTR#codes_section">COUNTRYSTR_2</a>.</span> In graphics, we’ll switch these ISO codes for readable country names extracted from the value labels in <a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a>.</p>
<ul>
<li><code>CNTRY</code> - Country two-letter ISO code</li>
</ul>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNTRY =</span> COUNTRYSTR_1 <span class="sc">%&gt;%</span> zap_labels,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">COUNTRY =</span> COUNTRY <span class="sc">%&gt;%</span> </span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>      as_factor <span class="sc">%&gt;%</span> </span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct_recode</span>(<span class="st">&quot;DRC&quot;</span> <span class="ot">=</span> <span class="st">&quot;Congo, Democratic Republic&quot;</span>)</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(CNTRY, COUNTRY)</span></code></pre></div>
<pre><code># A tibble: 4 × 3
  CNTRY COUNTRY          n
  &lt;chr&gt; &lt;fct&gt;        &lt;int&gt;
1 BF    Burkina Faso  5212
2 CD    DRC           3487
3 KE    Kenya         6939
4 NG    Nigeria       2087</code></pre>
<p>Finally, we’ll also create a short ID number for each woman, making it easier for the reader to follow the same individual’s responses throughout several reformatting steps. <strong>This is for display purposes only</strong> - in practice, the 41-character variable <a href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a> should be used as a unique identifier for each panel member.</p>
<ul>
<li><code>ID</code> - Short ID for each panel member (for display only)</li>
</ul>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">rowid_to_column</span>(<span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
</div>
<div id="century-month-codes-cmc" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Century Month Codes (CMC)</h2>
<p>As shown above, we’ll be referencing several variables representing <strong>dates</strong> in this chapter Generally, IPUMS PMA publishes every date with two variables: one representing the month (e.g. <a href="https://pma.ipums.org/pma-action/variables/INTFQMON#codes_section">INTFQMON</a>) and one representing the year (e.g. <a href="https://pma.ipums.org/pma-action/variables/INTFQYEAR#codes_section">INTFQYEAR</a>). Sometimes, you’ll notice a third variable representing dates with a <strong>century month code (CMC)</strong>: each CMC represents the number of months that have passed between a given date and January 1900. CMC dates are particularly useful for calculating the time between events because they replace two variables (with different units) with one simple integer.</p>
<p>Some CMC variables are available directly from IPUMS PMA (e.g. <a href="https://pma.ipums.org/pma-action/variables/INTFQCMC#codes_section">INTFQCMC</a>), but we’ll create our own CMC variables for all of the dates we’ll reference in this post. CMC dates are simply calculated as follows:</p>
<p><span class="math display">\[CMC = Month + 12*(Year – 1900)\]</span></p>
<p>Because all or part of a date may be <strong>missing</strong> (the month or year), and because certain dates may be “NIU (not in universe)” (e.g. “date of most recent childbirth” for women who have never given birth), we’ll need to consider specific circumstances where we should use the value <code>NA</code> in a CMC variable.</p>
<p>In the contraceptive calendar, we’ll be measuring the time between events in <em>months</em>. Therefore, it would be insufficient to include cases where a woman only reported the <em>year</em> in which an event occurred. We’ll create a function that generates <code>NA</code> values if the numeric code representing a month is <code>90</code> or higher (all valid months are coded 1 through 12), and if a year is <code>9000</code> or higher (all valid years are in the 1900s or 2000s). Otherwise, we’ll use the CMC formula to calculate the appropriate CMC value for each date.</p>
<aside>
With <a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a>, any “case” not explicitly covered by <code>mo &lt; 90 &amp; yr &lt; 9000</code> is assigned the value <code>NA</code>.
</aside>
<p>Let’s call this function <code>make_cmc</code>:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>make_cmc <span class="ot">&lt;-</span> <span class="cf">function</span>(mo, yr){</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(mo <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">&amp;</span> yr <span class="sc">&lt;</span> <span class="dv">9000</span> <span class="sc">~</span> mo <span class="sc">+</span> <span class="dv">12</span><span class="sc">*</span>(yr <span class="sc">-</span> <span class="dv">1900</span>))</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="page-break-after"></div>
<p>You can apply <code>make_cmc</code> to any combination of variables representing the month and year for a date. We’ll create one <code>CMC</code> for each date in our data extract.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">INTFQCMC_1 =</span> <span class="fu">make_cmc</span>(INTFQMON_1, INTFQYEAR_1),</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">INTFQCMC_2 =</span> <span class="fu">make_cmc</span>(INTFQMON_2, INTFQYEAR_2),</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">KID1STBIRTHCMC_1 =</span> <span class="fu">make_cmc</span>(KID1STBIRTHMO_1, KID1STBIRTHYR_1),</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">KID1STBIRTHCMC_2 =</span> <span class="fu">make_cmc</span>(KID1STBIRTHMO_2, KID1STBIRTHYR_2),</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">LASTBIRTHCMC_1 =</span> <span class="fu">make_cmc</span>(LASTBIRTHMO_1, LASTBIRTHYR_1),</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">LASTBIRTHCMC_2 =</span> <span class="fu">make_cmc</span>(LASTBIRTHMO_2, LASTBIRTHYR_2),</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">OTHERBIRTHCMC_1 =</span> <span class="fu">make_cmc</span>(OTHERBIRTHMO_1, OTHERBIRTHYR_1),</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">OTHERBIRTHCMC_2 =</span> <span class="fu">make_cmc</span>(OTHERBIRTHMO_2, OTHERBIRTHYR_2),</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">PANELBIRTHCMC_1 =</span> <span class="fu">make_cmc</span>(PANELBIRTHMO_1, PANELBIRTHYR_1),</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PANELBIRTHCMC_2 =</span> <span class="fu">make_cmc</span>(PANELBIRTHMO_2, PANELBIRTHYR_2),</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">PREGENDCMC_1 =</span> <span class="fu">make_cmc</span>(PREGENDMO_1, PREGENDYR_1),</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">PREGENDCMC_2 =</span> <span class="fu">make_cmc</span>(PREGENDMO_2, PREGENDYR_2),</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">PANELPREGENDCMC_1 =</span> <span class="fu">make_cmc</span>(PANELPREGENDMO_1, PANELPREGENDYR_1),</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">PANELPREGENDCMC_2 =</span> <span class="fu">make_cmc</span>(PANELPREGENDMO_2, PANELPREGENDYR_2),</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPBEGINUSECMC_1 =</span> <span class="fu">make_cmc</span>(FPBEGINUSEMO_1, FPBEGINUSEYR_1),</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPBEGINUSECMC_2 =</span> <span class="fu">make_cmc</span>(FPBEGINUSEMO_2, FPBEGINUSEYR_2)</span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Let’s check our work. For example, consider how we’ve handled <a href="https://pma.ipums.org/pma-action/variables/PANELBIRTHCMC#codes_section">PANELBIRTHCMC_2</a> - the date of a woman’s childbirth that happened during the panel study. If we count the dates by <a href="https://pma.ipums.org/pma-action/variables/PANELBIRTHMO#codes_section">PANELBIRTHMO_2</a> and use <a href="https://rdrr.io/r/utils/head.html">tail</a> to examine the last few rows, we see that one woman reported code <code>97</code> indicating that she did not know the precise month of birth. Meanwhile, there were 15,064 cases coded <code>99</code> indicating that they were “NIU (not in universe)” (no birth occurred during the panel study). We’ve coded both of these case types with the value <code>NA</code>; all other values follow the CMC formula to count the number of months between January 1900 and the month of birth.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(PANELBIRTHMO_2, PANELBIRTHYR_2, PANELBIRTHCMC_2) <span class="sc">%&gt;%</span> </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code></pre></div>
<pre><code># A tibble: 6 × 4
  PANELBIRTHMO_2             PANELBIRTHYR_2               PANELBIRTHCMC_2     n
  &lt;int+lbl&gt;                  &lt;int+lbl&gt;                              &lt;dbl&gt; &lt;int&gt;
1 12 [December]              2017                                    1416     1
2 12 [December]              2018                                    1428    13
3 12 [December]              2019                                    1440    99
4 12 [December]              2020                                    1452    90
5 97 [Don&#39;t know]            2017                                      NA     1
6 99 [NIU (not in universe)] 9999 [NIU (not in universe)]              NA 15074</code></pre>
</div>
<div id="calendar-length" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Calendar Length</h2>
<p>You may be wondering: why does IPUMS PMA publish a separate calendar variable for <em>each country</em>?</p>
<p>This is because the width of each calendar variable differs according to the number of months women were asked to recall in a particular sample. This, in turn, depends on the range of dates in which women were interviewed for the Female Questionnaire in a particular phase.</p>
<p>You can find the precise range of dates included in each calendar on the <a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#universe_section">description tab</a> for each country’s calendar variable. Here, for example, we see that the Kenya Phase 1 sample includes dates from January 2017 to the month of the interview, and that its Phase 2 sample includes dates from January 2018 to the month of the interview. Note: the two calendars overlap between January 2018 and the Phase 1 interview.</p>
<p><img src="images/startmo.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>The first month in each country’s calendar is listed below:</p>
<div style="margin-bottom: 1em; margin-top: 0em; border: 0px solid #ddd; padding: 5pxoverflow-x: scroll; width:100%; ">
<table style="width:70%; margin-left: auto; margin-right: auto;" class="table">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Start Contraceptive Calendar
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Country
</th>
<th style="text-align:left;">
Phase 1
</th>
<th style="text-align:left;">
Phase 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
Jan 2018
</td>
<td style="text-align:left;">
Jan 2018
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC
</td>
<td style="text-align:left;">
Jan 2017
</td>
<td style="text-align:left;">
Jan 2018
</td>
</tr>
<tr>
<td style="text-align:left;">
Kenya
</td>
<td style="text-align:left;">
Jan 2017
</td>
<td style="text-align:left;">
Jan 2018
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria
</td>
<td style="text-align:left;">
Jan 2017
</td>
<td style="text-align:left;">
Jan 2018
</td>
</tr>
</tbody>
</table>
</div>
<p>All women in the same sample were asked to recall events dating backward to a common start date (always in January, as shown above). However, the length of each woman’s calendar will vary depending on the date of her interview. Interviews were collected over a period of months shown in the table below.</p>
<div style="margin-bottom: 1em; margin-top: 0em; border: 0px solid #ddd; padding: 5pxoverflow-x: scroll; width:100%; ">
<table style="width:70%; margin-left: auto; margin-right: auto;" class="table">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Stop Contraceptive Calendar
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Country
</th>
<th style="text-align:left;">
Phase 1
</th>
<th style="text-align:left;">
Phase 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
Dec 2019 - Mar 2020
</td>
<td style="text-align:left;">
Dec 2020 - Apr 2021
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC
</td>
<td style="text-align:left;">
Dec 2019 - Feb 2020
</td>
<td style="text-align:left;">
Dec 2020 - Mar 2021
</td>
</tr>
<tr>
<td style="text-align:left;">
Kenya
</td>
<td style="text-align:left;">
Nov 2019 - Dec 2019
</td>
<td style="text-align:left;">
Nov 2020 - Dec 2020
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria
</td>
<td style="text-align:left;">
Dec 2019 - Jan 2020
</td>
<td style="text-align:left;">
Dec 2020 - Feb 2021
</td>
</tr>
</tbody>
</table>
</div>
<p>To determine the precise length of each woman’s calendar, we’ll need to create variables for the CMC date of its first month in <code>CALSTART_1</code> and <code>CALSTART_2</code>, and also for the CMC date of its last month in <code>CALSTOP_1</code> and <code>CALSTOP_2</code>.</p>
<ul>
<li><code>CALSTART_1</code> - CMC for a woman’s first calendar month in Phase 1</li>
<li><code>CALSTOP_1</code> - CMC for a woman’s last calendar month in Phase 1</li>
<li><code>CALSTART_2</code> - CMC for a woman’s first calendar month in Phase 2</li>
<li><code>CALSTOP_2</code> - CMC for a woman’s last calendar month in Phase 2</li>
</ul>
<p>We’ll manually set <code>CALSTART_1</code> and <code>CALSTART_2</code> like so:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CALSTART_1 =</span> <span class="fu">if_else</span>(CNTRY <span class="sc">==</span> <span class="st">&quot;BF&quot;</span>, <span class="dv">2018</span>, <span class="dv">2017</span>),</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CALSTART_2 =</span> <span class="dv">2018</span>,</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(CALSTART_1, CALSTART_2), <span class="sc">~</span><span class="dv">12</span><span class="sc">*</span>(.x <span class="sc">-</span> <span class="dv">1900</span>) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<div class="page-break-after"></div>
<p><code>CALSTOP_1</code> and <code>CALSTOP_2</code> can be copied directly from the dates we made above for <code>INTFQCMC_1</code> and <code>INTFQCMC_2</code>.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CALSTOP_1 =</span> INTFQCMC_1,</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CALSTOP_2 =</span> INTFQCMC_2</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="formatting-calendar-strings" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Formatting Calendar Strings</h2>
<p>Now that we know the appropriate dates for each value in all calendar variables, we’ll begin separating each string into columns. As a first step, we’ll want to use <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> to align all of the calendars assigned to different countries. Let’s call our reformatted data frame <code>cals</code>. For now, it will only include <code>ID</code>, <code>CNTRY</code>, and all variables that start with <code>CAL</code>.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, CNTRY, <span class="fu">starts_with</span>(<span class="st">&quot;CAL&quot;</span>))</span></code></pre></div>
<p>Notice that the first few rows of our dataset represent women from Burkina Faso. Their values for variables like <a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#codes_section">CALENDARKE_1</a> are blank; only the variables for Burkina Faso contain comma-delimited values.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, CNTRY, CALENDARKE_1, CALENDARBF_1)</span></code></pre></div>
<pre><code># A tibble: 17,725 × 4
      ID CNTRY CALENDARKE_1 CALENDARBF_1                                        
   &lt;int&gt; &lt;chr&gt; &lt;chr+lbl&gt;    &lt;chr+lbl&gt;                                           
 1     1 BF    &quot;&quot;           ,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,B,P,P,P,P,P,P,P,P…
 2     2 BF    &quot;&quot;           ,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0,0,0,0,0,3,3,3,3,3,3,…
 3     3 BF    &quot;&quot;           ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
 4     4 BF    &quot;&quot;           ,,,,,,,,,,,0,0,0,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,…
 5     5 BF    &quot;&quot;           ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,B,…
 6     6 BF    &quot;&quot;           ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
 7     7 BF    &quot;&quot;           ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,T,P,P,P,P,P,P,…
 8     8 BF    &quot;&quot;           ,,,,,,,,,,,B,P,P,P,P,P,P,P,P,P,0,0,0,0,0,0,0,0,0,0,…
 9     9 BF    &quot;&quot;           ,,,,,,,,,,,,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3…
10    10 BF    &quot;&quot;           ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
# … with 17,715 more rows</code></pre>
<p>Our goal is to reduce the number of variables in <code>cals</code> so that we only need to work with one calendar for <em>all</em> countries. We’ll “pivot” <code>cals</code> in two steps. First, we’ll merge data from each Phase one column per country. Second, we’ll merge data from each country into a finally, unified column.</p>
<div id="merge-phases" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Merge Phases</h3>
<p>We’ll use <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> to reorganize our <strong>wide format</strong> data into <strong>long format</strong>, with one row per Phase of the panel study. This procedure strips the numeric suffix from each calendar variable: we’ll store this information in a new column called <code>PHASE</code>. Notice that the argument <code>cols</code> selects every column that <a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a> the prefix “CAL”.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;CAL&quot;</span>),</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;(.*)_(.*)&quot;</span>,</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;PHASE&quot;</span>)</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>For example, let’s return to those first few rows of data representing women from Burkina Faso. The variables <a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#codes_section">CALENDARKE_1</a> and <a href="https://pma.ipums.org/pma-action/variables/CALENDARBE#codes_section">CALENDARBE_1</a> we previewed above are replaced with a new variable <code>PHASE</code> and a pair of variables named <code>CALENDARKE</code> and <code>CALENDARBF</code>.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, CNTRY, PHASE, CALENDARKE, CALENDARBF)</span></code></pre></div>
<pre><code># A tibble: 35,450 × 5
      ID CNTRY PHASE CALENDARKE CALENDARBF                                      
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr+lbl&gt;  &lt;chr+lbl&gt;                                       
 1     1 BF    1     &quot;&quot;         &quot;,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,B,P,P,P,P,P,…
 2     1 BF    2     &quot;&quot;         &quot;,,,,,,,,,,,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0…
 3     2 BF    1     &quot;&quot;         &quot;,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0,0,0,0,0,3,3,3,3…
 4     2 BF    2     &quot;&quot;         &quot;,,,,,,,,,,,,5,5,5,5,5,5,5,5,5,B,P,P,P,P,P,P,P,…
 5     3 BF    1     &quot;&quot;         &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0…
 6     3 BF    2     &quot;&quot;         &quot;&quot;                                              
 7     4 BF    1     &quot;&quot;         &quot;,,,,,,,,,,,0,0,0,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0…
 8     4 BF    2     &quot;&quot;         &quot;,,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,…
 9     5 BF    1     &quot;&quot;         &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0…
10     5 BF    2     &quot;&quot;         &quot;&quot;                                              
# … with 35,440 more rows</code></pre>
<div class="page-break-after"></div>
<p>We’ve applied similar changes to variables for the <strong>Discontinuation Calendar</strong>.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, CNTRY, PHASE, CALENDARKEWHY, CALENDARBFWHY)</span></code></pre></div>
<pre><code># A tibble: 35,450 × 5
      ID CNTRY PHASE CALENDARKEWHY CALENDARBFWHY                                
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr+lbl&gt;     &lt;chr+lbl&gt;                                    
 1     1 BF    1     &quot;&quot;            &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,&quot;        
 2     1 BF    2     &quot;&quot;            &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,…
 3     2 BF    1     &quot;&quot;            &quot;,,,,,,,,,,,,,,,,,,,,,,,,,6,,,,,,,,,,&quot;       
 4     2 BF    2     &quot;&quot;            &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,6,,,,,,…
 5     3 BF    1     &quot;&quot;            &quot;&quot;                                           
 6     3 BF    2     &quot;&quot;            &quot;&quot;                                           
 7     4 BF    1     &quot;&quot;            &quot;,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,&quot;       
 8     4 BF    2     &quot;&quot;            &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,12,,,,,,,,,,,,,,,…
 9     5 BF    1     &quot;&quot;            &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,&quot;        
10     5 BF    2     &quot;&quot;            &quot;&quot;                                           
# … with 35,440 more rows</code></pre>
<p>And, because our <code>CALSTART</code> and <code>CALSTOP</code> variables were also named with the prefix “CAL”, they been pivoted as well.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, CNTRY, PHASE, CALSTART, CALSTOP)</span></code></pre></div>
<pre><code># A tibble: 35,450 × 5
      ID CNTRY PHASE CALSTART CALSTOP
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1     1 BF    1         1417    1442
 2     1 BF    2         1417    1453
 3     2 BF    1         1417    1441
 4     2 BF    2         1417    1453
 5     3 BF    1         1417    1441
 6     3 BF    2         1417    1453
 7     4 BF    1         1417    1441
 8     4 BF    2         1417    1452
 9     5 BF    1         1417    1441
10     5 BF    2         1417    1453
# … with 35,440 more rows</code></pre>
</div>
<div id="merge-countries" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Merge Countries</h3>
<p>We’ll now pivot a second time, leaving only two columns representing data collected from all four countries: we’ll call the <strong>Contraceptive Calendar</strong> <code>FPSTATUS</code>, and we’ll call the <strong>Discontinuation Calendar</strong> <code>WHYSTOP</code>. The suffix labeling the country for each variable will be stripped and placed in a new column, <code>CNTRY_CAL</code>.</p>
<ul>
<li><code>FPSTATUS</code> - Calendar string derived from the main <strong>Contraceptive Calendar</strong></li>
<li><code>WHYSTOP</code> - Calendar string derived from the <strong>Discontinuation Calendar</strong></li>
</ul>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">paste0</span>(.x, <span class="st">&quot;FPSTATUS&quot;</span>),</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;CALENDAR&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;WHY&quot;</span>)</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">paste0</span>(.x, <span class="st">&quot;STOP&quot;</span>),</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;CALENDAR&quot;</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">&quot;WHY&quot;</span>)</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;CALENDAR&quot;</span>),</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;CALENDAR(..)(.*)&quot;</span>,</span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;CNTRY_CAL&quot;</span>, <span class="st">&quot;.value&quot;</span>),</span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;CALENDAR_STRING&quot;</span></span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Notice that each woman now occupies <em>eight rows</em>: that’s four country calendars per phase.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>cals </span></code></pre></div>
<pre><code># A tibble: 141,800 × 8
      ID CNTRY PHASE CALSTART CALSTOP CNTRY_CAL FPSTATUS                 WHYSTOP
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr+lbl&gt;                &lt;chr+l&gt;
 1     1 BF    1         1417    1442 KE        &quot;&quot;                       &quot;&quot;     
 2     1 BF    1         1417    1442 NG        &quot;&quot;                       &quot;&quot;     
 3     1 BF    1         1417    1442 BF        &quot;,,,,,,,,,,0,0,0,0,0,0,… &quot;,,,,,…
 4     1 BF    1         1417    1442 CD        &quot;&quot;                       &quot;&quot;     
 5     1 BF    2         1417    1453 KE        &quot;&quot;                       &quot;&quot;     
 6     1 BF    2         1417    1453 NG        &quot;&quot;                       &quot;&quot;     
 7     1 BF    2         1417    1453 BF        &quot;,,,,,,,,,,,3,3,3,3,3,3… &quot;,,,,,…
 8     1 BF    2         1417    1453 CD        &quot;&quot;                       &quot;&quot;     
 9     2 BF    1         1417    1441 KE        &quot;&quot;                       &quot;&quot;     
10     2 BF    1         1417    1441 NG        &quot;&quot;                       &quot;&quot;     
# … with 141,790 more rows</code></pre>
<div class="page-break-after"></div>
<p>We’ll remove extra rows where the two-letter ISO code in <code>CNTRY</code> does not match the value in our new variable <code>CNTRY_CAL</code>. Finally, leaves all women with only two rows each.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CNTRY_CAL <span class="sc">==</span> CNTRY) <span class="sc">%&gt;%</span> </span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>CNTRY_CAL)</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>cals </span></code></pre></div>
<pre><code># A tibble: 35,450 × 7
      ID CNTRY PHASE CALSTART CALSTOP FPSTATUS                           WHYSTOP
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr+lbl&gt;                          &lt;chr+l&gt;
 1     1 BF    1         1417    1442 &quot;,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,… &quot;,,,,,…
 2     1 BF    2         1417    1453 &quot;,,,,,,,,,,,3,3,3,3,3,3,0,0,0,0,0… &quot;,,,,,…
 3     2 BF    1         1417    1441 &quot;,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0,0… &quot;,,,,,…
 4     2 BF    2         1417    1453 &quot;,,,,,,,,,,,,5,5,5,5,5,5,5,5,5,B,… &quot;,,,,,…
 5     3 BF    1         1417    1441 &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0… &quot;&quot;     
 6     3 BF    2         1417    1453 &quot;&quot;                                 &quot;&quot;     
 7     4 BF    1         1417    1441 &quot;,,,,,,,,,,,0,0,0,5,5,5,5,5,5,5,5… &quot;,,,,,…
 8     4 BF    2         1417    1452 &quot;,,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,… &quot;,,,,,…
 9     5 BF    1         1417    1441 &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0… &quot;,,,,,…
10     5 BF    2         1417    1453 &quot;&quot;                                 &quot;&quot;     
# … with 35,440 more rows</code></pre>
<p>We’re nearly ready to split each string into more usable variables for our analysis. But, before we do so: you might notice that there are still some calendars represented by empty character strings <code>""</code> (see <code>FPSTATUS</code> in rows 6 and 10 above). These are cases where calendar data are not available.</p>
</div>
<div id="blank-strings" class="section level3" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Blank Strings</h3>
<p>There are two reasons why a woman’s calendar might be unavailable.</p>
<aside>
The <strong>universe tab</strong> explains why some cases are “NIU (not in universe)”.
</aside>
<p>First, these women might be “NIU (not in universe)”, as described on the IPUMS PMA <a href="https://pma.ipums.org/pma-action/variables/CALENDARKE#universe_section">universe tab</a> for each country’s contraceptive calendar. Generally, NIU cases are women who reported no qualifying event during the calendar period: a blank string could indicate that she was never pregnant and never adopted or discontinued a family planning method in any month during that period.</p>
<p><img src="images/universe2.png" width="85%" style="display: block; margin: auto;" /></p>
<p>Second, a blank might reflect <strong>missing</strong> data, like the duration of a pregnancy or an episode of continuous contraceptive use. Contraceptive calendars <strong>do not contain missing values for individual months</strong>, so you’ll find the complete calendar missing if data from any one month was missing.</p>
<div class="page-break-after"></div>
<p>About 1 in every 5 calendars in our dataset <code>cals</code> is blank <code>""</code> for one of the two reasons mentioned above.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">count</span>(FPSTATUS <span class="sc">==</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n))</span></code></pre></div>
<pre><code># A tibble: 2 × 3
  `FPSTATUS == &quot;&quot;`     n  prop
  &lt;lgl&gt;            &lt;int&gt; &lt;dbl&gt;
1 FALSE            28173 0.795
2 TRUE              7277 0.205</code></pre>
<p>In some research applications, you might want to complete the empty calendars for women who were NIU.</p>
<p>For example: if a woman used the contraceptive pill from the beginning of the calendar period continuously through the day of the interview, her calendar is currently blank because she neither started nor stopped using the pill in that time span. You might want to fill her calendar with the value <code>7</code> repeated once for every month between <code>CALSTART</code> and <code>CALSTOP</code>.</p>
<p>Similarly, we can complete all calendars for women who never used a family planning method and were never pregnant during the calendar period: in this case, we’ll repeat the value <code>0</code>.</p>
<p>Note, however, that it is <em>not</em> possible to complete calendars for women who experienced birth or pregnancy termination during the calendar period. If these calendars are blank, we cannot determine the duration of the pregnancy or whether any family planning method was used prior to the pregnancy. We’ll flag these cases with a new variable we’ll call <code>CALMISSING</code>.</p>
<ul>
<li><code>CALMISSING</code> - Indicates whether a blank calendar cannot be completed from other variables</li>
</ul>
<p>We’ll begin by attaching all of the <code>CMC</code> variables we created above (except <code>INTFQCMC</code>) along with the variables <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a> and <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>. In order to match the format of <code>cals</code>, we’ll again use <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> to create separate rows for the dates collected from each <code>PHASE</code>.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>    ID, <span class="fu">matches</span>(<span class="st">&quot;CMC&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">matches</span>(<span class="st">&quot;INTFQ&quot;</span>),</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;PREGNANT&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;FPCURREFFMETHRC&quot;</span>),</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>ID,</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;(.*)_(.*)&quot;</span>,</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;PHASE&quot;</span>)</span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(cals, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;PHASE&quot;</span>))</span></code></pre></div>
<div class="page-break-after"></div>
<p>Now, we’ll create <code>CALMISSING</code> to indicate whether women with an empty value <code>""</code> in <code>FPSTATUS</code> were <em>actually</em> pregnant or adopted a family planning method at some point during the calendar period. In other words: we’ll test whether any one of our <code>CMC</code> variables shows an event that occurred after <code>CALSTART</code>, but is not recorded in <code>FPSTATUS</code>. Likewise, this check will determine whether any such women are <em>currently</em> pregnant.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CALMISSING =</span> FPSTATUS <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> WHYSTOP <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> {</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>      PREGNANT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">if_any</span>(<span class="fu">ends_with</span>(<span class="st">&quot;CMC&quot;</span>), <span class="sc">~!</span><span class="fu">is.na</span>(.x) <span class="sc">&amp;</span> .x <span class="sc">&gt;=</span> CALSTART)</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Let’s use <a href="https://dplyr.tidyverse.org/reference/glimpse.html">glimpse</a> to take a closer look at the data collected
for the woman row 6, whose Phase 2 <code>FPSTATUS</code> calendar is an empty string.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>Rows: 1
Columns: 17
$ ID              &lt;int&gt; 3
$ PHASE           &lt;chr&gt; &quot;2&quot;
$ KID1STBIRTHCMC  &lt;dbl&gt; NA
$ FPBEGINUSECMC   &lt;dbl&gt; NA
$ LASTBIRTHCMC    &lt;dbl&gt; NA
$ OTHERBIRTHCMC   &lt;dbl&gt; NA
$ PANELBIRTHCMC   &lt;dbl&gt; NA
$ PREGENDCMC      &lt;dbl&gt; NA
$ PANELPREGENDCMC &lt;dbl&gt; NA
$ PREGNANT        &lt;int+lbl&gt; 0
$ FPCURREFFMETHRC &lt;int+lbl&gt; 999
$ CNTRY           &lt;chr&gt; &quot;BF&quot;
$ CALSTART        &lt;dbl&gt; 1417
$ CALSTOP         &lt;dbl&gt; 1453
$ FPSTATUS        &lt;chr+lbl&gt; &quot;&quot;
$ WHYSTOP         &lt;chr+lbl&gt; &quot;&quot;
$ CALMISSING      &lt;lgl&gt; FALSE</code></pre>
<p>We know that this woman has never given birth because all of the <code>CMC</code> variables related to birth are <code>NA</code>; moreover, <code>PREGNANT == 0</code> indicates that she is not currently pregnant. She also has not used contraception, as indicated by <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> and <code>FPBEGINUSECMC</code>. So, we have marked <code>CALMISSING = FALSE</code> because it’s safe to auto-complete her calendar with the value <code>0</code> for every month between <code>CALSTART</code> and <code>CALSTOP</code>.</p>
<div class="page-break-after"></div>
<p>On the other hand, consider the woman in row 10, whose Phase 2 <code>FPSTATUS</code> calendar is also an empty string.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>Rows: 1
Columns: 17
$ ID              &lt;int&gt; 5
$ PHASE           &lt;chr&gt; &quot;2&quot;
$ KID1STBIRTHCMC  &lt;dbl&gt; 1366
$ FPBEGINUSECMC   &lt;dbl&gt; NA
$ LASTBIRTHCMC    &lt;dbl&gt; 1422
$ OTHERBIRTHCMC   &lt;dbl&gt; NA
$ PANELBIRTHCMC   &lt;dbl&gt; NA
$ PREGENDCMC      &lt;dbl&gt; NA
$ PANELPREGENDCMC &lt;dbl&gt; NA
$ PREGNANT        &lt;int+lbl&gt; 0
$ FPCURREFFMETHRC &lt;int+lbl&gt; 999
$ CNTRY           &lt;chr&gt; &quot;BF&quot;
$ CALSTART        &lt;dbl&gt; 1417
$ CALSTOP         &lt;dbl&gt; 1453
$ FPSTATUS        &lt;chr+lbl&gt; &quot;&quot;
$ WHYSTOP         &lt;chr+lbl&gt; &quot;&quot;
$ CALMISSING      &lt;lgl&gt; TRUE</code></pre>
<p>You can see in <code>LASTBIRTHCMC</code> that she gave birth in month <code>1422</code>, 5 months after
we’d hope to see reported events beginning in <code>CALSTART == 1417</code>. We have flagged this row with <code>CALMISSING == TRUE</code> because we won’t be able to reconstruct her <code>FPSTATUS</code> calendar without knowing exactly when she became pregnant for this birth, or whether she was using a family planning method in any month prior.</p>
<p>Counting the number of women flagged by <code>CALMISSING</code> we see that we’ll now be able to reduce the number of missing calendars from 1 in 5 cases to less than 1 in 20.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">count</span>(CALMISSING, FPSTATUS <span class="sc">==</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">prop.table</span>(n))</span></code></pre></div>
<pre><code># A tibble: 3 × 4
  CALMISSING `FPSTATUS == &quot;&quot;`     n   prop
  &lt;lgl&gt;      &lt;lgl&gt;            &lt;int&gt;  &lt;dbl&gt;
1 FALSE      FALSE            28173 0.795 
2 FALSE      TRUE              5816 0.164 
3 TRUE       TRUE              1461 0.0412</code></pre>
<div class="page-break-after"></div>
<p>We’ll now complete the blank calendars for women who were not flagged by <code>CALMISSING</code>. First, we’ll recode <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> to match the values used in the calendar:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPCURREFFMETHRC =</span> FPCURREFFMETHRC <span class="sc">%&gt;%</span> </span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">zap_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># NA if &quot;No response or missing&quot; (1 case)</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">na_if</span>(<span class="dv">998</span>) <span class="sc">%&gt;%</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Note: 5 is used twice, and 6 is not used </span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">recode</span>(</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;999&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;101&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;102&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;111&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot;112&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;121&quot;</span> <span class="ot">=</span> <span class="dv">5</span>,</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;123&quot;</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">&quot;131&quot;</span> <span class="ot">=</span> <span class="dv">7</span>, <span class="st">&quot;132&quot;</span> <span class="ot">=</span> <span class="dv">8</span>, <span class="st">&quot;141&quot;</span> <span class="ot">=</span> <span class="dv">9</span>, <span class="st">&quot;142&quot;</span> <span class="ot">=</span> <span class="dv">10</span>, <span class="st">&quot;151&quot;</span> <span class="ot">=</span> <span class="dv">11</span>, </span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;152&quot;</span> <span class="ot">=</span> <span class="dv">12</span>, <span class="st">&quot;160&quot;</span> <span class="ot">=</span> <span class="dv">13</span>, <span class="st">&quot;170&quot;</span> <span class="ot">=</span> <span class="dv">14</span>, <span class="st">&quot;210&quot;</span> <span class="ot">=</span> <span class="dv">30</span>, <span class="st">&quot;220&quot;</span> <span class="ot">=</span> <span class="dv">31</span>, <span class="st">&quot;240&quot;</span> <span class="ot">=</span> <span class="dv">39</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Then, we’ll create <code>CALDUR</code> to calculate the duration (in months) of each woman’s calendar.</p>
<ul>
<li><code>CALDUR</code> - Duration of a woman’s calendar (in months)</li>
</ul>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CALDUR =</span> CALSTOP <span class="sc">-</span> CALSTART <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Finally, we’ll complete each empty string in <code>FPSTATUS</code> for women not flagged by <code>CALMISSING</code> (leaving it the same otherwise). To clean-up, we’ll also drop any variables that are no longer needed.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FPSTATUS =</span> <span class="fu">if_else</span>(</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If `FPSTATUS` is blank and `CALMISSING` is FALSE...</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    FPSTATUS <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span>CALMISSING,</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Repeat &quot;,&quot; and the value in `FPCURREFFMETHRC` as many times as `CALDUR`:</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_c</span>(<span class="st">&quot;,&quot;</span>, FPCURREFFMETHRC) <span class="sc">%&gt;%</span> <span class="fu">str_dup</span>(CALDUR), </span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise, recycle `FPSTATUS` as a character string:</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(FPSTATUS)</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">&quot;CMC&quot;</span>), CALDUR, CALSTOP, </span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>    CALMISSING, PREGNANT, FPCURREFFMETHRC</span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<div class="page-break-after"></div>
<p>Returning to our example, row 6 is now completed with the value <code>0</code>, excluding the first month (we leave this blank because this woman’s interview was one month before the final month of Phase 2 data collection in Burkina Faso). Row 10 is left unchanged.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>cals </span></code></pre></div>
<pre><code># A tibble: 35,450 × 6
      ID PHASE CNTRY CALSTART FPSTATUS                                   WHYSTOP
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                                      &lt;chr+l&gt;
 1     1 1     BF        1417 &quot;,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,B,P,P,… &quot;,,,,,…
 2     1 2     BF        1417 &quot;,,,,,,,,,,,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0… &quot;,,,,,…
 3     2 1     BF        1417 &quot;,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0,0,0,0,0,3… &quot;,,,,,…
 4     2 2     BF        1417 &quot;,,,,,,,,,,,,5,5,5,5,5,5,5,5,5,B,P,P,P,P,… &quot;,,,,,…
 5     3 1     BF        1417 &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0… &quot;&quot;     
 6     3 2     BF        1417 &quot;,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0… &quot;&quot;     
 7     4 1     BF        1417 &quot;,,,,,,,,,,,0,0,0,5,5,5,5,5,5,5,5,5,5,5,0… &quot;,,,,,…
 8     4 2     BF        1417 &quot;,,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,… &quot;,,,,,…
 9     5 1     BF        1417 &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0… &quot;,,,,,…
10     5 2     BF        1417 &quot;&quot;                                         &quot;&quot;     
# … with 35,440 more rows</code></pre>
</div>
<div id="split-months-into-columns" class="section level3" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> Split Months into Columns</h3>
<p>We’ve now completed as many of the blank calendars as we can, so it’s time to transform each calendar string into variables that will be usable in survival analysis.</p>
<p>We’ll begin with another <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> function to position <code>FPSTATUS</code> and <code>WHYSTOP</code> together in a single column. Notice the temporary column <code>name</code> describes the type of calendar that appears in the temporary column <code>value</code>.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">&quot;FPSTATUS&quot;</span>, <span class="st">&quot;WHYSTOP&quot;</span>))</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>cals </span></code></pre></div>
<pre><code># A tibble: 70,900 × 6
      ID PHASE CNTRY CALSTART name     value                                    
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr+lbl&gt;                                
 1     1 1     BF        1417 FPSTATUS &quot;,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,B,P,P…
 2     1 1     BF        1417 WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,&quot;    
 3     1 2     BF        1417 FPSTATUS &quot;,,,,,,,,,,,3,3,3,3,3,3,0,0,0,0,0,0,0,0,…
 4     1 2     BF        1417 WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,…
 5     2 1     BF        1417 FPSTATUS &quot;,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0,0,0,0,0,…
 6     2 1     BF        1417 WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,6,,,,,,,,,,&quot;   
 7     2 2     BF        1417 FPSTATUS &quot;,,,,,,,,,,,,5,5,5,5,5,5,5,5,5,B,P,P,P,P…
 8     2 2     BF        1417 WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,6,,…
 9     3 1     BF        1417 FPSTATUS &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
10     3 1     BF        1417 WHYSTOP  &quot;&quot;                                       
# … with 70,890 more rows</code></pre>
<p>Now, we’ll use <a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a> to split each string into several columns. You can manually specify the maximum number of columns you’ll need to hold all of the calendars in your data extract, or you can let R determine the <a href="https://rdrr.io/r/base/Extremes.html">max</a> length of each string.<span id="fn34" class="footnote" data-pagedown-footnote-number="34" style="white-space: pre-line;">Here, we’re counting the number of commas in each string, so we add <code>+1</code> (e.g. <code>0,0,0</code> has two commas, but three responses).</span> We’ll call this number <code>ncols</code>.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many columns would be needed for the single longest calendar? </span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>ncols <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">str_count</span>(cals<span class="sc">$</span>value, <span class="st">&quot;,&quot;</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>ncols </span></code></pre></div>
<pre><code>[1] 48</code></pre>
<div class="page-break-after"></div>
<p>In <a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a>, we tell R to split each string <code>into</code> 48 columns: if any given calendar has fewer than 48 values, we <code>fill</code> the left-most columns with the value <code>NA</code> as needed.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create one column for every month in the longest calendar</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(value, <span class="at">into =</span> <span class="fu">paste0</span>(<span class="st">&quot;cal&quot;</span>, ncols<span class="sc">:</span><span class="dv">1</span>), <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;left&quot;</span>, )</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>cals </span></code></pre></div>
<pre><code># A tibble: 70,900 × 53
      ID PHASE CNTRY CALSTART name     cal48 cal47 cal46 cal45 cal44 cal43 cal42
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1     1 1     BF        1417 FPSTATUS &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 2     1 1     BF        1417 WHYSTOP  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 3     1 2     BF        1417 FPSTATUS &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 4     1 2     BF        1417 WHYSTOP  &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 5     2 1     BF        1417 FPSTATUS &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 6     2 1     BF        1417 WHYSTOP  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 7     2 2     BF        1417 FPSTATUS &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 8     2 2     BF        1417 WHYSTOP  &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 9     3 1     BF        1417 FPSTATUS &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
10     3 1     BF        1417 WHYSTOP  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
# … with 70,890 more rows, and 41 more variables: cal41 &lt;chr&gt;, cal40 &lt;chr&gt;,
#   cal39 &lt;chr&gt;, cal38 &lt;chr&gt;, cal37 &lt;chr&gt;, cal36 &lt;chr&gt;, cal35 &lt;chr&gt;,
#   cal34 &lt;chr&gt;, cal33 &lt;chr&gt;, cal32 &lt;chr&gt;, cal31 &lt;chr&gt;, cal30 &lt;chr&gt;,
#   cal29 &lt;chr&gt;, cal28 &lt;chr&gt;, cal27 &lt;chr&gt;, cal26 &lt;chr&gt;, cal25 &lt;chr&gt;,
#   cal24 &lt;chr&gt;, cal23 &lt;chr&gt;, cal22 &lt;chr&gt;, cal21 &lt;chr&gt;, cal20 &lt;chr&gt;,
#   cal19 &lt;chr&gt;, cal18 &lt;chr&gt;, cal17 &lt;chr&gt;, cal16 &lt;chr&gt;, cal15 &lt;chr&gt;,
#   cal14 &lt;chr&gt;, cal13 &lt;chr&gt;, cal12 &lt;chr&gt;, cal11 &lt;chr&gt;, cal10 &lt;chr&gt;, …</code></pre>
<p>As you can see, this produced 48 columns named <code>cal48</code> to <code>cal1</code>, where <code>cal1</code> is the earliest month in chronological time. You’ll notice some blank strings for women whose calendar included empty placeholders (e.g. <code>,,,,,,,3,3,3...</code>). We’ll use <a href="https://dplyr.tidyverse.org/reference/across.html">across</a> to convert blank values <code>""</code> to <code>NA</code> as well.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;cal&quot;</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>),</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">na_if</span>(.x, <span class="st">&quot;&quot;</span>)</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
</div>
<div id="one-row-per-month" class="section level3" number="6.4.5">
<h3><span class="header-section-number">6.4.5</span> One Row per Month</h3>
<p>Finally, we’ll want to use <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> one more time, reorganizing the data for each month into a separate row. This will allow us to label each month with the correct CMC value, and to align overlapping calendars collected in Phase 1 and Phase 2.</p>
<p>Here, we place each month into a single column temporarily called <code>value</code>. The label shown in <code>name</code> describes whether a particular <code>value</code> originated in the <code>FPSTATUS</code> or <code>WHYSTOP</code> calendar. We strip the numeric suffix from each column to create <code>MONTH</code>, which indicates the sequential month associated with each <code>value</code>.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals  <span class="sc">%&gt;%</span> </span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;cal&quot;</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>), </span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;MONTH&quot;</span>, </span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;cal&quot;</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>cals </span></code></pre></div>
<pre><code># A tibble: 3,403,200 × 7
      ID PHASE CNTRY CALSTART name     MONTH value
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
 1     1 1     BF        1417 FPSTATUS 48    &lt;NA&gt; 
 2     1 1     BF        1417 FPSTATUS 47    &lt;NA&gt; 
 3     1 1     BF        1417 FPSTATUS 46    &lt;NA&gt; 
 4     1 1     BF        1417 FPSTATUS 45    &lt;NA&gt; 
 5     1 1     BF        1417 FPSTATUS 44    &lt;NA&gt; 
 6     1 1     BF        1417 FPSTATUS 43    &lt;NA&gt; 
 7     1 1     BF        1417 FPSTATUS 42    &lt;NA&gt; 
 8     1 1     BF        1417 FPSTATUS 41    &lt;NA&gt; 
 9     1 1     BF        1417 FPSTATUS 40    &lt;NA&gt; 
10     1 1     BF        1417 FPSTATUS 39    &lt;NA&gt; 
# … with 3,403,190 more rows</code></pre>
<p>From <code>MONTH</code> and <code>CALSTART</code>, we’ll derive <code>CALCMC</code> to mark the CMC for each <code>value</code>.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CALCMC =</span> CALSTART <span class="sc">+</span> <span class="fu">as.integer</span>(MONTH) <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="page-break-after"></div>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>cals </span></code></pre></div>
<pre><code># A tibble: 3,403,200 × 8
      ID PHASE CNTRY CALSTART name     MONTH value CALCMC
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1     1 1     BF        1417 FPSTATUS 48    &lt;NA&gt;    1464
 2     1 1     BF        1417 FPSTATUS 47    &lt;NA&gt;    1463
 3     1 1     BF        1417 FPSTATUS 46    &lt;NA&gt;    1462
 4     1 1     BF        1417 FPSTATUS 45    &lt;NA&gt;    1461
 5     1 1     BF        1417 FPSTATUS 44    &lt;NA&gt;    1460
 6     1 1     BF        1417 FPSTATUS 43    &lt;NA&gt;    1459
 7     1 1     BF        1417 FPSTATUS 42    &lt;NA&gt;    1458
 8     1 1     BF        1417 FPSTATUS 41    &lt;NA&gt;    1457
 9     1 1     BF        1417 FPSTATUS 40    &lt;NA&gt;    1456
10     1 1     BF        1417 FPSTATUS 39    &lt;NA&gt;    1455
# … with 3,403,190 more rows</code></pre>
<p>Finally, we’ll use <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a> to align the months for each available calendar, and then arrange each woman’s calendar by <code>CALCMC</code>. If any month includes no value from either Phase 1 or Phase 2, we’ll use <a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a> to remove it from our data frame (these are placeholder values for future months).</p>
<p>In its final format, <code>cals</code> contains one row for every month covered by the contraceptive calendar from either Phase 1 or Phase 2. You’ll notice that the two calendars contain overlapping months, as with the dates between <code>CALCMC</code> 1417 and 1442 for the first woman shown below.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>cals <span class="ot">&lt;-</span> cals <span class="sc">%&gt;%</span> </span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, PHASE, CALCMC, name, value) <span class="sc">%&gt;%</span> </span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="fu">c</span>(name, PHASE), </span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(FPSTATUS_1) <span class="sc">&amp;</span> FPSTATUS_2 <span class="sc">==</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, <span class="fu">desc</span>(CALCMC)) </span></code></pre></div>
<div class="page-break-after"></div>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>cals <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">40</span>)</span></code></pre></div>
<pre><code># A tibble: 769,636 × 6
      ID CALCMC FPSTATUS_1 WHYSTOP_1 FPSTATUS_2 WHYSTOP_2
   &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    
 1     1   1453 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 2     1   1452 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 3     1   1451 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 4     1   1450 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 5     1   1449 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 6     1   1448 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 7     1   1447 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
 8     1   1446 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
 9     1   1445 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
10     1   1444 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
11     1   1443 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
12     1   1442 0          &lt;NA&gt;      0          &lt;NA&gt;     
13     1   1441 0          &lt;NA&gt;      0          &lt;NA&gt;     
14     1   1440 0          &lt;NA&gt;      0          &lt;NA&gt;     
15     1   1439 0          &lt;NA&gt;      0          &lt;NA&gt;     
16     1   1438 0          &lt;NA&gt;      0          &lt;NA&gt;     
17     1   1437 0          &lt;NA&gt;      0          &lt;NA&gt;     
18     1   1436 0          &lt;NA&gt;      0          &lt;NA&gt;     
19     1   1435 0          &lt;NA&gt;      0          &lt;NA&gt;     
20     1   1434 0          &lt;NA&gt;      0          &lt;NA&gt;     
21     1   1433 0          &lt;NA&gt;      0          &lt;NA&gt;     
22     1   1432 0          &lt;NA&gt;      0          &lt;NA&gt;     
23     1   1431 0          &lt;NA&gt;      0          &lt;NA&gt;     
24     1   1430 B          &lt;NA&gt;      B          &lt;NA&gt;     
25     1   1429 P          &lt;NA&gt;      P          &lt;NA&gt;     
26     1   1428 P          &lt;NA&gt;      P          &lt;NA&gt;     
27     1   1427 P          &lt;NA&gt;      P          &lt;NA&gt;     
28     1   1426 P          &lt;NA&gt;      P          &lt;NA&gt;     
29     1   1425 P          &lt;NA&gt;      P          &lt;NA&gt;     
30     1   1424 P          &lt;NA&gt;      P          &lt;NA&gt;     
31     1   1423 P          &lt;NA&gt;      P          &lt;NA&gt;     
32     1   1422 P          &lt;NA&gt;      0          &lt;NA&gt;     
33     1   1421 0          &lt;NA&gt;      0          &lt;NA&gt;     
34     1   1420 0          &lt;NA&gt;      0          &lt;NA&gt;     
35     1   1419 0          &lt;NA&gt;      0          &lt;NA&gt;     
36     1   1418 0          &lt;NA&gt;      0          &lt;NA&gt;     
37     1   1417 0          &lt;NA&gt;      0          &lt;NA&gt;     
38     2   1452 &lt;NA&gt;       &lt;NA&gt;      5          &lt;NA&gt;     
39     2   1451 &lt;NA&gt;       &lt;NA&gt;      5          &lt;NA&gt;     
40     2   1450 &lt;NA&gt;       &lt;NA&gt;      5          &lt;NA&gt;     
# … with 769,596 more rows</code></pre>
</div>
</div>
<div id="analysis" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Analysis</h2>
<p>There are many ways to work with the contraceptive calendar data once you’ve formatted it this way. For example, we just saw that the <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code> columns are a <em>nearly</em> perfect match for the woman marked <code>ID == 1</code>: she reports that she used no method of contraception between month <code>1417</code> until month <code>1421</code>. Then, in Phase 1 she recalled that she became pregnant in month <code>1422</code>; in Phase 2, she instead recalled that she became pregnant in month <code>1423</code>. In both phases, she reports that she gave birth in month <code>1430</code>, and then returned to using no family planning method.</p>
<p>We encourage researchers to explore sources of <strong>recall bias</strong> that may account for discrepancies between the Phase 1 and Phase 2 calendars. Generally, we assume that individuals remember events more reliably when they are in recent memory, but this may not always be true! For more on the reliability of responses in contraceptive calendars across PMA samples, we strongly recommend checking out work by <a href="https://paa.confex.com/paa/2022/meetingapp.cgi/Paper/26280">Anglewicz et al.</a>.</p>
<p>Here, we’d like to highlight just one way that the PMA panel design might help researchers understand patterns in the calendar data. In previous chapters, we saw that IPUMS PMA includes variables indicating whether women had <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">unmet need</a> or <a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">plans to adopt</a> a contraceptive method in each phase. We’ll now examine these variables at Phase 1, and use the <strong>Contraceptive Calendar</strong> data from Phase 2 to test whether either factor influences the adoption rate of contraceptive methods reported one year later.</p>
<p>First, we’ll need to identify women who were not using any family planning method at Phase 1. These are cases where <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC_1</a> is coded <code>999</code> for “NIU (not in universe)”. We’ll drop any other cases from our original data frame <code>dat</code>, and we’ll call this new data frame <code>nonusers</code>.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>nonusers <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(FPCURREFFMETHRC_1 <span class="sc">==</span> <span class="dv">999</span>)</span></code></pre></div>
<p>We’ll follow steps in Chapter 4 to identify women who meet the PMA criteria for “unmet need” in <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN_1</a>, and also those who planned to adopt a family planning method within one year at Phase 1 as shown in <a href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL_1</a> and <a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN_1</a>.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>nonusers <span class="ot">&lt;-</span> nonusers <span class="sc">%&gt;%</span> </span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">UNMETYN_1 =</span> UNMETYN_1 <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPPLANYR_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> FPPLANVAL_1 <span class="sc">&lt;=</span> <span class="dv">12</span> <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co"># Within 12 months </span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> FPPLANVAL_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co"># Within 1 year</span></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co"># Soon / now, after current pregnancy</span></span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">FALSE</span> <span class="co"># Includes date unknown, no response, or no intention (FPUSPLAN)</span></span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Also in Chapter 4, we demonstrated how to create a <a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a> for graphics built with <a href="https://ggplot2.tidyverse.org">ggplot2</a>. We’ll do so again here, creating <code>theme_pma</code>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>theme_pma <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>() <span class="sc">%+replace%</span> </span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;cabrito&quot;</span>, <span class="at">size =</span> <span class="dv">42</span>),</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">72</span>, <span class="at">color =</span> <span class="st">&quot;#00263A&quot;</span>, </span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">5</span>)),</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>)),</span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Before we begin our analysis, let’s check the proportion of <code>nonusers</code> in each country who had unmet need or plans to adopt a family planning method within one year at Phase 1.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>nonusers <span class="sc">%&gt;%</span> </span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COUNTRY) <span class="sc">%&gt;%</span> </span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(UNMETYN_1, FPPLANYR_1) <span class="sc">%&gt;%</span> </span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> <span class="fu">prop.table</span>(n),</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">UNMETYN_1 =</span> UNMETYN_1 <span class="sc">%&gt;%</span> <span class="fu">if_else</span>(<span class="st">&quot;Unmet Need&quot;</span>, <span class="st">&quot;No Unmet Need&quot;</span>),</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPPLANYR_1 =</span> FPPLANYR_1 <span class="sc">%&gt;%</span> <span class="fu">if_else</span>(<span class="st">&quot;Plans&quot;</span>, <span class="st">&quot;No Plans&quot;</span>),</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> UNMETYN_1, <span class="at">y =</span> FPPLANYR_1)) <span class="sc">+</span> </span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">fill =</span> <span class="st">&quot;#98579BB0&quot;</span>, <span class="fu">aes</span>(<span class="at">alpha =</span> prop)) <span class="sc">+</span> </span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(prop, <span class="fl">0.1</span>))) <span class="sc">+</span> </span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(COUNTRY), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Non-users: Unmet Need and Plans to Adopt a Method within 1 Year&quot;</span>,</span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Percentage among sampled women not using a method at Phase 1&quot;</span>,</span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>  theme_pma <span class="sc">%+replace%</span> </span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="images/ch6heat.png" width="75%" style="display: block; margin: auto;" /></p>
<p>As you can see, a majority of Phase 1 <code>nonusers</code> in each country had no unmet need and no plans to adopt a method within the next year. We might expect these women to be <em>least likely</em> to adopt a method within the subsequent months covered by the Phase 2 contraceptive calendar.</p>
<p>Conversely, we might expect women who planned to adopt a method would be <em>most likely</em> to adopt one within the year, but also that this might be mitigated by factors related to unmet need.</p>
<p>Let’s now attach the contraceptive calendar data from Phase 2 to <code>nonusers</code>. We’ll exclude months before <code>INTFQCMC_1</code> and women we identified with <code>CALMISSING</code> (where all values in <code>FPSTATUS_2</code> are now <code>NA</code>). Finally, we’ll exclude women for whom either <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN_1</a> or <a href="https://pma.ipums.org/pma-action/variables/FPPLANYR#codes_section">FPPLANYR_1</a> is missing, NIU, or otherwise coded <code>NA</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>nonusers <span class="ot">&lt;-</span> nonusers <span class="sc">%&gt;%</span> </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, COUNTRY, INTFQCMC_1, UNMETYN_1, FPPLANYR_1) <span class="sc">%&gt;%</span> </span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(cals <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, FPSTATUS_2, CALCMC), <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>    CALCMC <span class="sc">&gt;=</span> INTFQCMC_1, </span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">if_any</span>(<span class="fu">c</span>(FPSTATUS_2, UNMETYN_1, FPPLANYR_1), is.na)</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div id="right-censoring" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Right-censoring</h3>
<p>A key concept in survival analysis is the idea of <strong>right-censoring</strong>, which refers to cases where the event of interest happens after the last observation point (or no at all). It’s important that we identify these cases now so that we don’t mistake them for women who first adopted a method during the month of the Phase 2 interview.</p>
<p>First, we’ll want to identify the earliest month in which each woman reported using a method, if she did so at all. To do this, we’ll begin by identifying months of contraceptive <code>USE</code> as those where <code>FPSTATUS_2</code> contains any value other than <code>0</code>, <code>B</code>, <code>P</code>, or <code>T</code>.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>nonusers <span class="ot">&lt;-</span> nonusers <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">USE =</span> <span class="sc">!</span>FPSTATUS_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;T&quot;</span>))</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>nonusers</span></code></pre></div>
<pre><code># A tibble: 116,948 × 8
      ID COUNTRY      INTFQCMC_1 UNMETYN_1 FPPLANYR_1 FPSTATUS_2 CALCMC USE  
   &lt;int&gt; &lt;fct&gt;             &lt;dbl&gt; &lt;lgl&gt;     &lt;lgl&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;lgl&gt;
 1     1 Burkina Faso       1442 FALSE     TRUE       3            1453 TRUE 
 2     1 Burkina Faso       1442 FALSE     TRUE       3            1452 TRUE 
 3     1 Burkina Faso       1442 FALSE     TRUE       3            1451 TRUE 
 4     1 Burkina Faso       1442 FALSE     TRUE       3            1450 TRUE 
 5     1 Burkina Faso       1442 FALSE     TRUE       3            1449 TRUE 
 6     1 Burkina Faso       1442 FALSE     TRUE       3            1448 TRUE 
 7     1 Burkina Faso       1442 FALSE     TRUE       0            1447 FALSE
 8     1 Burkina Faso       1442 FALSE     TRUE       0            1446 FALSE
 9     1 Burkina Faso       1442 FALSE     TRUE       0            1445 FALSE
10     1 Burkina Faso       1442 FALSE     TRUE       0            1444 FALSE
11     1 Burkina Faso       1442 FALSE     TRUE       0            1443 FALSE
12     1 Burkina Faso       1442 FALSE     TRUE       0            1442 FALSE
13     2 Burkina Faso       1441 FALSE     FALSE      5            1452 TRUE 
14     2 Burkina Faso       1441 FALSE     FALSE      5            1451 TRUE 
15     2 Burkina Faso       1441 FALSE     FALSE      5            1450 TRUE 
# … with 116,933 more rows</code></pre>
<p>Above, we can see that 6 months pass before the woman with <code>ID == 1</code> adopts a a method (code <code>3</code> for implant). However, some women <em>never</em> adopt a method before the Phase 2 interview. These cases are right-censored.</p>
<p>Ultimately, we’ll want to include only one row for each woman in our analysis. For those who adopted a method, we’ll need to find the earliest month of <code>USE</code>. For right-censored cases, we’ll include only the month of the Phase 2 interview.</p>
<p>We begin by numbering each month in a variable call <code>MO</code>, counting upward from <code>0</code> for the Phase 1 interview. We’ll then create an exact copy of <code>MO</code> called <code>USEMO</code> that is <code>NA</code> for months of non-<code>USE</code>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>nonusers <span class="ot">&lt;-</span> nonusers <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">MO =</span> CALCMC <span class="sc">-</span> INTFQCMC_1,</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">USEMO =</span> <span class="fu">case_when</span>(USE <span class="sc">~</span> MO)</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(CALCMC, INTFQCMC_1))</span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>nonusers </span></code></pre></div>
<pre><code># A tibble: 116,948 × 8
      ID COUNTRY      UNMETYN_1 FPPLANYR_1 FPSTATUS_2 USE      MO USEMO
   &lt;int&gt; &lt;fct&gt;        &lt;lgl&gt;     &lt;lgl&gt;      &lt;chr&gt;      &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1 Burkina Faso FALSE     TRUE       3          TRUE     11    11
 2     1 Burkina Faso FALSE     TRUE       3          TRUE     10    10
 3     1 Burkina Faso FALSE     TRUE       3          TRUE      9     9
 4     1 Burkina Faso FALSE     TRUE       3          TRUE      8     8
 5     1 Burkina Faso FALSE     TRUE       3          TRUE      7     7
 6     1 Burkina Faso FALSE     TRUE       3          TRUE      6     6
 7     1 Burkina Faso FALSE     TRUE       0          FALSE     5    NA
 8     1 Burkina Faso FALSE     TRUE       0          FALSE     4    NA
 9     1 Burkina Faso FALSE     TRUE       0          FALSE     3    NA
10     1 Burkina Faso FALSE     TRUE       0          FALSE     2    NA
11     1 Burkina Faso FALSE     TRUE       0          FALSE     1    NA
12     1 Burkina Faso FALSE     TRUE       0          FALSE     0    NA
13     2 Burkina Faso FALSE     FALSE      5          TRUE     11    11
14     2 Burkina Faso FALSE     FALSE      5          TRUE     10    10
15     2 Burkina Faso FALSE     FALSE      5          TRUE      9     9
# … with 116,933 more rows</code></pre>
<p>The minimum value in <code>USEMO</code> is the month of adoption, and we’ll flag this month with a variable called <code>ADOPT</code>. However, if <em>no method was adopted</em> we’ll need to flag the maximum value in <code>MO</code> with both <code>ADOPT</code> <em>and</em> an additional variable indicating that the case is right-censored. This final variable, which we’ll call <code>RC</code>, helps functions in the <a href="https://github.com/therneau/survival">survival</a> package distinguish women who never adopted a method before Phase 2.</p>
<p>Finally, we’ll now drop every row except for those matching <code>ADOPT</code>. This leaves one row for each woman in <code>nonusers</code>.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>nonusers <span class="ot">&lt;-</span> nonusers <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADOPT =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(USE), <span class="fu">min</span>(USEMO, <span class="at">na.rm =</span> T), <span class="fu">max</span>(MO)),</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">RC =</span> <span class="fu">case_when</span>(ADOPT <span class="sc">==</span> MO <span class="sc">~</span> <span class="sc">!</span>USE)</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADOPT <span class="sc">==</span> MO)</span></code></pre></div>
<div class="page-break-after"></div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>nonusers </span></code></pre></div>
<pre><code># A tibble: 9,213 × 10
# Groups:   ID [9,213]
      ID COUNTRY      UNMETYN_1 FPPLANYR_1 FPSTA…¹ USE      MO USEMO ADOPT RC   
   &lt;int&gt; &lt;fct&gt;        &lt;lgl&gt;     &lt;lgl&gt;      &lt;chr&gt;   &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;
 1     1 Burkina Faso FALSE     TRUE       3       TRUE      6     6     6 FALSE
 2     2 Burkina Faso FALSE     FALSE      5       TRUE      3     3     3 FALSE
 3     3 Burkina Faso FALSE     FALSE      0       FALSE    12    NA    12 TRUE 
 4     6 Burkina Faso FALSE     FALSE      0       FALSE    12    NA    12 TRUE 
 5     7 Burkina Faso FALSE     FALSE      0       FALSE    11    NA    11 TRUE 
 6     8 Burkina Faso TRUE      FALSE      0       FALSE    11    NA    11 TRUE 
 7    13 Burkina Faso FALSE     TRUE       5       TRUE      0     0     0 FALSE
 8    16 Burkina Faso FALSE     FALSE      5       TRUE      8     8     8 FALSE
 9    17 Burkina Faso FALSE     TRUE       0       FALSE    11    NA    11 TRUE 
10    18 Burkina Faso FALSE     FALSE      0       FALSE    11    NA    11 TRUE 
11    21 Burkina Faso FALSE     FALSE      0       FALSE    11    NA    11 TRUE 
12    22 Burkina Faso FALSE     FALSE      0       FALSE    12    NA    12 TRUE 
13    26 Burkina Faso FALSE     FALSE      0       FALSE    11    NA    11 TRUE 
14    28 Burkina Faso FALSE     FALSE      0       FALSE    12    NA    12 TRUE 
15    29 Burkina Faso FALSE     FALSE      0       FALSE    13    NA    13 TRUE 
# … with 9,198 more rows, and abbreviated variable name ¹​FPSTATUS_2</code></pre>
<p>Above, only the women with IDs 1, 2, 13, and 16 ultimately adopted a method before Phase 2. All other visible cases are right-censored.</p>
</div>
<div id="survival-models" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Survival Models</h3>
<p>We’ll now fit three survival models predicting the duration of continuous non-use for the women in <code>nonusers</code>: one model for <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN_1</a>, one for <a href="https://pma.ipums.org/pma-action/variables/FPPLANYR#codes_section">FPPLANYR_1</a>, and one for their interaction effect, which we’ll call <code>INTERACT_1</code>. For each model, the function <a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a> reports the likelihood that a baseline non-user would have adopted any family planning method at each month in the calendar period.</p>
<p>We’ll run each model separately for each country, and we’ll use <a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy</a> to create a tidy summary table for each model.<span id="fn35" class="footnote" data-pagedown-footnote-number="35" style="white-space: pre-line;"><a href="https://broom.tidymodels.org/">broom</a> is installed, but not loaded, with the <a href="https://tidyverse.tidyverse.org">tidyverse</a>.</span> Notice the function <a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv(MO, !RC)</a>: this indicates that the event of interest occurs in month <code>MO</code>, but only if the case is not right-censored <code>!RC</code>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>adopt_models <span class="ot">&lt;-</span> nonusers <span class="sc">%&gt;%</span> </span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a variable capturing the interaction between intentions and unmet need</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">INTERACT_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>    UNMETYN_1 <span class="sc">&amp;</span> FPPLANYR_1 <span class="sc">~</span> <span class="st">&quot;Unmet Need, Plan&quot;</span>,</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>    UNMETYN_1 <span class="sc">&amp;</span> <span class="sc">!</span>FPPLANYR_1 <span class="sc">~</span> <span class="st">&quot;Unmet Need, No Plan&quot;</span>,</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>UNMETYN_1 <span class="sc">&amp;</span> FPPLANYR_1 <span class="sc">~</span> <span class="st">&quot;No Unmet Need, Plan&quot;</span>,</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>UNMETYN_1 <span class="sc">&amp;</span> <span class="sc">!</span>FPPLANYR_1 <span class="sc">~</span> <span class="st">&quot;No Unmet Need, No Plan&quot;</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate survival models for each country </span></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COUNTRY) <span class="sc">%&gt;%</span> </span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">unmet =</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(MO, <span class="sc">!</span>RC) <span class="sc">~</span> UNMETYN_1, <span class="at">data =</span> <span class="fu">cur_group</span>()) <span class="sc">%&gt;%</span> list, </span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plan =</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(MO, <span class="sc">!</span>RC) <span class="sc">~</span> FPPLANYR_1, <span class="at">data =</span> <span class="fu">cur_group</span>()) <span class="sc">%&gt;%</span> list, </span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">interact =</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(MO, <span class="sc">!</span>RC) <span class="sc">~</span> INTERACT_1, <span class="at">data =</span> <span class="fu">cur_group</span>()) <span class="sc">%&gt;%</span> list</span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tidy the output and relabel `CNTRY` for the figure</span></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.list), <span class="sc">~</span><span class="fu">map</span>(.x, broom<span class="sc">::</span>tidy)))</span></code></pre></div>
<p>Let’s start with the model featuring <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN_1</a>. If you <a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a> the <code>unmet</code> model output, you’ll see a separate row for each month reported for women with <code>UNMETYN_1=FALSE</code> and <code>UNMETYN_1=TRUE</code> in the column labelled <code>strata</code>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>adopt_models <span class="sc">%&gt;%</span> </span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(COUNTRY, unmet) <span class="sc">%&gt;%</span> </span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(unmet) <span class="sc">%&gt;%</span> </span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(strata <span class="sc">==</span> <span class="st">&quot;UNMETYN_1=FALSE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>strata) </span></code></pre></div>
<pre><code># A tibble: 59 × 9
   COUNTRY       time n.risk n.event n.censor estimate std.error conf.…¹ conf.…²
   &lt;fct&gt;        &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 Burkina Faso     0   2249     158        0    0.930   0.00580   0.940   0.919
 2 Burkina Faso     1   2091      20        0    0.921   0.00618   0.932   0.910
 3 Burkina Faso     2   2071      21        0    0.912   0.00657   0.923   0.900
 4 Burkina Faso     3   2050      25        0    0.900   0.00701   0.913   0.888
 5 Burkina Faso     4   2025      27        0    0.888   0.00747   0.902   0.875
 6 Burkina Faso     5   1998      22        0    0.879   0.00784   0.892   0.865
 7 Burkina Faso     6   1976      28        0    0.866   0.00829   0.880   0.852
 8 Burkina Faso     7   1948      26        0    0.855   0.00870   0.869   0.840
 9 Burkina Faso     8   1922      30        0    0.841   0.00916   0.857   0.826
10 Burkina Faso     9   1892      37        0    0.825   0.00972   0.841   0.809
11 Burkina Faso    10   1855      35       97    0.809   0.0102    0.826   0.793
12 Burkina Faso    11   1723      27      907    0.797   0.0107    0.813   0.780
13 Burkina Faso    12    789       5      687    0.792   0.0111    0.809   0.775
14 Burkina Faso    13     97       3       71    0.767   0.0212    0.800   0.736
15 Burkina Faso    14     23       0       23    0.767   0.0212    0.800   0.736
# … with 44 more rows, and abbreviated variable names ¹​conf.high, ²​conf.low</code></pre>
<p>Among non-users who had no unmet need at Phase 1, the column <code>n.risk</code> shows the total number of women remaining after the number of months passed in <code>time</code>. The column <code>estimate</code> shows the estimated probability that a randomly selected woman would remain in <code>n.risk</code> by that month (<code>conf.high</code> and <code>conf.low</code> report a 95% confidence interval by default).</p>
<p>For example, row 1 shows that there were 2249 women in the Phase 1 Burkina Faso sample who were not using family planning and had no unmet need. Among these, <code>n.event</code> shows that 158 adopted a family planning method less than one month after the interview: this leaves 93.0% of the group remaining before one full month had passed.</p>
<p>Note that column <code>n.censor</code> shows the number of right-censored cases at each month in <code>time</code>. For example, 97 cases in Burkina Faso are right-censored after 10 months: these are the women interviewed in the earliest month of Phase 2 data collection (December 2020). 23 cases in Burkina Faso are right-censored after 14 months: these are women interviewed in the last month (April 2020).</p>
<p>Let’s look at non-users who <em>did</em> have unmet need at Phase 1.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>adopt_models <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(COUNTRY, unmet) <span class="sc">%&gt;%</span> </span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(unmet) <span class="sc">%&gt;%</span> </span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(strata <span class="sc">==</span> <span class="st">&quot;UNMETYN_1=TRUE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>strata) </span></code></pre></div>
<pre><code># A tibble: 58 × 9
   COUNTRY       time n.risk n.event n.censor estimate std.error conf.…¹ conf.…²
   &lt;fct&gt;        &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 Burkina Faso     0    632      86        0    0.864    0.0158   0.891   0.838
 2 Burkina Faso     1    546      15        0    0.840    0.0173   0.869   0.812
 3 Burkina Faso     2    531       6        0    0.831    0.0180   0.860   0.802
 4 Burkina Faso     3    525       9        0    0.816    0.0189   0.847   0.787
 5 Burkina Faso     4    516       6        0    0.807    0.0195   0.838   0.777
 6 Burkina Faso     5    510      13        0    0.786    0.0207   0.819   0.755
 7 Burkina Faso     6    497      11        0    0.769    0.0218   0.803   0.737
 8 Burkina Faso     7    486      12        0    0.75     0.0230   0.785   0.717
 9 Burkina Faso     8    474      11        0    0.733    0.0240   0.768   0.699
10 Burkina Faso     9    463      15        0    0.709    0.0255   0.745   0.674
11 Burkina Faso    10    448       8       21    0.696    0.0263   0.733   0.661
12 Burkina Faso    11    419      11      257    0.678    0.0275   0.715   0.642
13 Burkina Faso    12    151       1      135    0.673    0.0283   0.712   0.637
14 Burkina Faso    13     15       1       12    0.629    0.0746   0.727   0.543
15 Burkina Faso    14      2       0        2    0.629    0.0746   0.727   0.543
# … with 43 more rows, and abbreviated variable names ¹​conf.high, ²​conf.low</code></pre>
<p>Here, we begin with 632 non-users who had unmet need at Phase 1. Among these, <code>n.event</code> shows that 86 adopted a family planning method less than one month after the interview: this leaves 86.4% of the group remaining before one month had passed.</p>
</div>
<div id="data-visualization-1" class="section level3" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Data Visualization</h3>
<p>We’ll produce a Time-to-Event plot by inverting the probabilities reported in <code>event</code> and its accompanying confidence interval.<span id="fn36" class="footnote" data-pagedown-footnote-number="36" style="white-space: pre-line;">The so-called “Time-to-Event” plot is an inverted case the <strong>Kaplan Meier</strong> curve, depicting increased risk over time rather than decreased survival. The same <a href="https://github.com/therneau/survival">survival</a> function can be used to produce either plot.</span> This plot uses <a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a> to draw a step-wise function, and <a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a> to create a shaded confidence interval for each step.</p>
<p>In general, we see evidence that non-users with unmet need at Phase 1 were significantly quicker to adopt a method compared to women with no unmet need in each country.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>adopt_models <span class="sc">%&gt;%</span> </span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(unmet) <span class="sc">%&gt;%</span> </span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COUNTRY, strata) <span class="sc">%&gt;%</span> </span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">strata =</span> <span class="fu">if_else</span>(strata <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">&quot;TRUE&quot;</span>), <span class="st">&quot;Unmet Need&quot;</span>, <span class="st">&quot;No Unmet Need&quot;</span>),</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.double) <span class="sc">&amp;</span> <span class="sc">!</span>time, <span class="sc">~</span><span class="dv">1</span><span class="sc">-</span>.x),</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> <span class="fu">if_else</span>(time <span class="sc">==</span> <span class="fu">max</span>(time), time, time <span class="sc">+</span> <span class="dv">1</span>) <span class="co"># horizontal ci shading</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> estimate, <span class="at">fill =</span> strata)) <span class="sc">+</span> </span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span> </span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> time, <span class="at">xmax =</span> xmax, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="dv">0</span></span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>COUNTRY) <span class="sc">+</span> </span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span> </span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Unmet Need&quot;</span> <span class="ot">=</span> <span class="st">&quot;#F2300E&quot;</span>, <span class="st">&quot;No Unmet Need&quot;</span> <span class="ot">=</span> <span class="st">&quot;#352749&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Predicted Time to FP Adoption by Phase 1 Unmet Need Status&quot;</span>,</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Consecutive Months after Phase 1 FQ Interview&quot;</span></span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a>  theme_pma </span></code></pre></div>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(&quot;images/km1.png&quot;, width = 11, height = 8.5, units = &quot;in&quot;, bg = &quot;white&quot;)</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;images/km1.png&quot;</span>)</span></code></pre></div>
<p><img src="images/km1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>Let’s now consider how the adoption rate might be influenced to by <a href="https://pma.ipums.org/pma-action/variables/FPPLANYR#codes_section">FPPLANYR_1</a>.</p>
<p>Here, we see that women who planned to adopt a method within 1 year following the Phase 1 interview were significantly quicker to begin using one compared to women who had no such plans (except within the first few months for women in Nigeria, where this difference was not statistically significant).</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>adopt_models <span class="sc">%&gt;%</span> </span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(plan) <span class="sc">%&gt;%</span> </span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COUNTRY, strata) <span class="sc">%&gt;%</span> </span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">strata =</span> <span class="fu">if_else</span>(strata <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">&quot;TRUE&quot;</span>),  <span class="st">&quot;Plan&quot;</span>, <span class="st">&quot;No Plan&quot;</span>),</span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.double) <span class="sc">&amp;</span> <span class="sc">!</span>time, <span class="sc">~</span><span class="dv">1</span><span class="sc">-</span>.x),</span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> <span class="fu">if_else</span>(time <span class="sc">==</span> <span class="fu">max</span>(time), time, time <span class="sc">+</span> <span class="dv">1</span>) <span class="co"># horizontal ci shading</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> estimate, <span class="at">fill =</span> strata)) <span class="sc">+</span> </span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span> </span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(</span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> time, <span class="at">xmax =</span> xmax, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="dv">0</span></span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb237-15"><a href="#cb237-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>COUNTRY) <span class="sc">+</span> </span>
<span id="cb237-16"><a href="#cb237-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span> </span>
<span id="cb237-17"><a href="#cb237-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Plan&quot;</span> <span class="ot">=</span> <span class="st">&quot;#EBCC2A&quot;</span>, <span class="st">&quot;No Plan&quot;</span> <span class="ot">=</span> <span class="st">&quot;#899DA4&quot;</span>)) <span class="sc">+</span>  </span>
<span id="cb237-18"><a href="#cb237-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb237-19"><a href="#cb237-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Predicted Time to FP Adoption by Intentions Within 1 Year of Phase 1&quot;</span>,</span>
<span id="cb237-20"><a href="#cb237-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Consecutive Months after Phase 1 FQ Interview&quot;</span></span>
<span id="cb237-21"><a href="#cb237-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb237-22"><a href="#cb237-22" aria-hidden="true" tabindex="-1"></a>  theme_pma </span></code></pre></div>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(&quot;images/km2.png&quot;, width = 11, height = 8.5, units = &quot;in&quot;, bg = &quot;white&quot;)</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;images/km2.png&quot;</span>)</span></code></pre></div>
<p><img src="images/km2.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>Finally, let’s consider the interaction reported in <code>INTERACT_1</code>.</p>
<p>The interaction between <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN_1</a> and <a href="https://pma.ipums.org/pma-action/variables/FPPLANYR#codes_section">FPPLANYR_1</a> seems to confirm at least one of our hypotheses: non-users who had no unmet need and no plans to adopt a method within the year were significantly slower to do so (again, except for the first few months shown in Nigeria). Women without plans to adopt a method were also somewhat slower to adopt a method if they experienced unmet need, but there are considerable differences in the strength of this finding across countries and over the length of the calendar period. Overall, women who planned to adopt a method were significantly quicker to do so, but the mitigating effects of unmet need are generally unclear.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>adopt_models <span class="sc">%&gt;%</span> </span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(interact) <span class="sc">%&gt;%</span> </span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COUNTRY, strata) <span class="sc">%&gt;%</span> </span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">strata =</span> <span class="fu">str_remove</span>(strata, <span class="st">&quot;.*=&quot;</span>),</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.double) <span class="sc">&amp;</span> <span class="sc">!</span>time, <span class="sc">~</span><span class="dv">1</span><span class="sc">-</span>.x),</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> <span class="fu">if_else</span>(time <span class="sc">==</span> <span class="fu">max</span>(time), time, time <span class="sc">+</span> <span class="dv">1</span>)  <span class="co"># horizontal ci shading</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> estimate, <span class="at">fill =</span> strata)) <span class="sc">+</span> </span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span> </span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(</span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> time, <span class="at">xmax =</span> xmax, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb239-14"><a href="#cb239-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="dv">0</span></span>
<span id="cb239-15"><a href="#cb239-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb239-16"><a href="#cb239-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>COUNTRY) <span class="sc">+</span> </span>
<span id="cb239-17"><a href="#cb239-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span> </span>
<span id="cb239-18"><a href="#cb239-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb239-19"><a href="#cb239-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Unmet Need, Plan&quot;</span> <span class="ot">=</span> <span class="st">&quot;#98579B&quot;</span>,</span>
<span id="cb239-20"><a href="#cb239-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Unmet Need, No Plan&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00263A&quot;</span>, </span>
<span id="cb239-21"><a href="#cb239-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;No Unmet Need, Plan&quot;</span> <span class="ot">=</span> <span class="st">&quot;#CCBA72&quot;</span>,</span>
<span id="cb239-22"><a href="#cb239-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;No Unmet Need, No Plan&quot;</span> <span class="ot">=</span> <span class="st">&quot;#81A88D&quot;</span></span>
<span id="cb239-23"><a href="#cb239-23" aria-hidden="true" tabindex="-1"></a>  ))  <span class="sc">+</span>  </span>
<span id="cb239-24"><a href="#cb239-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb239-25"><a href="#cb239-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Predicted Time to FP Adoption by Phase 1 Intentions and Unmet Need&quot;</span>,</span>
<span id="cb239-26"><a href="#cb239-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Consecutive Months after Phase 1 FQ Interview&quot;</span></span>
<span id="cb239-27"><a href="#cb239-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb239-28"><a href="#cb239-28" aria-hidden="true" tabindex="-1"></a>  theme_pma </span></code></pre></div>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(&quot;images/km3.png&quot;, width = 11, height = 8.5, units = &quot;in&quot;, bg = &quot;white&quot;)</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;images/km3.png&quot;</span>)</span></code></pre></div>
<p><img src="images/km3.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
</div>



<script>
// when the page is about to reload via servr, remember the scroll position
document.addEventListener('servr:reload', function(e) {
  sessionStorage.setItem('pagedown-scroll', window.scrollY);
});
</script>
</body>
</html>
