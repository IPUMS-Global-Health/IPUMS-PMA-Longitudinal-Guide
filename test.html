<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width">
<meta property="og:title" content="test.knit" />






<meta name="description" content="test.knit">

<script id="pandoc-meta" type="application/json">
{"newpage_html_class":"page-break-after","cap-location":"margin","toc-title":"Contents","lof":false,"toc":true,"paged-footnotes":true,"css":["css/layout.css","css/fix-pagedown.css","css/fonts.css"],"lot":false,"output":{"pagedown::html_paged":{"self_contained":false,"toc":true}}}
</script>

<title>test.knit</title>


<link href="test_files/paged-0.19/css/default-fonts.css" rel="stylesheet" />
<link href="test_files/paged-0.19/css/default-page.css" rel="stylesheet" />
<link href="test_files/paged-0.19/css/default.css" rel="stylesheet" />
<script src="test_files/paged-0.19/js/config.js"></script>
<script src="test_files/paged-0.19/js/paged.js"></script>
<script src="test_files/paged-0.19/js/hooks.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/layout.css" type="text/css" />
<link rel="stylesheet" href="css/fix-pagedown.css" type="text/css" />
<link rel="stylesheet" href="css/fonts.css" type="text/css" />

</head>

<body>

<div class="running-h1-title"></div>

<div class="running-h2-title"></div>



<div class="front-page">
</div>

<div class="front-matter-container">
<div id="TOC" class="level1 toc front-matter">
<h1 class="toc-title">Contents</h1>
<ul>
<li><a href="#family-planning-indicators"><span class="toc-section-number">1</span> Family Planning Indicators</a>
<ul>
<li><a href="#chapter-setup"><span class="toc-section-number">1.1</span> Chapter Setup</a>
<ul>
<li><a href="#populations-of-interest"><span class="toc-section-number">1.1.1</span> Populations of Interest</a></li>
</ul></li>
<li><a href="#population-inference"><span class="toc-section-number">1.2</span> Population Inference</a></li>
<li><a href="#significance-test"><span class="toc-section-number">1.3</span> Significance Test</a></li>
<li><a href="#data-visualization"><span class="toc-section-number">1.4</span> Data Visualization</a>
<ul>
<li><a href="#plot-theme"><span class="toc-section-number">1.4.1</span> Plot theme</a></li>
<li><a href="#plot-function"><span class="toc-section-number">1.4.2</span> Plot function</a></li>
</ul></li>
<li><a href="#contraceptive-use-or-non-use"><span class="toc-section-number">1.5</span> Contraceptive Use or Non-Use</a></li>
<li><a href="#contraceptive-method-type"><span class="toc-section-number">1.6</span> Contraceptive Method Type</a></li>
<li><a href="#contraceptive-dynamics-by-subgroup"><span class="toc-section-number">1.7</span> Contraceptive Dynamics by Subgroup</a>
<ul>
<li><a href="#age"><span class="toc-section-number">1.7.1</span> Age</a></li>
<li><a href="#education-level"><span class="toc-section-number">1.7.2</span> Education level</a></li>
<li><a href="#marital-status"><span class="toc-section-number">1.7.3</span> Marital status</a></li>
<li><a href="#parity"><span class="toc-section-number">1.7.4</span> Parity</a></li>
</ul></li>
<li><a href="#other-panel-dynamics"><span class="toc-section-number">1.8</span> Other Panel Dynamics</a>
<ul>
<li><a href="#unmet-need"><span class="toc-section-number">1.8.1</span> Unmet need</a></li>
<li><a href="#partner-support"><span class="toc-section-number">1.8.2</span> Partner support</a></li>
<li><a href="#intentions"><span class="toc-section-number">1.8.3</span> Intentions</a></li>
</ul></li>
<li><a href="#wrap-up"><span class="toc-section-number">1.9</span> Wrap-up</a></li>
</ul></li>
</ul>
</div>
</div>

<div class="main">
<div id="family-planning-indicators" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Family Planning Indicators</h1>
<p>In Chapter 4, we’ll demonstrate how to calculate key family planning indicators appearing in the <strong>PMA Longitudinal Brief</strong> for each of the longitudinal samples currently available from IPUMS PMA. The brief for each sample is linked below.</p>
<aside>
Chapter 5 includes R code you can use to reproduce the <strong>alluvial plots</strong> seen in these briefs.
</aside>
<ul>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Burkina%20National_Phase%202_Panel_Results%20Brief_English_Final.pdf">Burkina Faso</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kinshasa_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC - Kinshasa</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kongo%20Central_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC - Kongo Central</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Kenya%20National_Phase%202_Panel%20Results%20Brief_Final.pdf">Kenya</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20KANO_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria - Kano</a></li>
<li><a href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20LAGOS_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria - Lagos</a></li>
</ul>
<p>Indicators calculated in this chapter cover topics like:</p>
<ul>
<li>pregnancy intentions and outcomes</li>
<li>current use of long-acting, short-acting, and traditional contraceptives</li>
<li>discontinuation of family planning</li>
<li>intentions for future use of family planning</li>
<li>unmet need for family planning</li>
<li>partner’s support for use of family planning</li>
</ul>
<aside class="hex">
<div>
<a style="text-decoration: none;" href="https://ggplot2.tidyverse.org/index.html">
<img src="images/hex/ggplot2.png"/>
</a>
<br/>
© RStudio, Inc.
<br/>
(MIT)
</div>
</aside>
<p>As we demonstrate how to calculate these indicators, we’ll also provide code you can use to produce appropriate <strong>data visualizations</strong> built with the <a href="https://ggplot2.tidyverse.org/index.html">ggplot2</a> package included in the <a href="https://tidyverse.tidyverse.org/index.html">tidyverse</a> toolkit for R.</p>
<p>If you installed <a href="https://tidyverse.tidyverse.org/index.html">tidyverse</a> in Chapter 1, no additional installation is necessary to use <a href="https://ggplot2.tidyverse.org/index.html">ggplot2</a>. If not, we recommend installing the complete <a href="https://tidyverse.tidyverse.org/index.html">tidyverse</a> like so now:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<div id="chapter-setup" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Chapter Setup</h2>
<p>Chapter 4 features a <strong>wide</strong> longitudinal extract with all 6 of the available samples. Unlike Chapter 3, the data extract used in this chapter includes <strong>only Female Respondents</strong>.</p>
<p><img src="images/samples.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>Using the variable selection process described in Chapter 2, add the following variables to you Data Cart and click the <a href="https://pma.ipums.org/pma-action/extract_requests/variables">View Cart</a> button to begin checkout (<a href="https://pma.ipums.org/pma-action/faq#ques28">preselected</a> variables are added automatically).</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a> - Result of female questionnaire</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a> - Phase 2 female panel weight</li>
<li><a href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a> - Household residence / membership</li>
<li><a href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE</a> - Age in female questionnaire</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a> - Pregnancy status</li>
<li><a href="https://pma.ipums.org/pma-action/variables/BIRTHEVENT#codes_section">BIRTHEVENT</a> - Number of birth events</li>
<li><a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> - Highest level of school attended (4 categories)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/MARSTAT#codes_section">MARSTAT</a> - Marital status</li>
<li><a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a> - Province, DRC</li>
<li><a href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a> - State, Nigeria</li>
<li><a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a> - Contraceptive user</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> - Most effective current FP method</li>
<li><a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a> - Total unmet need</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPARTSUPPORT#codes_section">FPPARTSUPPORT</a> - Husband / partner would be supportive of FP use</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a> - When will start using FP method in the future - value</li>
<li><a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a> - When will start using FP method in the future - unit</li>
<li><a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a> - PMA country (preselected)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID</a> - Enumeration area (preselected)</li>
</ul>
<p>Before completing checkout, make sure that you’ve selected the <code>dat</code> data format (fixed-width text).</p>
<p><img src="images/checkout.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="page-break-after"></div>
<p>In R, load the following packages described in Chapter 1.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span></code></pre></div>
<p>Place the IPUMS PMA <code>xml</code> metadata file and <code>dat.gz</code> data file in a subfolder called <code>data</code> in the R working directory. Then, load your extract into R as an object called <code>dat</code> like so:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddi =</span> <span class="st">&quot;data/pma_00106.xml&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;data/pma_00106.dat.gz&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="populations-of-interest" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Populations of Interest</h3>
<p>We’ve mentioned in Chapter 1 that PMA samples are only valid for the <em>de facto</em> population: these are women who slept in the household during the night before the interview for the Household Questionnaire in both phases. These women are coded either <code>11</code> or <code>22</code> in both <code>RESIDENT_1</code> and <code>RESIDENT_2</code>. We’ll drop all other women from our extract:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(RESIDENT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>) <span class="sc">&amp;</span> RESIDENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>))</span></code></pre></div>
<p>We also mentioned in Chapter 2 that women who completed the Phase 1 Female Questionnaire may have been <strong>lost to follow-up</strong> at Phase 2. As a reminder, we’ll need to drop any cases where <code>RESULTFQ_2</code> is not coded <code>1</code> for “fully completed”.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(RESULTFQ_2 <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Additionally, a small number of women in each sample elected not to respond to key questions regarding current use of contraceptives, reported in the variable <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>. These cases are coded <code>90</code> and above, as shown on the <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a> Codes tab. We’ll exclude those cases, as well.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CP_1 <span class="sc">&lt;</span> <span class="dv">90</span>, CP_2 <span class="sc">&lt;</span> <span class="dv">90</span>) </span></code></pre></div>
<p>Finally, recall that only the Burkina Faso and Kenya samples are <strong>nationally representative</strong>. Samples from DRC represent regions identified by <a href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a>, while samples from Nigeria represent regions identified by <a href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a>. In order to distinguish each population of interest, we’ll define a custom variable <code>POP</code> that shows each sample’s <a href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a> label concatenated with each of these regions where appropriate.</p>
<ul>
<li><code>POP</code> - Population of interest</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">POP =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(GEOCD) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;DRC -&quot;</span>, <span class="fu">as_factor</span>(GEOCD)),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(GEONG) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Nigeria -&quot;</span>, <span class="fu">as_factor</span>(GEONG)),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as_factor</span>(COUNTRY) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>The remaining sample size for each population of interest is simply a <a href="https://dplyr.tidyverse.org/reference/count.html">count</a> of each level in <code>POP</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(POP)</span></code></pre></div>
<pre><code># A tibble: 6 × 2
  POP                     n
  &lt;chr&gt;               &lt;int&gt;
1 Burkina Faso         5207
2 DRC - Kinshasa       1967
3 DRC - Kongo Central  1511
4 Kenya                6934
5 Nigeria - Kano        998
6 Nigeria - Lagos      1088</code></pre>
<p>As described in Chapter 1, we’ll use the <a href="http://gdfe.co/srvyr/index.html">srvyr</a> package to incorporate survey design information into each of the population estimates calculated below. This includes <a href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a>, which represents the calculated inverse selection probability for all panel members, adjusted for loss to follow-up. We’ll also include identifying numbers for each sample via <a href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID_1</a>.<span id="fn1" class="footnote" style="white-space: pre-line;" data-pagedown-footnote-number="1">Because women are considered “lost to follow-up” if they moved outside the study area, <code>EAID_1</code> and <code>EAID_2</code> are identical for all panel members: you can use either one to identify sample clusters.</span></p>
<p>Our data extract includes samples from the DRC - Kinshasa and DRC - Kongo Central, so we’ll use the procedure described in Chapter 1 to create a variable for sample strata called <code>STRATA_RECODE</code>. To review: <code>STRATA_RECODE</code> uses unique numeric codes from <code>STRATA</code>, except that it also includes unique identifiers for each sampled region in <code>GEOCD</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">STRATA_RECODE =</span> <span class="fu">if_else</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(GEOCD), </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(STRATA_1), </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(GEOCD)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
</div>
</div>
<div id="population-inference" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Population Inference</h2>
<p>The <a href="http://gdfe.co/srvyr/index.html">srvyr</a> function <a href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a> allows us to pass the information in <code>PANELWEIGHT</code>, <code>EAID_1</code>, and <code>STRATA_RECODE</code> to other package functions like <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>. We’ll also demonstrate how to use this information in formal significance tests within each sample via <a href="http://gdfe.co/srvyr/reference/svychisq.html">svychisq</a>.</p>
<p>Let’s begin with a simple example. The variable <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a> indicates whether a woman was currently using any family planning method. The variables <code>CP_1</code> and <code>CP_2</code> in our <strong>wide</strong> extract represent responses collected at Phase 1 and Phase 2, respectively. With help from <a href="http://gdfe.co/srvyr/index.html">srvyr</a>, we’ll obtain a population-level estimate of the proportion of women who were using a method at Phase 2, given their status at Phase 1.</p>
<p>Below, we first use <a href="http://gdfe.co/srvyr/reference/group_by.html">group_by</a> to divide the data extract into individual samples defined by <code>POP</code>. We then reference each of these samples as <a href="https://dplyr.tidyverse.org/reference/context.html">cur_data</a> inside a summary function defined by <a href="http://gdfe.co/srvyr/reference/summarise.html">summarise</a> - this ensures that the population estimates obtained from our combined data extract are identical to those you would obtain if you downloaded one extract for each sample and analyzed them separately.</p>
<p>Within <a href="http://gdfe.co/srvyr/reference/summarise.html">summarise</a>, we use <a href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a> to specify information about the design of each sample, and we then use a second <a href="http://gdfe.co/srvyr/reference/group_by.html">group_by</a> to identify each of our variables of interest, <code>CP_1</code> and <code>CP_2</code>. Finally, we use a second <a href="http://gdfe.co/srvyr/reference/summarise.html">summarise</a> function to calculate a <a href="http://gdfe.co/srvyr/index.html">srvyr</a> summary statistic: in this case, we use <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a> to estimate proportions in the population.</p>
<aside>
You may change the confidence interval to, for example, 99% by setting <code>level = 0.99</code> in <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>.
</aside>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">weight =</span> PANELWEIGHT, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> EAID_1, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">strata =</span> STRATA_RECODE</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CP_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">prop =</span> <span class="cn">TRUE</span>, </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Let’s take a look at the results in <code>cp_tbl</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cp_tbl</span></code></pre></div>
<pre><code># A tibble: 24 × 6
# Groups:   POP [6]
   POP                 CP_1      CP_2        coef `_low` `_upp`
   &lt;chr&gt;               &lt;int+lbl&gt; &lt;int+lbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso        0 [No]    0 [No]    0.790  0.763  0.815 
 2 Burkina Faso        0 [No]    1 [Yes]   0.210  0.185  0.237 
 3 Burkina Faso        1 [Yes]   0 [No]    0.347  0.306  0.391 
 4 Burkina Faso        1 [Yes]   1 [Yes]   0.653  0.609  0.694 
 5 DRC - Kinshasa      0 [No]    0 [No]    0.739  0.685  0.787 
 6 DRC - Kinshasa      0 [No]    1 [Yes]   0.261  0.213  0.315 
 7 DRC - Kinshasa      1 [Yes]   0 [No]    0.275  0.239  0.314 
 8 DRC - Kinshasa      1 [Yes]   1 [Yes]   0.725  0.686  0.761 
 9 DRC - Kongo Central 0 [No]    0 [No]    0.736  0.685  0.782 
10 DRC - Kongo Central 0 [No]    1 [Yes]   0.264  0.218  0.315 
11 DRC - Kongo Central 1 [Yes]   0 [No]    0.270  0.207  0.343 
12 DRC - Kongo Central 1 [Yes]   1 [Yes]   0.730  0.657  0.793 
13 Kenya               0 [No]    0 [No]    0.697  0.676  0.717 
14 Kenya               0 [No]    1 [Yes]   0.303  0.283  0.324 
15 Kenya               1 [Yes]   0 [No]    0.200  0.183  0.217 
16 Kenya               1 [Yes]   1 [Yes]   0.800  0.783  0.817 
17 Nigeria - Kano      0 [No]    0 [No]    0.946  0.910  0.968 
18 Nigeria - Kano      0 [No]    1 [Yes]   0.0544 0.0321 0.0905
19 Nigeria - Kano      1 [Yes]   0 [No]    0.440  0.308  0.581 
20 Nigeria - Kano      1 [Yes]   1 [Yes]   0.560  0.419  0.692 
21 Nigeria - Lagos     0 [No]    0 [No]    0.757  0.713  0.796 
22 Nigeria - Lagos     0 [No]    1 [Yes]   0.243  0.204  0.287 
23 Nigeria - Lagos     1 [Yes]   0 [No]    0.240  0.196  0.290 
24 Nigeria - Lagos     1 [Yes]   1 [Yes]   0.760  0.710  0.804 </code></pre>
<p>The population estimate for each row appears in the column <code>_coef</code>. Looking at row 1, we would estimate that 79% of women aged 15-49 in Burkina Faso used <em>no method</em> both at Phase 1 and again at Phase 2. The columns <code>_low</code> and <code>_upp</code> report the limits of a 95% confidence interval: 76.3% and 81.5%.</p>
<p>Comparing these confidence intervals gives us an informal, conservative way to test for a significant difference between outcomes for each <code>POP</code>: if the intervals for any pair of outcomes in the same sample include no common values, we’ll say that a significant difference exists. <em>Formal testing may also reveal significant differences between pairs of outcomes where these intervals overlap only slightly.</em> Our approach is well suited for data visualization, but it should not replace formal testing. Fortunately, you can adapt our code to replace (or complement) the output from <a href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>.</p>
</div>
<div id="significance-test" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Significance Test</h2>
<p>For example, here we demonstrate how to calculate a Rao-Scott chi-square test for significant differences between the estimated population proportions for each <code>POP</code> and the proportions we would <em>expect</em> to observe if Phase 2 outcomes were statistically independent from Phase 1 conditions.<span id="fn2" class="footnote" style="white-space: pre-line;" data-pagedown-footnote-number="2">The Rao-Scott second-order correction to Pearson’s chi-square test is used to incorporate survey design information from <a href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a>, reflecting weighted population estimates. Wald-type chi-square tests are also available: see <a href="https://rdrr.io/cran/survey/man/svychisq.html">svychisq</a> for details.</span> Because we’re interested in just one summary statistic per sample, we no longer need to <a href="http://gdfe.co/srvyr/reference/group_by.html">group_by</a> <code>CP_1</code> and <code>CP_2</code>; instead, we’ll use the formula <code>~CP_1 + CP_2</code> in the function <a href="https://rdrr.io/cran/survey/man/svychisq.html">svychisq</a>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rao_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">weight =</span> PANELWEIGHT, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> EAID_1,  </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">strata =</span> STRATA_RECODE</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">rao =</span> <span class="fu">svychisq</span>(<span class="sc">~</span>CP_1 <span class="sc">+</span> CP_2, <span class="at">design =</span> .) <span class="sc">%&gt;%</span> list)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>rao_tbl</span></code></pre></div>
<pre><code># A tibble: 6 × 2
# Groups:   POP [6]
  POP                 rao    
  &lt;chr&gt;               &lt;list&gt; 
1 Burkina Faso        &lt;htest&gt;
2 DRC - Kinshasa      &lt;htest&gt;
3 DRC - Kongo Central &lt;htest&gt;
4 Kenya               &lt;htest&gt;
5 Nigeria - Kano      &lt;htest&gt;
6 Nigeria - Lagos     &lt;htest&gt;</code></pre>
<p>Our new summary column <code>rao</code> contains output for each sample’s test in a <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/list">list</a>. From here, you can extract output elements <a href="https://dplyr.tidyverse.org/articles/rowwise.html">rowwise</a> by name like so:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rao_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">F</span><span class="st">`</span> <span class="ot">=</span> rao<span class="sc">$</span>statistic, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value =</span> rao<span class="sc">$</span>p.value,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig95 =</span> p.value <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code># A tibble: 6 × 5
# Rowwise:  POP
  POP                 rao          F   p.value sig95
  &lt;chr&gt;               &lt;list&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;lgl&gt;
1 Burkina Faso        &lt;htest&gt;  468.  4.62e- 50 TRUE 
2 DRC - Kinshasa      &lt;htest&gt;  216.  4.80e- 21 TRUE 
3 DRC - Kongo Central &lt;htest&gt;  123.  9.43e- 16 TRUE 
4 Kenya               &lt;htest&gt; 1140.  8.58e-102 TRUE 
5 Nigeria - Kano      &lt;htest&gt;   89.2 2.23e-  9 TRUE 
6 Nigeria - Lagos     &lt;htest&gt;  204.  2.85e- 19 TRUE </code></pre>
</div>
<div id="data-visualization" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Data Visualization</h2>
<p>We’ll use simple <strong>grouped bar charts</strong> to show population estimates for each proportion calculated throughout the remainder of this chapter. A grouped bar chart differs from the <strong>stacked bar charts</strong> shown in PMA reports in that each response is plotted along an axis (rather than stacked together in a single bar). We’ll show <strong>grouped bar charts</strong> here so that we can also include <strong>error bars</strong> representing a 95% confidence interval for each proportion.</p>
<p>For example, let’s plot the estimates created in <code>cp_tbl</code> above. As a preliminary step, we’ll recode <code>CP_1</code> and <code>CP_2</code> with <a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a> and sort their levels with <a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a>. This ensures that the <em>value labels</em> for each variable will be printed on our plot.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="ot">&lt;-</span> cp_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(CP_1, CP_2),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">as_factor</span>(.x) <span class="sc">%&gt;%</span> <span class="fu">fct_relevel</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Next, we’ll use <a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot2</a> to build the plot. Because our data includes multiple samples, we’ll use <a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a> to plot all summary data in multiple panels. The functions <a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a> and <a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a> plot the grouped bars and error bars, respectively. A baseline plot should look something like this:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CP_2)) <span class="sc">+</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP), <span class="at">cols =</span> <span class="fu">vars</span>(CP_1)) <span class="sc">+</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">_low</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">_upp</span><span class="st">`</span>), <span class="at">width =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-19-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div id="plot-theme" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Plot theme</h3>
<p>One of the powerful features of <a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot2</a> is that you can use <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">pre-built themes</a> to customize this baseline layout. We’ll build on <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a> to create our own <code>theme_pma</code> (with custom fonts incorporated by the <a href="https://cran.r-project.org/package=sysfonts">sysfonts</a> and <a href="https://cran.rstudio.com/web/packages/showtext/vignettes/introduction.html">showtext</a> packages). <strong>Feel free to use our theme, or tweak it to create your own!</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>sysfonts<span class="sc">::</span><span class="fu">font_add</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&quot;cabrito&quot;</span>, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">regular =</span>  <span class="fu">here</span>(<span class="st">&quot;fonts/cabritosansnormregular-webfont.ttf&quot;</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>showtext<span class="sc">::</span><span class="fu">showtext_auto</span>()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>theme_pma <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>() <span class="sc">%+replace%</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;cabrito&quot;</span>, <span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">22</span>, <span class="at">color =</span> <span class="st">&quot;#00263A&quot;</span>, </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">5</span>)),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">10</span>))</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="plot-function" class="section level3" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Plot function</h3>
<p>Because we’ll be constructing the same type of plot for each indicator, we’ll need to re-use the same <a href="https://ggplot2.tidyverse.org">ggplot2</a> functions several times. In this circumstance, it’s often helpful to combine repeated functions inside a custom function of your own: this prevents errors and saves time.</p>
<p>We’ll call our custom function <code>pma_bars</code>. It includes:</p>
<ul>
<li><code>theme_pma</code> created above</li>
<li><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a> for plot labels (passed from function arguments)</li>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a> formatting for continuous x-axis labels</li>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a> formatting for discrete y-axis labels</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a> for grouped bars</li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a> for error bars</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pma_bars <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,     <span class="co"># an optional title </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="cn">NULL</span>,  <span class="co"># an optional subtitle </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xaxis =</span> <span class="cn">NULL</span>,     <span class="co"># an optional label for the x-axis (displayed above)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">yaxis =</span> <span class="cn">NULL</span>      <span class="co"># an optional label for the y-axis (displayed left)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  components <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">&quot;theme_pma&quot;</span>)){theme_pma},</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> title,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> subtitle,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">str_wrap</span>(yaxis, <span class="dv">10</span>),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NULL</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="st">&#39;bottom&#39;</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>., <span class="at">name =</span> xaxis, <span class="at">breaks =</span> <span class="cn">NULL</span>),</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#98579BB0&quot;</span>),</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">_low</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">_upp</span><span class="st">`</span>), </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="fl">0.2</span>, </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;#00263A&quot;</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="page-break-after"></div>
<p>Going forward, we’ll incorporate <code>pma_bars</code> together with a <a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a> and <a href="https://ggplot2.tidyverse.org/reference/index.html#facetting">facet</a> function for a given set of variables like so:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CP_2)) <span class="sc">+</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP), <span class="at">cols =</span> <span class="fu">vars</span>(CP_1)) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Change in Contracptive Use Status&quot;</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;A grouped bar chart, faceted by population of interest&quot;</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1&quot;</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2&quot;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-22-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="contraceptive-use-or-non-use" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Contraceptive Use or Non-Use</h2>
<p>Let’s continue our examination of <a href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>. In the PMA reports for each sample linked above, you’ll notice that women who were pregnant at either phase are distinguished from women who reported use or non-use in <code>CP_1</code> or <code>CP_2</code>. We’ll identify these women in the variable <a href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a>, and then we’ll create a combined indicator called <code>FPSTATUS</code>.</p>
<ul>
<li><code>FPSTATUS</code> - Pregnant, using contraception, or using no contraception</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPSTATUS_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      PREGNANT_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Pregnant&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Using FP&quot;</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      CP_1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPSTATUS_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      PREGNANT_2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Pregnant&quot;</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      CP_2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Using FP&quot;</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>      CP_2 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Not Using FP&quot;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(FPSTATUS_1, FPSTATUS_2),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>.x <span class="sc">%&gt;%</span> <span class="fu">fct_relevel</span>(<span class="st">&quot;Pregnant&quot;</span>, <span class="st">&quot;Not Using FP&quot;</span>, <span class="st">&quot;Using FP&quot;</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We’ll now revise <code>cp_tbl</code> to include information from <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>. This will help us answer key questions like:</p>
<ul>
<li>Are women who were pregnant at Phase 1 more likely to use or not use family planning at Phase 2?</li>
<li>Are women who were using (or not using) contraception at Phase 1 likely to maintain the same status at Phase 2?</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPSTATUS_1, FPSTATUS_2) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="page-break-after"></div>
<p>This new version of <code>cp_tbl</code> includes the labels we assigned to <code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>. The first dozen rows are shown below.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cp_tbl</span></code></pre></div>
<pre><code># A tibble: 54 × 6
# Groups:   POP [6]
   POP            FPSTATUS_1   FPSTATUS_2     coef `_low` `_upp`
   &lt;chr&gt;          &lt;fct&gt;        &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso   Pregnant     Pregnant     0.0302 0.0137 0.0652
 2 Burkina Faso   Pregnant     Not Using FP 0.568  0.491  0.642 
 3 Burkina Faso   Pregnant     Using FP     0.401  0.329  0.478 
 4 Burkina Faso   Not Using FP Pregnant     0.0779 0.0651 0.0929
 5 Burkina Faso   Not Using FP Not Using FP 0.739  0.711  0.765 
 6 Burkina Faso   Not Using FP Using FP     0.183  0.158  0.211 
 7 Burkina Faso   Using FP     Pregnant     0.0993 0.0815 0.121 
 8 Burkina Faso   Using FP     Not Using FP 0.248  0.213  0.287 
 9 Burkina Faso   Using FP     Using FP     0.653  0.609  0.694 
10 DRC - Kinshasa Pregnant     Pregnant     0.0367 0.0140 0.0930
11 DRC - Kinshasa Pregnant     Not Using FP 0.464  0.338  0.594 
12 DRC - Kinshasa Pregnant     Using FP     0.500  0.370  0.629 
# … with 42 more rows</code></pre>
<p>Next, we’ll plot <code>cp_tbl</code> with <code>pma_bars</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cp_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> FPSTATUS_2)) <span class="sc">+</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(FPSTATUS_1), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE USE OR NON-USE&quot;</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent women age 15-49 who changed contraceptive use status&quot;</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1 Status&quot;</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Status&quot;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-27-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>To reiterate: comparing the error bars within each of these 18 panels gives us a informal, but conservative test for significant difference. We’ll say that a significant difference occurs where two pairs of error bars <strong>do not overlap</strong> (but additional testing may be necessary to determine whether a significant difference occurs where error bars overlap only slightly). A few observations:</p>
<ul>
<li>For women who were pregnant at Phase 1, there is usually no apparent difference between using and not using family planning at Phase 2. Kenya and Nigeria - Kano are the exception: in Kenya, pregnant women at Phase 1 were appear more likely to be using FP at Phase 2, while the opposite is true in Kano.<br />
</li>
<li>Overall, non-pregnant women at Phase 1 appeared more likely to maintain the same status (use or non-use) at Phase 2 than they were to switch or become pregnant.</li>
</ul>
</div>
<div id="contraceptive-method-type" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Contraceptive Method Type</h2>
<p>PMA surveys also ask contraceptive users to indicate which method they are currently using at each phase of the study. If a woman reports using more than one method, <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETH#codes_section">FPCURREFFMETH</a> shows her most <em>effective</em> currently used method. These responses are combined with detailed information about use of the lactational amenorrhea method (LAM), emergency contraception, or injectable type in <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>. PMA reports use <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> to determine whether each woman’s most effective current method is a short-acting, long-acting, or traditional method.</p>
<p>Long-acting methods include:</p>
<ul>
<li>IUDs</li>
<li>implants</li>
<li>male sterilization</li>
<li>female sterilization</li>
</ul>
<p>Short-acting methods include:</p>
<ul>
<li>injectables (intramuscular and subcutaneous)</li>
<li>the pill</li>
<li>emergency contraception</li>
<li>male condoms</li>
<li>female condoms</li>
<li>LAM</li>
<li>diaphragm</li>
<li>foam/jelly</li>
<li>standard days method</li>
</ul>
<p>Traditional methods include:</p>
<ul>
<li>rhythm</li>
<li>withdrawal</li>
<li>other traditional</li>
</ul>
<div class="page-break-after"></div>
<p>These methods are coded sequentially by group in <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>. Women who are “NIU (not in universe)” were using no method.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(FPCURREFFMETHRC_1)</span></code></pre></div>
<pre><code># A tibble: 19 × 2
   FPCURREFFMETHRC_1                             n
   &lt;int+lbl&gt;                                 &lt;int&gt;
 1 101 [Female Sterilization]                  198
 2 102 [Male Sterilization]                      1
 3 111 [Implants]                             2248
 4 112 [IUD]                                   226
 5 121 [Injectables (3 months)]               1412
 6 123 [Injectables (Sayana Press)]            296
 7 131 [Pill]                                  547
 8 132 [Emergency Contraception]               243
 9 141 [Male condom]                           791
10 142 [Female condom]                           1
11 151 [Diaphragm]                               1
12 152 [Foam]                                    1
13 160 [Standard Days/Cycle Beads Method]       70
14 170 [Lactational amenorrhea method (LAM)]    24
15 210 [Rhythm]                                569
16 220 [Withdrawal]                            351
17 240 [Other traditional]                     153
18 998 [No response or missing]                  1
19 999 [NIU (not in universe)]               10572</code></pre>
<p>We’ll use <a href="https://dplyr.tidyverse.org/reference/across.html">across</a> to recode the Phase 1 and Phase 2 versions of <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> simultaneously. We’ll also attach the prefix <code>CAT</code> to each variable, indicating that we’ve created “categorized” versions of each.</p>
<ul>
<li><code>CAT_FPSFPCURREFFMETHRC</code> - Contraceptive method type</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(FPCURREFFMETHRC_1, FPCURREFFMETHRC_2),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">case_when</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">&lt;</span> <span class="dv">120</span> <span class="sc">~</span> <span class="st">&quot;long-acting&quot;</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">&quot;short-acting&quot;</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">&lt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;traditional&quot;</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;none&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fct_relevel</span>( <span class="st">&quot;long-acting&quot;</span>, <span class="st">&quot;short-acting&quot;</span>, <span class="st">&quot;traditional&quot;</span>, <span class="st">&quot;none&quot;</span>),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">&quot;CAT_{.col}&quot;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<div class="page-break-after"></div>
<p>Next, we’ll generate population estimates for our derived variables, <code>CAT_FPCURREFFMETHRC_1</code> and <code>CAT_FPCURREFFMETHRC_2</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>meth_tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_FPCURREFFMETHRC_1, CAT_FPCURREFFMETHRC_2) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>meth_tbl</span></code></pre></div>
<pre><code># A tibble: 95 × 6
# Groups:   POP [6]
   POP          CAT_FPCURREFFMETHRC_1 CAT_FPCURREFFMETHRC_2    coef  `_low` `_upp`
   &lt;chr&gt;        &lt;fct&gt;                 &lt;fct&gt;                   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso long-acting           long-acting           0.680   0.629   0.727 
 2 Burkina Faso long-acting           short-acting          0.0658  0.0448  0.0955
 3 Burkina Faso long-acting           traditional           0.00611 0.00325 0.0115
 4 Burkina Faso long-acting           none                  0.248   0.196   0.308 
 5 Burkina Faso short-acting          long-acting           0.0584  0.0367  0.0917
 6 Burkina Faso short-acting          short-acting          0.465   0.405   0.526 
 7 Burkina Faso short-acting          traditional           0.0328  0.0205  0.0519
 8 Burkina Faso short-acting          none                  0.444   0.382   0.507 
 9 Burkina Faso traditional           long-acting           0.0635  0.0215  0.174 
10 Burkina Faso traditional           short-acting          0.217   0.121   0.357 
11 Burkina Faso traditional           traditional           0.302   0.178   0.464 
12 Burkina Faso traditional           none                  0.418   0.289   0.558 
# … with 83 more rows</code></pre>
<p>And, we’ll again use <code>pma_bars</code> to plot the results.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>meth_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_FPCURREFFMETHRC_2)) <span class="sc">+</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CAT_FPCURREFFMETHRC_1), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE METHOD TYPE&quot;</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who changed contraceptive method or use status&quot;</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 1 Method&quot;</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Method&quot;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-31-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>What do we learn from this plot? Let’s consider each column in turn:</p>
<ul>
<li>Users of “long-acting” methods at Phase 1 appear more likely to have used “long-acting” methods at Phase 2 than to have changed status (except perhaps in Kano, where the intervals for “long-acting” and “none” overlap at Phase 2).</li>
<li>Users of “short-acting” methods at Phase 1 appeared generally likely to use them again at Phase 2, but some samples show that women are equally likely to be using “none” at Phase 2. A difference between these two outcomes is visually apparent only in Kinshasa, Kenya, and Lagos (where women were more likely to be using “short-acting” methods than “none”).</li>
<li>The status of Phase 1 “traditional” users is generally unclear at Phase 2. In Kinshasa, Kongo Central, and Lagos, these women seem most likely to remain “traditional” users at Phase 2. Elsewhere, there are no clear trends.</li>
<li>Users of “none” at Phase 1 were clearly most likely to remain as such at Phase 2.</li>
</ul>
</div>
<div id="contraceptive-dynamics-by-subgroup" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Contraceptive Dynamics by Subgroup</h2>
<p>We can also use <a href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a> to see whether women switched methods, stopped using any method, started using any method, or made no changes. Let’s summarize this information as <code>CHG_FPCURR</code>:</p>
<ul>
<li><code>CHG_FPCURR</code> - Change in contraceptive use between Phase 1 and Phase 2</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CHG_FPCURR =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">&amp;</span> FPCURREFFMETHRC_2 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;Continued non-use&quot;</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;Started using&quot;</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_2 <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">&quot;Stopped using&quot;</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">!=</span> FPCURREFFMETHRC_2 <span class="sc">~</span> <span class="st">&quot;Changed methods&quot;</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      FPCURREFFMETHRC_1 <span class="sc">==</span> FPCURREFFMETHRC_2 <span class="sc">~</span> <span class="st">&quot;Continued method&quot;</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>PMA reports disaggregate the outcomes captured in <code>CHG_FPCURR</code> by age, marital status, education level, and parity (number of live childbirths).</p>
<div id="age" class="section level3" number="1.7.1">
<h3><span class="header-section-number">1.7.1</span> Age</h3>
<p>We’ll use PMA’s categorization of <code>AGE_2</code> to examine differences between women in three categories.</p>
<ul>
<li><code>CAT_AGE_2</code> - Phase 2 age (3 categories)</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_AGE_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>      AGE_2 <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&quot;15-19&quot;</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      AGE_2 <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">&quot;20-24&quot;</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;25-49&quot;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Plotting <code>CAT_AGE_2</code> on the y-axis allows us to compare confidence intervals across age groups. For example, notice that women aged 15-19 in every population seem more likely to continue non-use than women who are aged 20-24 or 25-49 (column 3).</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_AGE_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_AGE_2)) <span class="sc">+</span> </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVEUSE STATUS, BY AGE&quot;</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Age&quot;</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-34-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="education-level" class="section level3" number="1.7.2">
<h3><span class="header-section-number">1.7.2</span> Education level</h3>
<p>The variable <a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> standardizes educational categories across countries (see <a href="https://pma.ipums.org/pma-action/variables/EDUCATT#codes_section">EDUCATT</a> for country-specific codes). To match PMA reports, we’ll recode <a href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a> into just three groups:</p>
<ul>
<li><code>CAT_EDUCATTGEN_2</code> - Phase 2 education level (3 categories)</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_EDUCATTGEN_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>      EDUCATTGEN_2 <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;None / Primary&quot;</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>      EDUCATTGEN_2 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;Secondary&quot;</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>      EDUCATTGEN_2 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">&quot;Tertiary&quot;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>As with age, we’ll plot <code>CAT_EDUCATTGEN_2</code> on the y-axis. There aren’t many clear takeaways here: confidence intervals overlap in each column for almost every education level, so visual inspection reveals no clear significant differences:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EDUCATTGEN_2 <span class="sc">&lt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> <span class="co"># drop if missing </span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_EDUCATTGEN_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_EDUCATTGEN_2)) <span class="sc">+</span> </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVEUSE STATUS, BY EDUCATION LEVEL&quot;</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Education Level&quot;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-36-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="marital-status" class="section level3" number="1.7.3">
<h3><span class="header-section-number">1.7.3</span> Marital status</h3>
<p>The variable <a href="https://pma.ipums.org/pma-action/variables/MARSTAT#codes_section">MARSTAT</a> indicates each woman’s marital / partnership status. PMA considers women “in union” to be those who are currently married (code <code>21</code>) or currently living with their partner (code <code>22</code>). Otherwise, women who were never married, divorced / separated, or widowed are considered “not in union”.</p>
<ul>
<li><code>CAT_MARSTAT_2</code> - Phase 2 marital status (2 categories)</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_MARSTAT_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>      MARSTAT_2 <span class="sc">%in%</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">22</span> <span class="sc">~</span> <span class="st">&quot;In union&quot;</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Not in union&quot;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Here, we see that women who were <em>not</em> in a union at Phase 2 were significantly more likely to continue non-use of contraception compared to married / partnered women in each population. On the other hand, women who <em>were</em> in a union mainly appeared more likely to continue using the same method, or perhaps to change methods (most clearly in Kenya).</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_MARSTAT_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_MARSTAT_2)) <span class="sc">+</span> </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE METHOD TYPE, BY MARITAL STATUS&quot;</span>,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Marital Status&quot;</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-38-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="parity" class="section level3" number="1.7.4">
<h3><span class="header-section-number">1.7.4</span> Parity</h3>
<p>Parity refers to the number of times a women has given live birth (excluding stillbirths). This information is recorded in the IPUMS variable <a href="https://pma.ipums.org/pma-action/variables/BIRTHEVENT#codes_section">BIRTHEVENT</a>, in which the values <code>0</code> and <code>99</code> (not in universe) can both be interpreted as “none”.</p>
<ul>
<li><code>CAT_BIRTHEVENT_2</code> - Phase 2 number of live births (4 categories)</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAT_BIRTHEVENT_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">99</span>) <span class="sc">~</span> <span class="st">&quot;None&quot;</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">&quot;One-two&quot;</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="st">&quot;Three-four&quot;</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      BIRTHEVENT_2 <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;Five +&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct_relevel</span>(<span class="st">&quot;None&quot;</span>, <span class="st">&quot;One-two&quot;</span>, <span class="st">&quot;Three-four&quot;</span>, <span class="st">&quot;Five +&quot;</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>There are few clear patterns related to parity, except that women who have never given birth are also more likely to continue non-use of contraception between phases.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(BIRTHEVENT_2 <span class="sc">!=</span> <span class="dv">98</span>) <span class="sc">%&gt;%</span> <span class="co"># drops 2 missing cases (code 98)</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CAT_BIRTHEVENT_2, CHG_FPCURR) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> CAT_BIRTHEVENT_2)) <span class="sc">+</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(CHG_FPCURR), <span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CHANGE IN CONTRACEPTIVE METHOD TYPE, BY PARITY&quot;</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 2 Childbirths&quot;</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-40-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="other-panel-dynamics" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Other Panel Dynamics</h2>
<p>The final page in each PMA report covers family planning dynamics related to unmet need, partner support, and plans for future use of family planning methods. In each case, we’ll be focusing on women who were <em>not</em> using any method at Phase 1. We’ll show how each of these dynamics impacts the likelihood that Phase 1 non-users would have adopted any family planning method at Phase 2.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CP_1 <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<div id="unmet-need" class="section level3" number="1.8.1">
<h3><span class="header-section-number">1.8.1</span> Unmet need</h3>
<p>PMA defines unmet need for family planning according to each woman’s fertility preferences, current use of family planning methods, and risk factors for pregnancy. Women may have “unmet need” for birth spacing (e.g. pregnant women whose pregnancy was mistimed) or for limiting births (e.g. pregnant women whose pregnancy was unwanted), while women are considered “not at risk” if they are not sexually active or cannot become pregnant. The variable <a href="https://pma.ipums.org/pma-action/variables/UNMETNEED#codes_section">UNMETNEED</a> provides detailed information on types of need for each woman, and on related variables that were used to calculate unmet need.</p>
<p>The binary variable <a href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a> recodes <a href="https://pma.ipums.org/pma-action/variables/UNMETNEED#codes_section">UNMETNEED</a> as either “Unmet need”, or “No unmet need”. We’ll reword these labels only slightly to minimize the amount of repeated text on our plot:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">UNMETYN_1 =</span> <span class="fu">if_else</span>(UNMETYN_1 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(UNMETYN_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CP_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> UNMETYN_1)) <span class="sc">+</span> </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;UNMET NEED FOR FAMILY PLANNING&quot;</span>,</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who were not using a method at Phase 1&quot;</span>,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 2: Adopted a method&quot;</span>,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 1: Unmet Need&quot;</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-42-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Overall, these results suggest that non-users with unmet need for family planning at Phase 1 were more likely to adopt a method at Phase 2 compared to non-users who had none (e.g. women who were not sexually active, could not become pregnant, etc.). However, formal testing is needed to determine whether these trends were statistically significant in Burkina Faso and Nigeria - Lagos.</p>
</div>
<div id="partner-support" class="section level3" number="1.8.2">
<h3><span class="header-section-number">1.8.2</span> Partner support</h3>
<p>Women who were not using family planning and not pregnant at Phase 1 were asked whether they thought their husband / partner would be supportive of use of family planning in the future. These results are recorded in <a href="https://pma.ipums.org/pma-action/variables/FPPARTSUPPORT#codes_section">FPPARTSUPPORT</a>. We’ll exclude non-partnered women here, as they are “NIU (not in universe)”.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FPPARTSUPPORT_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">97</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FPPARTSUPPORT_1 =</span> FPPARTSUPPORT_1 <span class="sc">%&gt;%</span> as_factor) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPPARTSUPPORT_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CP_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> FPPARTSUPPORT_1)) <span class="sc">+</span> </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;PARTNER SUPPORT FOR FAMILY PLANNING&quot;</span>,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who were not using a method at Phase 1&quot;</span>,</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 2: Adopted a method&quot;</span>,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 1: Partner would support FP&quot;</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-43-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>We’ve included responses for women who were unsure whether their partner would or would not support future use of FP (“Dont know”), but Phase 2 outcomes for these women were usually not visually distinct from those who answered “Yes” or “No”. Formal testing is needed to determine whether any significant differences exist.</p>
<p>Meanwhile, women with Phase 1 partner support in DRC - Kongo Central and Kenya were more likely to adopt a method than not. Outcomes for women in other populations are not visibly different based on partner support, one way or the other (again, formal testing may prove otherwise).</p>
</div>
<div id="intentions" class="section level3" number="1.8.3">
<h3><span class="header-section-number">1.8.3</span> Intentions</h3>
<p>Lastly, we’ll demonstrate the impact of women’s plans for future family planning use at Phase 1. The variable <a href="https://pma.ipums.org/pma-action/variables/FPUSPLAN#codes_section">FPUSPLAN</a> indicates whether women had plans for future use <em>at any point</em> in the future, but here we’ll consider whether women had plans to adopt a method <em>within the next year</em> to correspond with the timing of Phase 2 surveys.</p>
<p>There are two variables that describe the approximate time when women said they would adopt a family planning method (if at all). <a href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a> contains a raw number that should be matched with a <em>unit</em> of time (months, years) or a categorical response (“soon / now”, “after the birth of this child”) in <a href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(FPPLANWHEN_1)</span></code></pre></div>
<pre><code># A tibble: 7 × 2
  FPPLANWHEN_1                           n
  &lt;int+lbl&gt;                          &lt;int&gt;
1  1 [Months]                          932
2  2 [Years]                          3039
3  3 [Soon / Now]                      685
4  4 [After the birth of this child]   338
5 97 [Don&#39;t know]                      893
6 98 [No response or missing]           18
7 99 [NIU (not in universe)]          4668</code></pre>
<p>We’ll create <code>FPPLANYR_1</code> to indicate whether each woman planned to use family planning within a year’s time at Phase 1.</p>
<ul>
<li><code>FPPLANYR_1</code> - Phase 1 plans to use FP within one year</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPPLANYR_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> FPPLANVAL_1 <span class="sc">&lt;=</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, <span class="co"># Within 12 months </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> FPPLANVAL_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, <span class="co"># Within 1 year</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>      FPPLANWHEN_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, <span class="co"># Soon / now or after current pregnancy</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;No&quot;</span> <span class="co"># Includes date unknown, no response, or no intention (FPUSPLAN)</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Our final plot shows the difference in FP adoption between women who planned to do so within the year, compared with women with no such plans.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(POP) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cur_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(<span class="at">weight =</span> PANELWEIGHT, <span class="at">id =</span> EAID_1, <span class="at">strata =</span> STRATA_RECODE) <span class="sc">%&gt;%</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(FPPLANYR_1, CP_2) <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>, <span class="at">prop_method =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CP_2 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">y =</span> FPPLANYR_1)) <span class="sc">+</span> </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(POP)) <span class="sc">+</span> </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pma_bars</span>(</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;INTENTION TO USE FAMIILY PLANNING WITHIN ONE YEAR&quot;</span>,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Percent of women age 15-49 who were not using a method at Phase 1&quot;</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="st">&quot;Phase 2: Adopted a method&quot;</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="st">&quot;Phase 1: Plan to use FP&quot;</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="test_files/figure-html/unnamed-chunk-46-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>In every population, Phase 1 non-users who planned to adopt a method by Phase 2 were significantly more likely to do so. However, a significant <em>majority</em> of Phase 1 non-users with plans to adopt a method actually did so only in Kenya, where the 95% confidence interval for “Yes” responses includes only proportions greater than the 50% threshold. In fact, women who adopted a method at Phase 2 represent a significant <em>minority</em> of Phase 1 non-users who planned to do so in Burkina Faso, DRC - Kongo Central, and Nigeria - Kano.</p>
</div>
</div>
<div id="wrap-up" class="section level2" number="1.9">
<h2><span class="header-section-number">1.9</span> Wrap-up</h2>
<p>As we’ve seen, <strong>grouped bar charts</strong> give us a simple way to identify clear differences between Phase 2 outcomes for subgroups defined by baseline family planning conditions or key demographic features. Additionally, when we <strong>facet</strong> populations of interest on the same axis, we can easily compare differences between subgroups for many samples in a single figure.</p>
<p>One drawback to this approach is that it’s more conservative than formal statistical tests. We are not able to easily spot differences near the conventional 95% certainty threshold. However, we demonstrated how you can adapt our code to conduct formal hypothesis tests like the <a href="https://rdrr.io/cran/survey/man/svychisq.html">Rao-Scott chi-square test</a> for weighted proportions.</p>
<p>Another drawback to this approach is that we’ve been unable to showcase estimates for the proportion of responses at any <em>one</em> phase of the study. For example, in our last figure, we estimated that about 35% of women who <em>planned to use</em> contraception within the year at Phase 1 did so at Phase 2; our figure does not show how many women planned to use contraception within the year <em>as a share of the Phase 1 population</em>.</p>
<p>To better understand the change over time relative to the size of each subgroup in our analysis, we’ll turn to a slightly more complicated data visualization method. In our next post, we’ll show how to create <strong>alluvial plots</strong>, like those shown in the first two pages of each PMA report.</p>
</div>
</div>
</div>



<script>
// when the page is about to reload via servr, remember the scroll position
document.addEventListener('servr:reload', function(e) {
  sessionStorage.setItem('pagedown-scroll', window.scrollY);
});
</script>
</body>
</html>
